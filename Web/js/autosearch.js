!function(t,e){"function"==typeof define&&define.amd?define("autosearch",["$"],e):"object"==typeof exports?module.exports=e():t.AutoSearch=e(window.Zepto||window.jQuery||$)}(this,function(t){function e(){}return e.prototype={init:function(e){var n=Math.random().toString().replace(".","");this.id="autosearch_"+n,this.settings=t.extend({mutil:!1},e),this.input=t(this.settings.input),this.min=this.settings.min||1,this.data=this.settings.data,this.valueObj=t(this.settings.valueObj||this.settings.input),this.valueName=this.settings.valueName||"name",this.target=t(this.settings.target||this.settings.input),this.filterColumn=this.settings.filterColumn||["name"],this.column=this.settings.column||["name"],this.timer=null,this.content=null,this.mutilValueArr=[],this.mutilTextArr=[],this.createContent(),this.bindEvent()},bindEvent:function(){var e=this;this.target.click(function(){return e.settings.autoShow&&e.search(),!1}),this.input.on("focus",function(){var n=t(this);e.timer&&clearInterval(e.timer),e.timer=setInterval(function(){n.data("old")!=n.val()&&(e.search(),n.data("old",n.val()))},25),e.settings.focusCallback&&e.settings.focusCallback.call(e,e.input)}).on("keyup",function(n){var i=t(this);i.data("old")!=i.val()&&13!=n.keyCode&&(e.search(),i.data("old",i.val()))}).on("blur",function(){e.timer&&clearInterval(e.timer);var n=t(this);setTimeout(function(){e.hide(),n.attr("data-text")==n.val()||e.settings.mutil||(e.input.val(""),e.settings.resetCallback&&e.settings.resetCallback.call(e,e.input))},500),e.settings.blurCallback&&e.settings.blurCallback.call(e,e.input)}).on("keyup",function(n){switch(n.keyCode){case 40:var i=t(".item.current",e.content).index();i++,i=Math.min(t(".item",e.content).size()-1,i);var s=t(".item.current",e.content);if(t(".item",e.content).removeClass("current").eq(i).addClass("current"),s.size()){var a=t(".item.current",e.content).position(),o=s.outerHeight();if(a.top+o>t(e.content).height()){var r=t(e.content).scrollTop();r+=o,t(e.content).scrollTop(r)}}break;case 38:var i=t(".item.current",e.content).index();i--,i=Math.max(0,i),t(".item",e.content).removeClass("current").eq(i).addClass("current");var s=t(".item.current",e.content);if(s.size()){var a=t(".item.current",e.content).position(),o=s.outerHeight(),r=t(e.content).scrollTop();a.top<=0&&(r-=o,t(e.content).scrollTop(Math.max(r,0)))}break;case 13:t(".item.current",e.content).trigger("click"),setTimeout(function(){e.hide()},50)}}).on("keydown",function(t){13==t.keyCode&&t.preventDefault()}),this.content.on("click",".item",function(){var n=t(this).data("data"),i=t(this).text();1==e.settings.mutil?(e.mutilTextArr.push(i),e.mutilValueArr.push(n[e.valueName]),e.input.val(e.mutilTextArr.join(",")+","),e.valueObj.val(e.mutilValueArr.join(",")+","),e.input.attr("data-value",e.input.attr("data-value")),e.input.attr("data-text",e.mutilTextArr.join(",")+",")):(e.input.val(i),e.valueObj.val(n[e.valueName]),e.input.attr("data-value",n[e.valueName]),e.settings.valueObj?e.input.attr("data-text",i):e.input.attr("data-text",n[e.valueName])),e.settings.callback&&e.settings.callback.call(e,n),e.hide()}).on("mouseover",".item",function(){t(this).addClass("current").siblings().removeClass("current")}),t(document).click(function(){e.hide()})},createContent:function(){0==t("#"+this.id).size()&&(this.content=t('<div id="'+this.id+'" class="ui-autosearch-content"/>'),this.content.hide(),t("body").append(this.content))},show:function(){var t=this;t.content.show(),t.content.css({position:"absolute",zIndex:t.settings.zIndex||999,width:t.input.outerWidth()}),t.setPostion(),t.postimer=setInterval(function(){t.setPostion()},20),t.settings.showCallback&&t.settings.showCallback.call(t,t.input,t.content)},hide:function(){this.postimer&&clearInterval(this.postimer),this.content.hide()},search:function(){var t=this,e=t.input.val().split(",").pop();if(e.length>=t.min||t.settings.autoShow)if("function"==typeof t.data)t.getData();else{var n=t.filter(t.data);t.format(n),t.show()}else t.hide()},getData:function(){var t=this;this.settings.data(function(e){t.format(e),t.show()})},format:function(e){if(this.content.html(""),e)for(var n=0,i=e.length;i>n;n++){var s=e[n],a=t();if(this.settings.format)a=t(this.settings.format.call(this,s));else{for(var o="",r=0,l=this.column.length;l>r;r++)o+='<span class="'+this.column[r]+'">'+s[this.column[r]]+"</span>";a=t('<div class="item">'+o+"</div>")}a.data("data",s),this.content.append(a)}},filter:function(t){for(var e=this,n=e.input.val().split(",").pop(),i=[],s=0,a=t.length;a>s;s++)for(var o=t[s],r=0,l=this.filterColumn.length;l>r;r++){var u=o[this.filterColumn[r]];-1!=u.toString().indexOf(n)&&i.push(o)}return i},setPostion:function(){var t=this,e=t.input.offset();t.content.css({top:e.top+t.input.outerHeight(),left:e.left})}},e});