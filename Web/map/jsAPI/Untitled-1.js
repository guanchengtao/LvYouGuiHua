///<jscompress sourcefile="utils.js" />
///<jscompress sourcefile="wholesearch.js" />

//贯穿整个地图 开放封装
///<jscompress sourcefile="roadsearch.js" />
/*路径导航*////<jscompress sourcefile="tools.js" />
/**
* 测量工具
**////<jscompress sourcefile="imageCluster.js" />
/**
* Created by 李鹏 on 2015/7/1.
*////<jscompress sourcefile="widgets.js" />

/*
*天气预报模型
*////<jscompress sourcefile="contrast.js" />
/**
* 地图对比
*/function parseUrl(k){var d={};k=k.split("\x26");for(var m=0;m<k.length;m++){var h=k[m].indexOf("\x3d");if(-1!=h){var l=k[m].substring(0,h),h=k[m].substring(h+1),h=decodeURIComponent(h);d[l.toUpperCase()]=h}}return d}function parseParam(k){var d=[],m;for(m in k)d.push(m+"\x3d"+k[m]);return d.join("\x26")}function isValid(k){return null!=k&&""!=k?!0:!1}String.prototype.ClipStr=function(k){null==k&&(k=14);k*=2;for(var d=0,m=0;m<this.length&&d<k;m++)this.charAt(m).match(/[^\x00-\xff]/ig)?d+=2:d+=1;return m<this.length?this.substr(0,m-2)+"...":this};String.prototype.Trim=function(){return this.replace(/^\s+/g,"").replace(/\s+$/g,"")};var Clone=function(k){var d;switch(typeof k){case "undefined":break;case "string":d=k+"";break;case "number":d=k-0;break;case "boolean":d=k;break;case "object":if(null===k)d=null;else if(k instanceof Array){d=[];for(var m=0,h=k.length;m<h;m++)d.push(Clone(k[m]))}else for(m in d={},k)d[m]=Clone(k[m]);break;default:d=k}return d};function Cookies(){this.get=function(k){for(var d=document.cookie.split(";"),m="",h=0;h<d.length;h++)if(d[h].Trim().substr(0,k.length)==k){m=d[h].Trim().substr(k.length+1);break}return unescape(m)};this.getChild=function(k,d){for(var m=this.get(k).split("\x26"),h="",l=0;l<m.length;l++)if(m[l].Trim().substr(0,d.length)==d){h=m[l].Trim().substr(d.length+1);break}return h};this.set=function(k,d,m,h,l){var f="";k&&(f+=k+"\x3d"+escape(d)+";");m&&(f+="expires\x3d"+m.toGMTString()+";");h&&(f+="domain\x3d"+h+";");l&&(f+="path\x3d"+l+";");document.cookie=f};this.remove=function(k){var d=new Date;d.setTime(d.getTime()-1E7);this.set(k,"",d)}}function setCookie(k,d){var m=new Date;m.setTime(m.getTime()+864E5);document.cookie=k+"\x3d"+escape(d)+";expires\x3d"+m.toGMTString()+";path\x3d/"}function getCookie(k){var d;return(d=document.cookie.match(new RegExp("(^| )"+k+"\x3d([^;]*)(;|$)")))?unescape(d[2]):null}function delCookie(k){var d=new Date;d.setTime(d.getTime()-1E4);var m=getCookie(k);null!=m&&(document.cookie=k+"\x3d"+escape(m)+";expires\x3d"+d.toGMTString()+";path\x3d/")}function string2xml(k){var d=null;window.ActiveXObject?(d=new ActiveXObject("Microsoft.XMLDOM"),d.loadXML(k)):window.XMLHttpRequest&&(d=(new DOMParser).parseFromString(k,"text/xml"));return d}Date.now||(Date.now=function(){return(new Date).valueOf()});var PageCtl=function(){function k(f,d){var a,c=[];if(d<f&&1<d)c.push("\x3cli class\x3d'pageon pageprev'\x3e\u4e0a\u4e00\u9875\x3c/li\x3e"),c.push("\x3cli class\x3d'pageon'\x3e"+(d-1)+"\x3c/li\x3e"),c.push("\x3cli class\x3d'pagenow'\x3e"+d+"\x3c/li\x3e"),c.push("\x3cli class\x3d'pageon'\x3e"+(d+1)+"\x3c/li\x3e"),3==d?c.splice(1,0,"\x3cli class\x3d'pageon'\x3e1\x3c/li\x3e"):3<d&&c.splice(1,0,"\x3cli class\x3d'pageon'\x3e1\x3c/li\x3e\x3cli class\x3d'pagepot'\x3e...\x3c/li\x3e"),d==f-2?c.push("\x3cli class\x3d'pageon'\x3e"+f+"\x3c/li\x3e"):d<f-2&&c.push("\x3cli class\x3d'pagepot'\x3e...\x3c/li\x3e\x3cli class\x3d'pageon'\x3e"+f+"\x3c/li\x3e"),c.push("\x3cli class\x3d'pageon pagenext'\x3e\u4e0b\u4e00\u9875\x3c/li\x3e");else if(1==d){c.push("\x3cli class\x3d'pageoff'\x3e\u4e0a\u4e00\u9875\x3c/li\x3e");c.push("\x3cli class\x3d'pagenow'\x3e1\x3c/li\x3e");if(5>f)for(a=1;a<f;a++)c.push("\x3cli class\x3d'pageon'\x3e"+(a+1)+"\x3c/li\x3e");else c.push("\x3cli class\x3d'pageon'\x3e2\x3c/li\x3e\x3cli class\x3d'pageon'\x3e3\x3c/li\x3e\x3cli class\x3d'pagepot'\x3e...\x3c/li\x3e\x3cli class\x3d'pageon'\x3e"+f+"\x3c/li\x3e");1==f?c.push("\x3cli class\x3d'pageoff'\x3e\u4e0b\u4e00\u9875\x3c/li\x3e"):c.push("\x3cli class\x3d'pageon pagenext'\x3e\u4e0b\u4e00\u9875\x3c/li\x3e")}else{c.push("\x3cli class\x3d'pageon pagenext'\x3e\u4e0a\u4e00\u9875\x3c/li\x3e");if(5>f)for(a=0;a<f-1;a++)c.push("\x3cli class\x3d'pageon'\x3e"+(a+1)+"\x3c/li\x3e");else c.push("\x3cli class\x3d'pageon'\x3e1\x3c/li\x3e\x3cli class\x3d'pagepot'\x3e...\x3c/li\x3e"),c.push("\x3cli class\x3d'pageon'\x3e"+(f-2)+"\x3c/li\x3e\x3cli class\x3d'pageon'\x3e"+(f-1)+"\x3c/li\x3e");c.push("\x3cli class\x3d'pagenow'\x3e"+f+"\x3c/li\x3e");c.push("\x3cli class\x3d'pageoff'\x3e\u4e0b\u4e00\u9875\x3c/li\x3e")}$("#"+m+" .page").html(c.join(""))}var d=0,m,h,l=10;return{init:function(f,g,a){m=f;a&&(l=a);"function"==typeof g?(h=g,$("#"+m).delegate(".pageon","click",function(a){a=$(this).text();var b=$("#"+m+" li.pagenow"),b=1>b.length?1:parseInt(b.text());a=isNaN(a)?"\u4e0a\u4e00\u9875"==a?b-1:b+1:parseInt(a);k(d,a);h(a,l)})):console.log&&console.log("\u521d\u59cb\u5316\u5931\u8d25\uff01")},doPage:function(f,g){null!=g&&(d=Math.ceil(g/l));k(d,f);h(f,l)},startEnd:function(d,g){var a=(d-1)*l;return[a,a+l>=g?g:a+l]}}},Browser=function(){var k=navigator.userAgent.toLowerCase(),d=window.opera,m={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(k),opera:!!d&&d.version,webkit:-1<k.indexOf(" applewebkit/"),mac:-1<k.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode,isphone:!!navigator.userAgent.match(/(iPhone|iPod|Android|ios|iOS|iPad|Backerry|WebOS|Symbian|Windows Phone|Phone)/i)};m.gecko="Gecko"==navigator.product&&!m.webkit&&!m.opera&&!m.ie;var h=0;if(m.ie){var h=k.match(/(?:msie\s([\w.]+))/),l=k.match(/(?:trident.*rv:([\w.]+))/),h=h&&l&&h[1]&&l[1]?Math.max(1*h[1],1*l[1]):h&&h[1]?1*h[1]:l&&l[1]?1*l[1]:0;m.ie11Compat=11==document.documentMode;m.ie9Compat=9==document.documentMode;m.ie10Compat=10==document.documentMode;m.ie8=!!document.documentMode;m.ie8Compat=8==document.documentMode;m.ie7Compat=7==h&&!document.documentMode||7==document.documentMode;m.ie6Compat=7>h||m.quirks;m.ie9above=8<h;m.ie9below=9>h}m.gecko&&(l=k.match(/rv:([\d\.]+)/))&&(l=l[1].split("."),h=1E4*l[0]+100*(l[1]||0)+1*(l[2]||0));/chrome\/(\d+\.\d)/i.test(k)&&(m.chrome=+RegExp.$1);/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(k)&&!/chrome/i.test(k)&&(m.safari=+(RegExp.$1||RegExp.$2));m.opera&&(h=parseFloat(d.version()));m.webkit&&(h=parseFloat(k.match(/ applewebkit\/(\d+)/)[1]));m.version=h;return m}(),WebHost=window.location.host,DynamicLoading=DynamicLoading||{css:function(k,d){if(!k||0===k.length)throw Error('argument "path" is required !');d||(d=window);var m=d.document.getElementsByTagName("head")[0],h=d.document.createElement("link");h.href=k;h.rel="stylesheet";h.type="text/css";m.appendChild(h)},js:function(k,d){if(!k||0===k.length)throw Error('argument "path" is required !');d||(d=window);var m=d.document.getElementsByTagName("head")[0],h=d.document.createElement("script");h.src=k;h.type="text/javascript";m.appendChild(h)}};$(function(){SetCalcValue()});$(window).resize(function(){SetCalcValue()});function SetCalcValue(){$("[data-calc-height]").each(function(){var k=$(this),d=k.parent(),m=k.attr("data-calc-height");k.height(GetCalcValue(m,d.height()))});$("[data-calc-width]").each(function(){var k=$(this),d=k.parent(),m=k.attr("data-calc-width");k.width(GetCalcValue(m,d.width()))});$("[data-calc-left]").each(function(){var k=$(this),d=k.parent(),m=k.attr("data-calc-left");k.css("left",GetCalcValue(m,d.width())+"px")})}function GetCalcValue(k,d){var m=k.split("-");return.01*d*parseInt(m[0].replace("%"))-parseFloat(m[1])}window.Util||(window.Util={});window.Util.MD5||(window.Util.MD5=function(k){function d(a){str="";for(j=0;3>=j;j++)str+="0123456789abcdef".charAt(a>>8*j+4&15)+"0123456789abcdef".charAt(a>>8*j&15);return str}function m(a,c){var b=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(b>>16)<<16|b&65535}function h(a,c,b,e,d,f){a=m(m(c,a),m(e,f));return m(a<<d|a>>>32-d,b)}function l(a,c,b,e,d,f,u){return h(c&b|~c&e,a,c,d,f,u)}function f(a,c,b,e,d,f,u){return h(c&e|b&~e,a,c,d,f,u)}function g(a,c,b,e,d,f,u){return h(b^(c|~e),a,c,d,f,u)}return function(a){nblk=(a.length+8>>6)+1;blks=Array(16*nblk);for(i=0;i<16*nblk;i++)blks[i]=0;for(i=0;i<a.length;i++)blks[i>>2]|=a.charCodeAt(i)<<i%4*8;blks[i>>2]|=128<<i%4*8;blks[16*nblk-2]=8*a.length;x=blks;a=1732584193;var c=-271733879,b=-1732584194,e=271733878;for(i=0;i<x.length;i+=16){var v=a,w=c,u=b,y=e;a=l(a,c,b,e,x[i+0],7,-680876936);e=l(e,a,c,b,x[i+1],12,-389564586);b=l(b,e,a,c,x[i+2],17,606105819);c=l(c,b,e,a,x[i+3],22,-1044525330);a=l(a,c,b,e,x[i+4],7,-176418897);e=l(e,a,c,b,x[i+5],12,1200080426);b=l(b,e,a,c,x[i+6],17,-1473231341);c=l(c,b,e,a,x[i+7],22,-45705983);a=l(a,c,b,e,x[i+8],7,1770035416);e=l(e,a,c,b,x[i+9],12,-1958414417);b=l(b,e,a,c,x[i+10],17,-42063);c=l(c,b,e,a,x[i+11],22,-1990404162);a=l(a,c,b,e,x[i+12],7,1804603682);e=l(e,a,c,b,x[i+13],12,-40341101);b=l(b,e,a,c,x[i+14],17,-1502002290);c=l(c,b,e,a,x[i+15],22,1236535329);a=f(a,c,b,e,x[i+1],5,-165796510);e=f(e,a,c,b,x[i+6],9,-1069501632);b=f(b,e,a,c,x[i+11],14,643717713);c=f(c,b,e,a,x[i+0],20,-373897302);a=f(a,c,b,e,x[i+5],5,-701558691);e=f(e,a,c,b,x[i+10],9,38016083);b=f(b,e,a,c,x[i+15],14,-660478335);c=f(c,b,e,a,x[i+4],20,-405537848);a=f(a,c,b,e,x[i+9],5,568446438);e=f(e,a,c,b,x[i+14],9,-1019803690);b=f(b,e,a,c,x[i+3],14,-187363961);c=f(c,b,e,a,x[i+8],20,1163531501);a=f(a,c,b,e,x[i+13],5,-1444681467);e=f(e,a,c,b,x[i+2],9,-51403784);b=f(b,e,a,c,x[i+7],14,1735328473);c=f(c,b,e,a,x[i+12],20,-1926607734);a=h(c^b^e,a,c,x[i+5],4,-378558);e=h(a^c^b,e,a,x[i+8],11,-2022574463);b=h(e^a^c,b,e,x[i+11],16,1839030562);c=h(b^e^a,c,b,x[i+14],23,-35309556);a=h(c^b^e,a,c,x[i+1],4,-1530992060);e=h(a^c^b,e,a,x[i+4],11,1272893353);b=h(e^a^c,b,e,x[i+7],16,-155497632);c=h(b^e^a,c,b,x[i+10],23,-1094730640);a=h(c^b^e,a,c,x[i+13],4,681279174);e=h(a^c^b,e,a,x[i+0],11,-358537222);b=h(e^a^c,b,e,x[i+3],16,-722521979);c=h(b^e^a,c,b,x[i+6],23,76029189);a=h(c^b^e,a,c,x[i+9],4,-640364487);e=h(a^c^b,e,a,x[i+12],11,-421815835);b=h(e^a^c,b,e,x[i+15],16,530742520);c=h(b^e^a,c,b,x[i+2],23,-995338651);a=g(a,c,b,e,x[i+0],6,-198630844);e=g(e,a,c,b,x[i+7],10,1126891415);b=g(b,e,a,c,x[i+14],15,-1416354905);c=g(c,b,e,a,x[i+5],21,-57434055);a=g(a,c,b,e,x[i+12],6,1700485571);e=g(e,a,c,b,x[i+3],10,-1894986606);b=g(b,e,a,c,x[i+10],15,-1051523);c=g(c,b,e,a,x[i+1],21,-2054922799);a=g(a,c,b,e,x[i+8],6,1873313359);e=g(e,a,c,b,x[i+15],10,-30611744);b=g(b,e,a,c,x[i+6],15,-1560198380);c=g(c,b,e,a,x[i+13],21,1309151649);a=g(a,c,b,e,x[i+4],6,-145523070);e=g(e,a,c,b,x[i+11],10,-1120210379);b=g(b,e,a,c,x[i+2],15,718787259);c=g(c,b,e,a,x[i+9],21,-343485551);a=m(a,v);c=m(c,w);b=m(b,u);e=m(e,y)}return d(a)+d(c)+d(b)+d(e)}(k)});var Service=function(){return{Proxy:"proxy/proxy.ashx?",DebugProxy:"",LS:"http://www.sdmap.gov.cn/QueryService.ashx?city\x3d"+encodeURIComponent("\u5168\u56fd")+"\x26output\x3djson\x26resultmode\x3d255\x26uid\x3dnavinfo\x26st\x3dLocalSearch\x26",LSID:"http://www.sdmap.gov.cn/QueryService.ashx?city\x3d"+encodeURIComponent("\u5168\u56fd")+"\x26st\x3dObtain\x26output\x3djson\x26resultmode\x3d255\x26uid\x3dnavinfo\x26",PATH:"http://www.sdmap.gov.cn/SDPathService.ashx?st\x3dRC\x26output\x3djson\x26sl\x3d0\x26uid\x3dnavinfo\x26",RGC2:"http://www.sdmap.gov.cn/GeoDecodeService.ashx?st\x3dRgc2\x26output\x3djson\x26",CorrectDir:"../correct/",basemap:[{group:"vec",name:"\u5929\u5730\u56fe-\u77e2\u91cf",url:"http://t0.tianditu.com/vec_c/wmts",layer:"vec",style:"default",matrixSet:"c",format:"tiles",open:!0,maxlevel:10},{group:"vec_n",name:"\u5929\u5730\u56fe-\u77e2\u91cf\u6ce8\u8bb0",url:"http://t0.tianditu.com/cva_c/wmts",layer:"cva",style:"default",matrixSet:"c",format:"tiles",open:!0,maxlevel:10},{group:"vec",name:"\u5c71\u4e1c\u77e2\u91cf\u5730\u56fe",url:"http://www.sdmap.gov.cn/tileservice/SDPubMap",layer:"sdvec",style:"default",matrixSet:"c",format:"image/png",open:!0,minlevel:7},{group:"img",name:"\u5929\u5730\u56fe-\u5f71\u50cf\u5730\u56fe",url:"http://t0.tianditu.com/img_c/wmts",layer:"img",style:"default",matrixSet:"c",format:"tiles",open:!1,maxlevel:10},{group:"img",name:"\u5c71\u4e1c\u5f71\u50cf2018",url:"http://www.sdmap.gov.cn/tileservice/SdRasterPubMap",layer:"sdimg2017",style:"default",matrixSet:"img2017",format:"image/png",open:!1,minlevel:7},{group:"img_n",name:"\u5929\u5730\u56fe-\u5f71\u50cf\u6ce8\u8bb0",url:"http://t0.tianditu.com/cia_c/wmts",layer:"cia",style:"default",matrixSet:"c",format:"tiles",open:!1,maxlevel:6},{group:"img_n",name:"\u5c71\u4e1c\u5f71\u50cf\u6ce8\u8bb0",url:"http://www.sdmap.gov.cn/tileservice/SDRasterPubMapDJ",layer:"sdcia",style:"default",matrixSet:"sdcia",format:"image/png",open:!1,minlevel:7}],DOWNLOAD:"proxy/proxy.ashx?http://124.128.48.212:8081/MapPlotService/TDTPlotsHandler.ashx?",UserPlot:"http://www.sdmap.gov.cn/SDMapService/UserPlotsManage.svc/",CityService:"http://www.sdmap.gov.cn/CityExtentService/CityHandler.ashx",POITILE:"http://www.sdmap.gov.cn/tileservice/sdpoi?service\x3dpoi\x26request\x3dgetpoi\x26tileMatrixSet\x3dsss\x26format\x3dtext/html",IMGMETA:"http://www.sdmap.gov.cn/ImgMetaService/QueryMeta.ashx?",NCM:["vec","cva","img","cia","sdcia"],RTService:"http://www.sdmap.gov.cn/RTService/RTService.ashx?",RTServiceRiver:"http://www.sdmap.gov.cn/RTService/RTServiceRiver.ashx?",RTRoadWMTSService:"http://124.128.48.212:6080/arcgis/rest/services/ssjt/MapServer/WMTS",RTRoadWMSService:"http://124.128.48.217:6080/arcgis/services/ssjt/ssjt/MapServer/WMSServer",RTServiceStatistics:"http://www.sdmap.gov.cn/RTService/RTServiceStatistics.ashx?",ResourceList:"http://www.sdmap.gov.cn/SDMapService/LayerTree.svc/GetAllLayers"}}(),PoiInfoPop=function(){function k(a){if("ok"==a.status&&(a=a.result)){var c=String(a.district_text).split("\x3e").join("").replace("\u5e02\u8f96\u533a","").replace("\u5c71\u4e1c\u7701",""),e="";a.road&&""!=a.road.name&&(e=a.road.name);var d="";a.address&&(d=a.address);a.point&&""!=a.point.name?$("#markName").text(a.point.name+"\u9644\u8fd1"):$("#markName").text(c+e);$("#right_pointNameInfo").html("\x3cdiv id\x3d'address'\x3e\u5730\u5740:"+c+e+d+"\x3c/div\x3e");b.updateSize()}}function d(a){var c=$("#tabs\x3eul:eq(0)").offset();$("#poiSearch_suglist").empty().append(a).show().css({left:c.left+45+"px",top:c.top+65+"px"}).children("div").click(l)}function m(){$("#pointFromText").keyup(function(a){(a=$(this).val())&&WholeSearch.request("list",{words:a},d)});$("#pointToText").keyup(function(a){(a=$(this).val())&&WholeSearch.request("list",{words:a},d)});$("#pointFromButton").click(function(){a.attributes={name:$("#markName").text()};PathSearch.setStart(e,3);PathSearch.setEnd(a,3)});$("#pointToButton").click(function(){a.attributes={name:$("#markName").text()};PathSearch.setStart(a,3);PathSearch.setEnd(e,3)});$("#pointPopupSearchBtn").click(function(){$("#left_query_text").val(a.attributes.name);var c=$("#pointSearch").val();if(c){switchSearch("s2");var b=a.geometry,e=parseInt($("#selectRadius").val()),d="POINT("+b.x+" "+b.y+")",t={};a.attributes.geometry&&(t=h(a.attributes.geometry,e),d=-1<a.attributes.geometry.indexOf("POLYGON")?t.bufwkt:t.orgwkt);WholeSearch.request("buffer",{words:c,radius:e,area:d,mode:1,pagecap:100});PoiInfoPop.close();a.attributes.geometry?DragMoveCtl.creatbuffer(t.orgfea,t.buffea):DragMoveCtl.setCircle(b,e)}});$("#tabs3 \x3e .pointPopupBtn").click(function(){$("#left_query_text").val(a.attributes.name);var c=$(this).attr("code");switchSearch("s2");var b=a.geometry,e=parseInt($("#selectRadius").val()),d="POINT("+b.x+" "+b.y+")",t={};a.attributes.geometry&&(t=h(a.attributes.geometry,e),d=-1<a.attributes.geometry.indexOf("POLYGON")?t.bufwkt:t.orgwkt);WholeSearch.request("buffer",{"class":c,radius:e,area:d,mode:1,pagecap:100});PoiInfoPop.close();a.attributes.geometry?DragMoveCtl.creatbuffer(t.orgfea,t.buffea):DragMoveCtl.setCircle(b,e)});$("#poi_correct").click(function(){var c=a.attributes;MapCorrect.openCorrect(c.lsid?{TYPE:1,LSID:c.lsid}:{NAME:c.name,ADDR:c.address,TELE:c.telephone,CATG:c.catg,TYPE:3,FID:c.id,SRC:1,LNG:a.geometry.x,LAT:a.geometry.y})})}function h(a,c){var b={},e=new OpenLayers.Format.WKT,d=new OpenLayers.Format.GeoJSON,q=e.read(a),p=d.write(q),p=turf.buffer(JSON.parse(p),6.2137E-4*c,"miles"),d=d.read(p),e=e.write(d);b.orgfea=q;b.orgwkt=a.replace("((","(").replace("))",")");b.buffea=d;b.bufwkt=e.replace("((","(").replace("))",")");return b}function l(){var a=$(this).attr("crd").split(";");e=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(a[0]),parseFloat(a[1])));a=a[3];e.attributes={name:a};$("#tabs\x3ediv:visible :text").val(a);$("#poiSearch_suglist").hide()}function f(){g.unSelect();b&&g.map.removePopup(b);DragMoveCtl.clear()}var g,a,c=!1,b,e;return{init:function(a){c||(g=a,0==$("#poiSearch_suglist").length&&($(document.body).append("\x3cdiv id\x3d'poiSearch_suglist' style\x3d'position:absolute;display:none;'\x3e\x3c/div\x3e"),$("#poiSearch_suglist").delegate("a","click",function(){$("#poiSearch_suglist").hide()})),DragMoveCtl.init(g.map,WholeSearch.request),c=!0)},show:function(c,e,d,y){e=new Ol2.LonLat(e.lon||e.x,e.lat||e.y);var t;null!=b&&g.map.removePopup(b);switch(c){case "local":b=new Ol2.Popup.FramedCloud("\u641c\u7d22",e,null,'\x3cdiv id\x3d"poi_pop_info" style \x3d "min-height:90px;width:333px;font-size:12px;"\x3e\x3cdiv id \x3d "mark_title"\x3e\x3cdiv id\x3d"markName" style\x3d"padding-left:10px;font-size:14px;color:#3b9cfe;font-weight:700;margin-top:-2px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "pointPopupContent" style \x3d "margin-top:10px;display:block"\x3e\x3cdiv id\x3d"right_pointNameInfo"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,f);g.map.addPopup(b);t=[];""==d.address||d.geometry||t.push("\x3cdiv id\x3d'address'\x3e\u5730\u5740:"+d.address+"\x3c/div\x3e");""==d.telephone||d.geometry||t.push("\x3cdiv id\x3d'phone'\x3e\u7535\u8bdd:"+d.telephone+"\x3c/div\x3e");if(d.geometry&&-1<d.geometry.indexOf("LINESTRING")){c=d.lsid.split(",");y=[];for(var q=0;q<c.length;q++)y.push("\u5b9e\u4f53\u7801%3D%27"+c[q]+"%27");url="http://124.128.48.217:6080/arcgis/rest/services/gjfx/MapServer/0/query?where\x3d"+y.join("+or+")+"\x26text\x3d\x26objectIds\x3d\x26time\x3d\x26geometry\x3d\x26geometryType\x3desriGeometryEnvelope\x26inSR\x3d\x26spatialRel\x3desriSpatialRelIntersects\x26relationParam\x3d\x26outFields\x3d\u7a7f\u8d8a\u5730\u5e02\u540d%2C\u7a7f\u8d8a\u5730\u5e02\u6570%2C\u7a7f\u8d8a\u53bf\u533a\u6570%2C\u7a7f\u8d8a\u53bf\u533a\u540d\x26returnGeometry\x3dfalse\x26maxAllowableOffset\x3d\x26geometryPrecision\x3d\x26outSR\x3d\x26returnIdsOnly\x3dfalse\x26returnCountOnly\x3dfalse\x26orderByFields\x3d\x26groupByFieldsForStatistics\x3d\x26outStatistics\x3d\x26returnZ\x3dfalse\x26returnM\x3dfalse\x26gdbVersion\x3d\x26returnDistinctValues\x3dfalse\x26f\x3dpjson";$.ajax({dataType:"json",async:!1,url:url,success:function(a){for(var c=[],e=[],b=0;b<a.features.length;b++)c.push(a.features[b].attributes.\u7a7f\u8d8a\u5730\u5e02\u540d),e.push(a.features[b].attributes.\u7a7f\u8d8a\u53bf\u533a\u540d);a=c.join(",");e=e.join(",");t.push("\x3cdiv id\x3d'phone'\x3e\u7a7f\u8d8a\u5730\u5e02:"+a+"\x3c/div\x3e");t.push("\x3cdiv id\x3d'phone'\x3e\u7a7f\u8d8a\u53bf\u533a:"+e+"\x3c/div\x3e")}})}$("#right_pointNameInfo").append(t.join(""));$("#pointPopupContent").append('\x3cdiv id\x3d"tabs"\x3e\x3cul\x3e\x3cli id \x3d "tabs-li1"\x3e\x3ca href\x3d"#tabs1" class\x3d"selected"\x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5230\u8fd9\u91cc\u53bb    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li2"\x3e\x3ca href\x3d"#tabs2" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u4ece\u8fd9\u91cc\u51fa\u53d1    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li3"\x3e\x3ca href\x3d"#tabs3" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5468\u8fb9\u641c\u7d22    \x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv id\x3d"tabs1" class \x3d "pointTabDiv"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u8d77\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointFromText"\x3e\x3cinput type\x3d"button" id\x3d"pointFromButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs2"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u7ec8\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointToText"\x3e\x3cinput type \x3d"button" id\x3d"pointToButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs3"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"5080 5082:5085 5380 5501 5502 5400" value \x3d"\u5bbe\u9986"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"A180:A192 A195:A19C" value \x3d"\u94f6\u884c"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"7200 7203:7206 7280 7281 7500" value \x3d"\u533b\u9662"\x3e\x3cinput type \x3d "text" id \x3d "pointSearch" style \x3d "width:80px"\x3e\x3cselect name\x3d"selectAge" id\x3d"selectRadius" style\x3d"height:23px;margin-left:2px;border: #b3b3b3 solid 1px;"\x3e\x3coption value\x3d"500"\x3e500\u7c73\x3c/option\x3e\x3coption value\x3d"800"\x3e800\u7c73\x3c/option\x3e\x3coption value\x3d"1000"\x3e1000\u7c73\x3c/option\x3e\x3coption value\x3d"2000"\x3e2000\u7c73\x3c/option\x3e\x3coption value\x3d"5000"\x3e5000\u7c73\x3c/option\x3e\x3c/select\x3e\x3cinput type \x3d"button" value \x3d "\u641c\u7d22" id \x3d "pointPopupSearchBtn" class \x3d "btnSmall"  style\x3d"margin:-5px 0 0 4px" \x3e\x3c/div\x3e\x3c/div\x3e');$("#mark_title").append("\x3cdiv id\x3d'poi_correct' title\x3d'\u7ea0\u9519'\x3e\x3c/div\x3e");$("#poi_pop_info").css({width:"333px"});$("#markName").text(d.name);break;case "around":b=new Ol2.Popup.FramedCloud("\u641c\u7d22",e,null,'\x3cdiv id\x3d"poi_pop_info" style \x3d "min-height:90px;width:333px;font-size:12px;"\x3e\x3cdiv id \x3d "mark_title"\x3e\x3cdiv id\x3d"markName" style\x3d"padding-left:10px;font-size:14px;color:#3b9cfe;font-weight:700;margin-top:-2px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "pointPopupContent" style \x3d "margin-top:10px;display:block"\x3e\x3cdiv id\x3d"right_pointNameInfo"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,f);b.autoSize=!0;g.map.addPopup(b);$("#poi_pop_info").css({width:"333px",height:"100px"});b.updateSize();$("#pointPopupContent").append('\x3cdiv id\x3d"tabs"\x3e\x3cul\x3e\x3cli id \x3d "tabs-li1"\x3e\x3ca href\x3d"#tabs1" class\x3d"selected"\x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5230\u8fd9\u91cc\u53bb    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li2"\x3e\x3ca href\x3d"#tabs2" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u4ece\u8fd9\u91cc\u51fa\u53d1    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li3"\x3e\x3ca href\x3d"#tabs3" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5468\u8fb9\u641c\u7d22    \x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv id\x3d"tabs1" class \x3d "pointTabDiv"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u8d77\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointFromText"\x3e\x3cinput type\x3d"button" id\x3d"pointFromButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs2"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u7ec8\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointToText"\x3e\x3cinput type \x3d"button" id\x3d"pointToButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs3"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"5080 5082:5085 5380 5501 5502 5400" value \x3d"\u5bbe\u9986"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"A180:A192 A195:A19C" value \x3d"\u94f6\u884c"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"7200 7203:7206 7280 7281 7500" value \x3d"\u533b\u9662"\x3e\x3cinput type \x3d "text" id \x3d "pointSearch" style \x3d "width:80px"\x3e\x3cselect name\x3d"selectAge" id\x3d"selectRadius" style\x3d"height:23px;margin-left:2px;border: #b3b3b3 solid 1px;"\x3e\x3coption value\x3d"500"\x3e500\u7c73\x3c/option\x3e\x3coption value\x3d"800"\x3e800\u7c73\x3c/option\x3e\x3coption value\x3d"1000"\x3e1000\u7c73\x3c/option\x3e\x3coption value\x3d"2000"\x3e2000\u7c73\x3c/option\x3e\x3coption value\x3d"5000"\x3e5000\u7c73\x3c/option\x3e\x3c/select\x3e\x3cinput type \x3d"button" value \x3d "\u641c\u7d22" id \x3d "pointPopupSearchBtn" class \x3d "btnSmall"  style\x3d"margin:-5px 0 0 4px" \x3e\x3c/div\x3e\x3c/div\x3e');WholeSearch.request("rgc2",{point:e.lon+","+e.lat,type:1},k);$("#markName").text("\u672a\u77e5\u5730\u70b9");break;case "plotinfo":b=new Ol2.Popup.FramedCloud("\u6807\u6ce8\u4fe1\u606f",e,null,'\x3cdiv id\x3d"poi_pop_info" style \x3d "min-height:90px;width:333px;font-size:12px;"\x3e\x3cdiv id \x3d "mark_title"\x3e\x3cdiv id\x3d"markName" style\x3d"padding-left:10px;font-size:14px;color:#3b9cfe;font-weight:700;margin-top:-2px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "pointPopupContent" style \x3d "margin-top:10px;display:block"\x3e\x3cdiv id\x3d"right_pointNameInfo"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,f);g.map.addPopup(b);"point"==d.type&&($("#pointPopupContent").append('\x3cdiv id\x3d"tabs"\x3e\x3cul\x3e\x3cli id \x3d "tabs-li1"\x3e\x3ca href\x3d"#tabs1" class\x3d"selected"\x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5230\u8fd9\u91cc\u53bb    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li2"\x3e\x3ca href\x3d"#tabs2" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u4ece\u8fd9\u91cc\u51fa\u53d1    \x3c/a\x3e\x3c/li\x3e\x3cli id \x3d "tabs-li3"\x3e\x3ca href\x3d"#tabs3" \x3e\x3cimg src\x3d"images/blank.gif"/\x3e\u5468\u8fb9\u641c\u7d22    \x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv id\x3d"tabs1" class \x3d "pointTabDiv"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u8d77\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointFromText"\x3e\x3cinput type\x3d"button" id\x3d"pointFromButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs2"\x3e\x3cspan style\x3d"margin-right:4px;"\x3e\u7ec8\u70b9\x3c/span\x3e\x3cinput type\x3d"text" id\x3d"pointToText"\x3e\x3cinput type \x3d"button" id\x3d"pointToButton" class\x3d"btnSmall" style\x3d"margin:-5px 0 0 10px" value\x3d"\u9a7e\u8f66"\x3e\x3c/div\x3e\x3cdiv id\x3d"tabs3"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"5080 5082:5085 5380 5501 5502 5400" value \x3d"\u5bbe\u9986"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"A180:A192 A195:A19C" value \x3d"\u94f6\u884c"\x3e\x3cinput type \x3d "button" class \x3d "pointPopupBtn" code\x3d"7200 7203:7206 7280 7281 7500" value \x3d"\u533b\u9662"\x3e\x3cinput type \x3d "text" id \x3d "pointSearch" style \x3d "width:80px"\x3e\x3cselect name\x3d"selectAge" id\x3d"selectRadius" style\x3d"height:23px;margin-left:2px;border: #b3b3b3 solid 1px;"\x3e\x3coption value\x3d"500"\x3e500\u7c73\x3c/option\x3e\x3coption value\x3d"800"\x3e800\u7c73\x3c/option\x3e\x3coption value\x3d"1000"\x3e1000\u7c73\x3c/option\x3e\x3coption value\x3d"2000"\x3e2000\u7c73\x3c/option\x3e\x3coption value\x3d"5000"\x3e5000\u7c73\x3c/option\x3e\x3c/select\x3e\x3cinput type \x3d"button" value \x3d "\u641c\u7d22" id \x3d "pointPopupSearchBtn" class \x3d "btnSmall"  style\x3d"margin:-5px 0 0 4px" \x3e\x3c/div\x3e\x3c/div\x3e'),$("#poi_pop_info").css({width:"333px"}));break;case "plotedit":b=new Ol2.Popup.FramedCloud("\u6807\u6ce8\u4fe1\u606f",e,null,'\x3cdiv id\x3d"poi_pop_info" style \x3d "min-height:90px;width:333px;font-size:12px;"\x3e\x3cdiv id \x3d "mark_title"\x3e\x3cdiv id\x3d"markName" style\x3d"padding-left:10px;font-size:14px;color:#3b9cfe;font-weight:700;margin-top:-2px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "pointPopupContent" style \x3d "margin-top:10px;display:block"\x3e\x3cdiv id\x3d"right_pointNameInfo"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,f);b.autoSize=!0;g.map.addPopup(b);$("#poi_pop_info").css({width:"313px"});break;case "resourcelist":b=new Ol2.Popup.FramedCloud("\u641c\u7d22",e,null,'\x3cdiv id\x3d"poi_pop_info" style \x3d "min-height:90px;width:333px;font-size:12px;"\x3e\x3cdiv id \x3d "mark_title"\x3e\x3cdiv id\x3d"markName" style\x3d"padding-left:10px;font-size:14px;color:#3b9cfe;font-weight:700;margin-top:-2px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "pointPopupContent" style \x3d "margin-top:10px;display:block"\x3e\x3cdiv id\x3d"right_pointNameInfo"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,f),c=50,t="\x3cdiv class\x3d'resource_detail'\x3e",$.each(d,function(a){if("OBJECTID"!=a.toUpperCase()&&"OBJECTID_1"!=a.toUpperCase()&&0>a.indexOf("\u540d\u79f0")&&"NAME"!=a.toUpperCase()&&0>a.toUpperCase().indexOf("SHAPE")){if("Null"==d[a])return!0;t+=a+":"+d[a]+"\x3cbr/\x3e"}}),t+="\x3c/div\x3e",b.autoSize=!0,g.map.addPopup(b),c=40*d.length+25+"px",$("#poi_pop_info").css("height",c+"px"),b.updateSize(),$("#right_pointNameInfo").append(t),$("#markName").text(d.NAME||d.\u540d\u79f0)}a=new Ol2.Feature.Vector(new Ol2.Geometry.Point(e.lon,e.lat),d);$("#tabs ul").idTabs();$("#tabs-li3 a").click();b.updateSize();m()},close:f,clear:function(){DragMoveCtl.clear()},resize:function(){b.updateSize();b.panIntoView()}}}(),ImgMetaCtl=function(){function k(){if(p){var a=$(this),c=a.attr("lid");t=c;$("#metalist :radio").removeAttr("checked");a.find(":radio")[0].checked=!0;u.tileLayerManager.setVisibility("img",!1);q&&u.removeLayer(q);for(var e in r)if(r[e].lid==c){r[e].format="image/png";r[e].layer="c";r[e].matrixSet="c";r[e].style="c";q=new Ol2.Layer.WMTS(r[e]);u.addLayer(q);u.map.setLayerIndex(q,1);break}h()}}function d(c){p&&(q&&u.removeLayer(q),q=null,"img"==c?(t=0,isImg=!0,a(),$("#stImgmetaInfo").show()):($("#stImgmetaInfo").hide(),isImg=!1))}function m(a){a&&0!=a.length?(r=a,r.sort(g),h()):($("#metainfo").text("\u5f53\u524d\u56fe\u5c42\u8303\u56f4\u65e0\u5f71\u50cf\u5143\u6570\u636e\u4fe1\u606f\uff01"),$("#metalist ul").empty(),r=[])}function h(){var a,c,b,p=0;0!=t&&(p=l(r,t,"lid"),-1==p&&$("#metainfo").text("\u5f53\u524d\u56fe\u5c42\u8303\u56f4\u65e0\u5f71\u50cf\u5143\u6570\u636e\u4fe1\u606f\uff01"));var n=[];w=[];for(a=0;a<r.length;a++){c=r[a];b=f(c.st);0!=c.et&&(b+="-"+f(c.et));b+=","+c.reso+"\u7c73";var d={};d.str=b;d.grp=c.lid;if(-1!=p&&c.lid==r[p].lid)0<w.length&&w[w.length-1].str==d.str&&w.splice(w.length-1,1),d.isChoosed=!0,b="\u5f71\u50cf\u83b7\u53d6\u65f6\u95f4\uff1a"+f(c.st),0!=c.et&&(b+="~"+f(c.et)),$("#metainfo").text(b+","+c.reso+"\u7c73"),n.push("\x3cli lid\x3d'"+d.grp+"'\x3e\x3cinput type\x3d'radio' name\x3d'souce_radio' checked\x3d'checked' /\x3e"+d.str+"\x3c/li\x3e");else{if(0<w.length&&w[w.length-1].str==d.str)continue;n.push("\x3cli lid\x3d'"+d.grp+"'\x3e\x3cinput type\x3d'radio' name\x3d'souce_radio'  /\x3e"+d.str+"\x3c/li\x3e");d.isChoosed=!1}w.push(d)}$("#metalist ul").empty().append(n.join(""));e||$("#meta_hand").show();v&&($("#meta_hand").hide(),$("#metalist").show(),v=!1,setTimeout(function(){e||($("#metalist").hide(),$("#meta_hand").show())},3E3))}function l(a,c,b){for(var e=0;e<a.length;e++)if(a[e][b]==c)return e;return-1}function f(a){var c=a.toString(),e;6==c.length?e=c.substr(0,4)+"\u5e74"+a%100+"\u6708":4==c.length&&(e=c+"\u5e74");return e}function g(a,c){return a.st.toString()>c.st.toString()?-1:a.st.toString()<c.st.toString()?1:0}function a(){var a=u.map.getCenter();$.ajax({url:b+"wktpoint\x3d"+("POINT("+a.lon+" "+a.lat+")")+"\x26level\x3d"+u.map.zoom,success:m,dataType:"jsonp"})}function c(){p&&(!isImg||6>u.map.zoom||a())}var b="",e="",v=!0,w=[],u,y=!1,t,q,p=!0,r=[];return{init:function(a,p){y||(b=a,u=p,u.map.events.on({moveend:c,scope:this}),$("#refrenceDiv").after("\x3cdiv id\x3d'stImgmetaInfo'\x3e    \x3cdiv id\x3d'metalist'\x3e        \x3cdiv style\x3d'position: relative'\x3e\x3clabel\x3e\u5f53\u524d\u8303\u56f4\u5386\u53f2\u5f71\u50cf\x3c/label\x3e\x3cimg id\x3d'imgmeta_spin' width\x3d'15px' src\x3d'images/spin.png' style\x3d'right: 10px'/\x3e\x3c/div\x3e\x3chr/\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e   \x3cdiv\x3e\x3cimg id\x3d'meta_hand' src\x3d'images/clickr.gif' width\x3d'26px'/\x3e\x3cspan id\x3d'metainfo'\x3e\x3c/span\x3e\x3c/div\x3e \x3c/div\x3e"),$("#metalist").on("click","li",null,k),$("#metainfo").mouseover(function(){1>w.length||($("#meta_hand").hide(),$("#metalist").fadeIn(500))}),$("#stImgmetaInfo").mouseleave(function(){e||($("#metalist").fadeOut(500),$("#meta_hand").show())}),$("#imgmeta_spin").click(function(){e?($(this).attr({src:"images/spin.png",width:"15px"}),e=""):($(this).attr({src:"images/spin1.png",width:"9px"}),e="1")}),u.tileLayerManager.addListener(d),y=!0)},setActive:function(a){p=!!a}}}(),Plotting=function(){function k(){var a=["\x3cdiv id\x3d'pointmark_imgdiv'\x3e\x3cul id\x3d'ulPoint'\x3e"],c;for(c=0;c<H.length;c++)a.push("\x3cli\x3e\x3cimg src\x3d'images/mark2/"+H[c]+".png' class\x3d'sp_12'\x3e\x3c/li\x3e");a.push("\x3c/ul\x3e\x3cdiv id\x3d'pointImgRtn' class\x3d'toolbtn' style\x3d'position:relative;margin:auto;display:block;'  \x3e\u8fd4\u56de\x3c/div\x3e");return a.join("")}function d(a){z.removeAllFeatures();var c=[];G=[];if(0<a.length){for(var n=new Ol2.Bounds,e=0;e<a.length;e++){var b=a[e];c.push('\x3cli id\x3d"'+b.ID+'"\x3e\x3cinput type\x3d"checkbox"\x3e\x3cimg src\x3d"images/mark2/plot_'+b.STYLE.type+'.png"\x3e '+b.TITLE+"\x3c/li\x3e");var d=null,p=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),r=b.GEOMETRY.isWKT,q=new Ol2.Format.WKT;"point"==b.STYLE.type&&(d=r?q.read(b.GEOMETRY.WKT):new Ol2.Feature.Vector(new Ol2.Geometry.Point(b.GEOMETRY.GEOMETRY[0].x,b.GEOMETRY.GEOMETRY[0].y)),p.graphicWidth=b.STYLE.width,p.graphicHeight=b.STYLE.height,p.externalGraphic=b.STYLE.image);if("polyline"==b.STYLE.type){if(r)d=q.read(b.GEOMETRY.WKT);else{for(var d=[],t=0;t<b.GEOMETRY.GEOMETRY.length;t++){var f=new Ol2.Geometry.Point(b.GEOMETRY.GEOMETRY[t].x,b.GEOMETRY.GEOMETRY[t].y);d.push(f)}d=new Ol2.Feature.Vector(new Ol2.Geometry.LineString(d))}p.strokeWidth=b.STYLE.weight;p.strokeColor=b.STYLE.color;p.strokeDashstyle=b.STYLE.style?b.STYLE.style:b.STYLE.dashstyle;p.strokeOpacity=b.STYLE.alpha?b.STYLE.alpha:b.STYLE.opacity}if("polygon"==b.STYLE.type){if(r)d=q.read(b.GEOMETRY.WKT);else{d=[];for(t=0;t<b.GEOMETRY.GEOMETRY.length;t++)f=new Ol2.Geometry.Point(b.GEOMETRY.GEOMETRY[t].x,b.GEOMETRY.GEOMETRY[t].y),d.push(f);d=new Ol2.Geometry.LinearRing(d);d=new Ol2.Feature.Vector(new Ol2.Geometry.Polygon(d))}p.strokeWidth=b.STYLE.weight;p.strokeColor=b.STYLE.color;p.strokeDashstyle=b.STYLE.style?b.STYLE.style:b.STYLE.dashstyle;p.strokeOpacity=b.STYLE.alpha?b.STYLE.alpha:b.STYLE.opacity;p.fillColor=b.STYLE.fillColor;p.fillOpacity=b.STYLE.fillAlpha?b.STYLE.fillAlpha:b.STYLE.fillOpacity}"label"==b.STYLE.type&&(d=r?q.read(b.GEOMETRY.WKT):new Ol2.Feature.Vector(new Ol2.Geometry.Point(b.GEOMETRY.GEOMETRY[0].x,b.GEOMETRY.GEOMETRY[0].y)),p.label=b.TITLE,p.labelAlign=b.STYLE.placement,p.fontColor=b.STYLE.fontColor,p.labelXOffset=b.STYLE.xoffset,p.labelYOffset=b.STYLE.yoffset,p.fontFamily=b.STYLE.fontFamily,p.fontSize=b.STYLE.fontSize,b.STYLE.border&&(p.labelOutlineColor=b.STYLE.borderColor),b.STYLE.italic&&(p.fontStyle="italic"),b.STYLE.bold&&(p.fontWeight="bold"));d.style=p;d.attributes={id:b.ID,remark:b.MEMO,type:"polyline"==b.STYLE.type?"line":"label"==b.STYLE.type?"text":b.STYLE.type,name:b.TITLE};b=d;n.extend(b.geometry.getBounds());G.push(b)}z.addFeatures(G);C.map.zoomToExtent(n)}$("#mark_result").show();$("#mark_result #mark_count").text(G.length);$("#mark_quryList").empty().append(c.join(""))}function m(a){var c=[],b;if(a.CLASS_NAME.match(/(LineString)$/))for(a=n.geometry.components,b=0;b<a.length;b++)c.push([a[b].x,a[b].y]);else if(a.CLASS_NAME.match(/(Polygon)$/))for(a=n.geometry.components[0].components,b=0;b<a.length;b++)c.push([a[b].x,a[b].y]);else c.push([a.x,a.y]);return c.join(",")}function h(a,c){if(null!=c)return"middle"==a?"cm":"bottom"==a?"cb":"top"==a?"ct":"cm";if(!a)return"middle";var b=a.substr(a.length-1,1);return"b"==b?"bottom":"m"==b?"middle":"t"==b?"top":"middle"}function l(){if(g_userid&&"0"!=g_userid){var a=n.style,b=n.attributes,c={TITLE:b.name,MEMO:b.remark,USERID:g_userid},e="";b.id?(c.ID=b.id,e="UpdateUserPlot"):e="AddUserPlot";switch(b.type){case "point":c.STYLE=JSON.stringify({type:"point",width:a.graphicWidth,height:a.graphicHeight,image:a.externalGraphic});c.GEOMETRY=n.geometry.x+","+n.geometry.y;break;case "line":c.STYLE=JSON.stringify({type:"polyline",alpha:a.strokeOpacity,color:a.strokeColor,weight:a.strokeWidth,style:a.strokeDashstyle});c.GEOMETRY=m(n.geometry);break;case "polygon":c.STYLE=JSON.stringify({type:"polygon",alpha:a.strokeOpacity,color:a.strokeColor,weight:a.strokeWidth,style:a.strokeDashstyle,fillColor:a.fillColor,fillAlpha:a.fillOpacity});c.GEOMETRY=m(n.geometry);break;case "text":c.STYLE=JSON.stringify({type:"label",fontFamily:a.fontFamily,fontSize:a.fontSize,fontColor:a.fontColor,xoffset:a.labelXOffset,yoffset:a.labelYOffset,bold:a.fontWeight,italic:a.fontStyle,color:a.strokeColor,borderColor:a.labelOutlineColor,placement:h(a.labelAlign),border:!0}),c.GEOMETRY=m(n.geometry)}$.ajax({type:"POST",url:plotsURL+e,data:JSON.stringify({value:JSON.stringify(c)}),success:function(a,c){""==a||null==a||"0"!=a.State?alert("\u4fdd\u5b58\u5931\u8d25\uff01\u8bf7\u91cd\u65b0\u4fdd\u5b58"):(n.attributes.id||(n.attributes.id=a.Value),alert("\u4fdd\u5b58\u6210\u529f"))},error:function(a,c,b){alert(c)},contentType:"application/json; charset\x3dutf-8"})}else alert("\u4eb2\uff0c\u7528\u6237\u767b\u9646\u540e\u624d\u80fd\u591f\u4fdd\u5b58\u54e6\uff01\u8bf7\u767b\u9646\u540e\u518d\u8bd5\u8bd5\uff01")}function f(){confirm("\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&n.attributes.id&&$.ajax({type:"POST",url:plotsURL+"DeleteUserPlot",data:JSON.stringify({USERID:g_userid,ID:n.attributes.id}),success:function(a,c){""==a||null==a?alert("\u5220\u9664\u5931\u8d25\uff01"):(alert("\u5220\u9664\u6210\u529f"),z.removeFeatures([n]),"none"!=$("#mark_List").css("display")?(G=z.features,$("#mark_quryList li[id\x3d'"+n.attributes.id+"']").remove()):D=z.features,PoiInfoPop.close())},error:function(a,c,b){alert(c)},contentType:"application/json; charset\x3dutf-8"})}function g(c){n=c.feature;B=Ol2.Util.extend({},n.style);c=n.attributes;var b="";"line"==c.type?(PoiInfoPop.show("plotinfo",n.geometry.components[n.geometry.components.length-1],{type:"line"}),$("#markName").text("\u7ebf\u6807\u7ed8"),b=n.geometry.getGeodesicLength(C.map.getProjectionObject()),b=1E3<b?"\u957f\u5ea6\uff1a"+(b/1E3).toFixed(3)+"\u516c\u91cc":"\u957f\u5ea6\uff1a"+b.toFixed(3)+"\u7c73"):"polygon"==c.type?(PoiInfoPop.show("plotinfo",n.geometry.getCentroid(),{type:"polygon"}),$("#markName").text("\u9762\u6807\u7ed8"),b=n.geometry.getGeodesicArea(C.map.getProjectionObject()),b=1E5<b?"\u9762\u79ef\uff1a"+(b/1E6).toFixed(3)+"\u5e73\u65b9\u516c\u91cc":"\u9762\u79ef\uff1a"+b.toFixed(3)+"\u5e73\u65b9\u7c73"):"text"==c.type?(PoiInfoPop.show("plotinfo",n.geometry,{type:"text"}),$("#markName").text("\u6587\u5b57\u6807\u7ed8")):(PoiInfoPop.show("plotinfo",n.geometry,{type:"point"}),$("#markName").text("\u70b9\u6807\u7ed8"));$("#mark_title").append("\x3cinput type\x3d'button' id\x3d'popEditBtn' class\x3d'popEditBtn' title\x3d'\u4fee\u6539' style\x3d'margin-right:20px'\x3e\x3cinput type\x3d'button'class\x3d'popEditBtn' id\x3d'popDelBtn'  title\x3d'\u5220\u9664'\x3e");$("#right_pointNameInfo").html("\x3cdiv\x3e\u540d\u79f0\uff1a"+n.attributes.name+"\x3c/div\x3e\x3cdiv style\x3d'max-width:260px'\x3e\u5907\u6ce8\uff1a"+(n.attributes.remark||"\u65e0")+"\x3c/div\x3e\x3cdiv\x3e"+b+"\x3c/div\x3e");PoiInfoPop.resize();a()}function a(){$("#popEditBtn").click(function(){var a=n.attributes.type;"line"==a?(PoiInfoPop.show("plotedit",n.geometry.components[n.geometry.components.length-1],"line"),v()):"polygon"==a?(PoiInfoPop.show("plotedit",n.geometry.getCentroid(),"polygon"),u()):"text"==a?(PoiInfoPop.show("plotedit",n.geometry,"text"),t()):(PoiInfoPop.show("plotedit",n.geometry,"point"),b())});$("#popDelBtn").click(function(){PoiInfoPop.close();f()})}function c(a){$("#mark_tool_div .active").removeClass("active");var c=a.geometry;B.externalGraphic="images/mark2/point7.png";B.graphicWidth=24;B.graphicHeight=24;B.graphicYOffset=-22;B.fillOpacity=1;B.cursor="pointer";a.style=Ol2.Util.extend({},B);a.style.label="";a.attributes.type="point";n=a;D.push(n);z.drawFeature(n);p[r].deactivate();PoiInfoPop.show("plotedit",c);b()}function b(){$("#poi_pop_info").css("height","180px");$("#pointPopupContent").append(E);$("#pointmark_name").val(n.attributes.name||"").after("\x3cdiv id\x3d'changeImg' style\x3d'cursor:pointer;position: absolute;top: 35px;right: 5px;text-decoration: underline;'\x3e\x3cimg id\x3d'pointImg' style\x3d'width:20px;'src\x3d'"+B.externalGraphic+"'/\x3e\x3cbr/\x3e\u66f4\u6362\x3c/div\x3e");$("#pointmark_desc").text(n.attributes.remark||"");$("#pointPopupContent").after(k());$("#markName").text("\u70b9\u6807\u7ed8");PoiInfoPop.resize();$("#changeImg").click(function(){$("#pointPopupContent").hide();$("#pointmark_imgdiv").show()});$("#pointmark_imgdiv .sp_12").click(function(){var a=$(this).attr("src");$("#pointImg").attr("src",a);n.style.externalGraphic=a;z.drawFeature(n);$("#pointImgRtn").click()});$("#pointImgRtn").click(function(){$("#pointPopupContent").show();$("#pointmark_imgdiv").hide()});$("#pointmark_save").click(function(){n.attributes.name=$("#pointmark_name").val();n.attributes.remark=$("#pointmark_desc").val();g({feature:n});l()});$("#pointmark_delete").click(function(){PoiInfoPop.close();f()})}function e(a){$("#mark_tool_div .active").removeClass("active");B.strokeWidth=2;B.strokeOpacity=1;B.strokeColor="#0000ff";B.label="";B.cursor="pointer";a.style=Ol2.Util.extend({},B);a.style.label="";a.attributes.type="line";n=a;D.push(n);z.drawFeature(n);p[r].deactivate();PoiInfoPop.show("plotedit",n.geometry.components[a.geometry.components.length-1]);v()}function v(){$("#poi_pop_info").css("height","240px");$("#pointPopupContent").append(E);$("#pointmark_name").val(n.attributes.name||"");$("#pointmark_desc").text(n.attributes.remark||"");$("#markName").text("\u7ebf\u6807\u7ed8");$("#style_panel").append(I);q();$("#style_panel .ltrans").val(n.style.strokeOpacity);$.jPicker.List[0].color.active.val("hex",n.style.strokeColor.replace("#",""),this);$("#style_panel .lwidth").val(n.style.strokeWidth);$("#style_panel .dropdown").attr("val",n.style.strokeDashstyle);$("#style_panel .dropdown p img").attr("src",$("#style_panel .dropdown img[val\x3d'"+n.style.strokeDashstyle+"']").attr("src"));PoiInfoPop.resize();$("#pointmark_save").click(function(){n.attributes.name=$("#pointmark_name").val();n.attributes.remark=$("#pointmark_desc").val();n.style.strokeOpacity=$("#style_panel .ltrans").val();n.style.strokeColor="#"+$.jPicker.List[0].color.active.val("hex");n.style.strokeWidth=$("#style_panel .lwidth").val();n.style.strokeDashstyle=$("#style_panel .dropdown").attr("val");z.drawFeature(n);g({feature:n});l()});$("#pointmark_delete").click(function(){PoiInfoPop.close();f()})}function w(a){B.pointRadius=24;B.fillColor="#0000ff";B.fillOpacity=.5;B.strokeWidth=2;B.strokeOpacity=1;B.strokeColor="#0000ff";B.cursor="pointer";a.style=Ol2.Util.extend({},B);a.style.label="";a.attributes.type="polygon";n=a;D.push(n);z.drawFeature(n);PoiInfoPop.show("plotedit",n.geometry.getCentroid());p[r].deactivate();u()}function u(){$("#poi_pop_info").css("height","270px");$("#pointPopupContent").append(E);$("#pointmark_name").val(n.attributes.name||"");$("#pointmark_desc").text(n.attributes.remark||"");$("#markName").text("\u9762\u6807\u7ed8");$("#style_panel").append(J);q();$("#style_panel .ltrans").val(n.style.strokeOpacity);$.jPicker.List[0].color.active.val("hex",n.style.strokeColor.replace("#",""));$("#style_panel .lwidth").val(n.style.strokeWidth);$("#style_panel .dropdown").attr("val",n.style.strokeDashstyle);$("#style_panel .dropdown p img").attr("src",$("#style_panel .dropdown img[val\x3d'"+n.style.strokeDashstyle+"']").attr("src"));$.jPicker.List[1].color.active.val("hex",n.style.fillColor.replace("#",""));$("#style_panel .ftrans").val(n.style.fillOpacity);PoiInfoPop.resize();$("#pointmark_save").click(function(){n.attributes.name=$("#pointmark_name").val();n.attributes.remark=$("#pointmark_desc").val();n.style.strokeOpacity=$("#style_panel .ltrans").val();n.style.strokeColor="#"+$.jPicker.List[0].color.active.val("hex");n.style.strokeWidth=$("#style_panel .lwidth").val();n.style.strokeDashstyle="#"+$("#style_panel .dropdown").attr("val");n.style.fillColor="#"+$.jPicker.List[1].color.active.val("hex");n.style.fillOpacity=$("#style_panel .ftrans").val();z.drawFeature(n);g({feature:n});l()});$("#pointmark_delete").click(function(){PoiInfoPop.close();f()})}function y(a){$("#mark_tool_div .active").removeClass("active");B.pointRadius=8;B.fillOpacity=0;B.strokeOpacity=0;B.fontColor="#0000ff";B.fontSize="12px";B.cursor="pointer";B.labelOutlineColor="#ffffff";B.labelSelect=!0;B.fontWeight="bold";a.style=Ol2.Util.extend({},B);a.style.label="";a.attributes.type="text";n=a;D.push(n);z.drawFeature(n);PoiInfoPop.show("plotedit",n.geometry);p[r].deactivate();t()}function t(){$("#poi_pop_info").css("height","290px");$("#pointPopupContent").append(E);$("#pointmark_name").val(n.attributes.name||"");$("#pointmark_desc").text(n.attributes.remark||"");$("#markName").text("\u6587\u5b57\u6807\u7ed8");$("#style_panel").append(A);q();$("#style_panel .tpos").val(h(n.style.labelAlign));$("#style_panel .xoff").val(n.style.labelXOffset||0);$("#style_panel .yoff").val(n.style.labelYOffset||0);n.style.labelOutlineColor?($.jPicker.List[1].color.active.val("hex",n.style.labelOutlineColor.replace("#","")),$("#style_panel .tbord")[0].checked=!0):($("#style_panel .tbord")[0].checked=!1,$("#style_panel .lcolor").hide());$("#style_panel .txie")[0].checked="italic"==n.style.fontStyle?!0:!1;$("#style_panel .tchu")[0].checked="bold"==n.style.fontWeight?!0:!1;$.jPicker.List[0].color.active.val("hex",n.style.fontColor.replace("#",""));$("#style_panel .tcolor").val(n.style.fontColor);$("#style_panel .tsize").val(parseInt(n.style.fontSize));$("#style_panel .tfam").val(n.style.fontFamily||"\u5b8b\u4f53");PoiInfoPop.resize();$("#pointmark_save").click(function(){n.attributes.name=$("#pointmark_name").val();n.attributes.remark=$("#pointmark_desc").val();n.style.label=n.attributes.name;n.style.labelAlign=h($("#style_panel .tpos").val(),"r");n.style.labelXOffset=$("#style_panel .xoff").val();n.style.labelYOffset=$("#style_panel .yoff").val();$("#style_panel .tbord")[0].checked&&(n.style.labelOutlineColor="#"+$.jPicker.List[1].color.active.val("hex"));n.style.fontStyle=$("#style_panel .txie")[0].checked?"italic":"nomal";n.style.fontWeight=$("#style_panel .tchu")[0].checked?"bold":"nomal";n.style.fontColor="#"+$.jPicker.List[0].color.active.val("hex");n.style.fontSize=$("#style_panel .tsize").val()+"px";n.style.fontFamily=$("#style_panel .tfam").val();z.drawFeature(n);g({feature:n});l()});$("#pointmark_delete").click(function(){PoiInfoPop.close();f()})}function q(){if(0<$.jPicker.List.length)for(var a=$.jPicker.List.length-1;-1<a;a--)$.jPicker.List[a].destroy();$(".colorBtn").jPicker({window:{expandable:!0,position:{x:"screenCenter",y:"center"}}},function(a,c){},function(a,c){},function(a,c){});$("#poi_pop_info").parent().after($(".dropdown").remove());$(".spinner.wh").spinner({step:1,min:0,max:10,numberFormat:"n"});$(".spinner.trans").spinner({step:.05,min:0,max:1,numberFormat:"n"});$(".spinner.unlimit").spinner({step:1,numberFormat:"n"});$(".dropdown p").click(function(){var a=$(this).siblings("ul");"none"==a.css("display")?a.slideDown("fast"):a.slideUp("fast")});$(".dropdown").mouseleave(function(){$(this).children("ul").hide()});$(".dropdown ul li img").click(function(){var a=$(this),c=a.attr("src"),b=a.parents(".dropdown");b.attr("val",a.attr("val"));b.find("p img").attr("src",c);b.children("ul").hide()})}var p=[],r=0,z,F=!1,B,C,n,E,H,I,A,J,D=[],G=[];plotsURL=Service.UserPlot;return{init:function(a,b){if(!F){I="\x3cdiv class\x3d'stylediv line' style\x3d'position: relative;'\x3e       \x3cdiv\x3e\u7ebf\u989c\u8272:\x3cspan class\x3d'colorBtn'/\x3e\x3c/div\x3e       \x3cdiv\x3e\u7ebf\u6837\u5f0f:\x3cdiv  style\x3d'position:relative;width:60px;height:24px;display:inline-block;'\x3e           \x3cdiv class\x3d'dropdown' val\x3d'solid'\x3e               \x3cp \x3e\x3cimg src\x3d'images/linestyle/solid.png'\x3e\x3c/p\x3e               \x3cul\x3e                   \x3cli \x3e\x3cimg val\x3d'solid' src\x3d'images/linestyle/solid.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dash' src\x3d'images/linestyle/dash.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dot' src\x3d'images/linestyle/dot.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dashdot' src\x3d'images/linestyle/dashdot.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'longdashdot' src\x3d'images/linestyle/longdashdot.png'\x3e\x3c/li\x3e               \x3c/ul\x3e           \x3c/div\x3e       \x3c/div\x3e   \x3c/div\x3e   \x3cdiv\x3e\u7ebf\u5bbd:\x3cinput class\x3d'spinner wh lwidth'  value\x3d'2' /\x3e\x3c/div\x3e\x3cdiv\x3e\u900f\u660e\u5ea6:\x3cinput class\x3d'spinner trans ltrans' value\x3d'1' /\x3e\x3c/div\x3e\x3c/div\x3e";A=" \x3cdiv  class\x3d'stylediv text' style\x3d'position: relative;'\x3e       \x3cdiv\x3e\u6587\u5b57\u4f4d\u7f6e:\x3cselect class\x3d'tpos'\x3e\x3coption\x3emiddle\x3c/option\x3e\x3coption\x3etop\x3c/option\x3e\x3coption\x3ebottom\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e       \x3cdiv\x3e\u6587\u5b57\u989c\u8272:\x3cspan class\x3d'colorBtn'/\x3e\x3c/div\x3e       \x3cdiv\x3ex\u8f74\u504f\u79fb:\x3cinput class\x3d'spinner unlimit xoff'  value\x3d'0' /\x3e\x3c/div\x3e       \x3cdiv\x3ey\u8f74\u504f\u79fb:\x3cinput class\x3d'spinner unlimit yoff'  value\x3d'0' /\x3e\x3c/div\x3e       \x3cdiv\x3e\u5b57\u4f53:\x3cselect style\x3d'max-width:100px' class\x3d'tfam'\x3e           \x3coption\x3e\u5b8b\u4f53\x3c/option\x3e           \x3coption\x3e\u5fae\u8f6f\u96c5\u9ed1\x3c/option\x3e           \x3coption\x3e\u6977\u4f53\x3c/option\x3e           \x3coption\x3e\u4eff\u5b8b\x3c/option\x3e           \x3coption\x3eAlgerian\x3c/option\x3e           \x3coption\x3eArial\x3c/option\x3e           \x3coption\x3eBroadway\x3c/option\x3e           \x3coption\x3eComicSansMS\x3c/option\x3e           \x3coption\x3eCourier\x3c/option\x3e           \x3coption\x3eVerdana\x3c/option\x3e           \x3coption\x3eTimesNewRoman\x3c/option\x3e       \x3c/select\x3e   \x3c/div\x3e   \x3cdiv\x3e\u5927\u5c0f:\x3cselect class\x3d'tsize'\x3e       \x3coption\x3e8\x3c/option\x3e       \x3coption\x3e10\x3c/option\x3e       \x3coption\x3e12\x3c/option\x3e       \x3coption\x3e14\x3c/option\x3e       \x3coption\x3e16\x3c/option\x3e       \x3coption\x3e18\x3c/option\x3e       \x3coption\x3e20\x3c/option\x3e   \x3c/select\x3e\x3c/div\x3e   \x3cdiv\x3e\x3cinput class\x3d'tbord' type\x3d'checkbox'/\x3e\u4f7f\u7528\u8fb9\u6846       \x3cspan class\x3d'colorBtn'/\x3e\x3c/div\x3e       \x3cdiv\x3e\x3cinput class\x3d'txie' type\x3d'checkbox'/\x3e\u659c\u4f53\x3c/div\x3e       \x3cdiv\x3e\x3cinput class\x3d'tchu' type\x3d'checkbox'/\x3e\u52a0\u7c97\x3c/div\x3e   \x3c/div\x3e";J="\x3cdiv class\x3d'stylediv polygon' style\x3d'position: relative'\x3e           \x3cdiv\x3e\u7ebf\u989c\u8272:\x3cspan class\x3d'colorBtn'/\x3e\x3c/div\x3e\x3cdiv\x3e\u7ebf\u6837\u5f0f:\x3cdiv style\x3d'position:relative;width:60px;height:24px;display:inline-block;'\x3e           \x3cdiv class\x3d'dropdown' val\x3d'solid'\x3e               \x3cp\x3e\x3cimg src\x3d'images/linestyle/solid.png'\x3e\x3c/p\x3e               \x3cul\x3e                   \x3cli \x3e\x3cimg val\x3d'solid' src\x3d'images/linestyle/solid.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dash' src\x3d'images/linestyle/dash.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dot' src\x3d'images/linestyle/dot.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'dashdot' src\x3d'images/linestyle/dashdot.png'\x3e\x3c/li\x3e                   \x3cli \x3e\x3cimg val\x3d'longdashdot' src\x3d'images/linestyle/longdashdot.png'\x3e\x3c/li\x3e               \x3c/ul\x3e           \x3c/div\x3e       \x3c/div\x3e   \x3c/div\x3e   \x3cdiv\x3e\u7ebf\u5bbd:\x3cinput class\x3d'spinner wh lwidth'  value\x3d'2' /\x3e\x3c/div\x3e\x3cdiv\x3e\u900f\u660e\u5ea6:\x3cinput class\x3d'spinner trans ltrans' value\x3d'1' /\x3e\x3c/div\x3e   \x3cdiv\x3e\u586b\u5145\u989c\u8272:\x3cspan class\x3d'colorBtn'/\x3e\x3c/div\x3e\x3cdiv\x3e\u586b\u5145\u900f\u660e\u5ea6:\x3cinput class\x3d'spinner trans ftrans'  value\x3d'1' /\x3e\x3c/div\x3e\x3c/div\x3e";E="\x3cdiv\x3e\x3cspan\x3e\u540d\u79f0:\x3c/span\x3e\x3cinput type\x3d'text' style\x3d'width:245px' id\x3d'pointmark_name'\x3e\x3c/div\x3e\x3cdiv style\x3d'margin-top:10px;'\x3e\x3cspan style\x3d'float:left;'\x3e\u5907\u6ce8:\x3c/span\x3e\x3ctextarea id\x3d'pointmark_desc'\x3e\x3c/textarea\x3e\x3c/div\x3e\x3cdiv id\x3d'style_panel'\x3e\x3c/div\x3e\x3cdiv style\x3d'height:25px;margin-top:10px;margin-left:80px;width:280px;' id\x3d'popup1BtnDiv'\x3e\x3cdiv id\x3d'pointmark_save'\x3e\u4fdd  \u5b58\x3c/div\x3e\x3cdiv id\x3d'pointmark_delete' style\x3d'margin-left:10px;'\x3e\u5220  \u9664\x3c/div\x3e\x3c/div\x3e";H="point0 point1 point2 point3 point4 point5 point6 point7 point8 point9 point10 point11 point12 point13 point14 point15 point16 point17 point18 point19 point20".split(" ");"object"==typeof a?$(a).append("\x3cli class\x3d'toolbagClass' id\x3d'btnMarkDiv'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -40px 0;top:4px;width:20px;'\x3e\x3c/span\x3e\u6807\u7ed8\x3c/span\x3e\x3c/li\x3e"):$("#"+a).append("\x3cli class\x3d'toolbagClass' id\x3d'btnMarkDiv'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -40px 0;top:4px;width:20px;'\x3e\x3c/span\x3e\u6807\u7ed8\x3c/span\x3e\x3c/li\x3e");C=b;$(C.map.div).after("\x3cdiv id \x3d 'mark_tool_div'title\x3d'\u5730\u56fe\u6807\u7ed8' onselectstart\x3d'return false' style\x3d'-moz-user-select:none;display:none'\x3e\t\x3cdiv class\x3d'marktool'\x3e\x3cul\x3e\t\t\x3cli class \x3d 'markClas' style \x3d 'background:url(images/ToolBar/tool_markpointer.png) no-repeat center'\x3e\x3c/li\x3e\t\t\x3cli class \x3d 'markClas' title\x3d'\u5355\u51fb\u786e\u5b9a\u70b9,\u53cc\u51fb\u7ed3\u675f\u7ed8\u5236' style \x3d 'background:url(images/ToolBar/tool_markline.png) no-repeat center'\x3e\x3c/li\x3e\t\t\x3cli class \x3d 'markClas' title\x3d'\u5355\u51fb\u786e\u5b9a\u70b9,\u53cc\u51fb\u7ed3\u675f\u7ed8\u5236' style \x3d 'background:url(images/ToolBar/tool_markpolygon.png) no-repeat center'\x3e\x3c/li\x3e       \x3cli class \x3d 'markClas' style \x3d 'background:url(images/ToolBar/tool_marktext.png) no-repeat center'\x3e\x3c/li\x3e\t\x3c/ul\x3e\x3c/div\x3e\t\x3cdiv class\x3d'marklist' style\x3d'display:none;' \x3e\x3cdiv style\x3d\"padding: 5px 5px 10px 5px;border-bottom: 1px dotted blue;margin-bottom: 8px;\"\x3e\x3cinput style\x3d\"width:100px;\"  id\x3d\"mark_qurytitle\"\x3e \x3cinput type\x3d\"button\" class\x3d\"markBtn\" style\x3d\"width:45px\" value\x3d\"\u67e5\u8be2\" id\x3d\"mark_qurybtn\"\x3e \x3cinput type\x3d\"button\" style\x3d\"width: 55px;color:gray\" class\x3d\"markBtn\" value\x3d\"\u4e0b\u8f7dshp\" id\x3d\"mark_download\"\x3e\x3c/div\x3e\x3cdiv id\x3d'mark_result'style\x3d'display:none'\x3e\x3cinput id\x3d'mark_selectall' style\x3d'vertical-align:middle;margin: 0 4px;' type\x3d'checkbox'\x3e\u67e5\u8be2\u7ed3\u679c (\u5171\x3cspan id\x3d'mark_count'\x3e10\x3c/span\x3e\u6761)\x3cinput type\x3d'button' style\x3d'width: 65px;height:21px;margin-left:60px' class\x3d'markBtn' value\x3d'\u6e05\u9664\u7ed3\u679c'id\x3d'mark_quryclear'/\x3e\x3cul id\x3d'mark_quryList' \x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");$("#mark_tool_div").dialog({autoOpen:!1,resizable:!1,position:[.5*$(window).width()+85,32],width:"auto",maxHeight:"300px",minHeight:"inherit",minWidth:"inherit"});$("#mark_tool_div").css("min-height","inherit");$(".ui-dialog").css({"z-index":"1000",width:"auto","font-size":"12px",border:"1px solid #25abf3"});$(".ui-dialog-title").after('\x3cspan style\x3d"position: absolute;right: 0;"\x3e\x3cimg id\x3d"mark_close" src\x3d"images/blank.gif" title\x3d"\u5173\u95ed"\x3e\x3cimg id\x3d"mark_List" src\x3d"images/blank.gif" title\x3d"\u6807\u7ed8\u8bb0\u5f55"\x3e\x3cimg id\x3d"mark_spin" src\x3d"images/blank.gif" title\x3d"\u6807\u7ed8"\x3e\x3c/span\x3e');$(".ui-dialog .ui-dialog-titlebar ").css({color:"#4d4d4d","font-weight":"700",padding:"0 2px","font-size":"14px",background:"url(Openlayers/theme/default/img/cloud-popup-relative.png) no-repeat -2px -1px",border:"none"});$(".ui-dialog-titlebar-close ").hide();var n=new Ol2.StyleMap({"default":{pointRadius:24,fillOpacity:1,graphicWidth:24,graphicHeight:24,graphicYOffset:-22,externalGraphic:"images/mark2/point7.png",graphicZIndex:100,fillColor:"blue",strokeWidth:2,strokeOpacity:1,strokeColor:"red",fontColor:"blue",cursor:"pointer"}});B=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);z=new Ol2.Layer.Vector("plotLayer",{style:n});C.addLayer(z,!0);p=[new Ol2.Control.DrawFeature(z,Ol2.Handler.Point,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:n}},featureAdded:c}),new Ol2.Control.DrawFeature(z,Ol2.Handler.Path,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:n}},featureAdded:e}),new Ol2.Control.DrawFeature(z,Ol2.Handler.Polygon,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:n}},featureAdded:w}),new Ol2.Control.DrawFeature(z,Ol2.Handler.Point,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:n}},featureAdded:y})];C.map.addControls(p);z.events.on({featureselected:g});$("#btnMarkDiv").click(function(a){$("#toolbag_div").css("display","none");$("#mark_tool_div").css("display","block").find(".markClas:eq(0)").addClass("active");r=0;p[r].activate();$("#mark_tool_div").dialog("open")});$("#mark_close").on("click",function(a){$("#mark_tool_div .active").removeClass("active");$("#mark_tool_div\x3e.marktool").show();$("#mark_tool_div\x3e.marklist").hide();$("#mark_tool_div").dialog("close");z.removeAllFeatures();p[r].deactivate();markers&&markers.removeAllFeatures()});$("#mark_List").on("click",function(){p[r].deactivate();$("#mark_tool_div\x3e.marktool").hide();$("#mark_tool_div\x3e.marklist").show();$("#mark_tool_div").css({width:"260px",height:"280px"});z.removeAllFeatures();z.addFeatures(G)});$("#mark_spin").on("click",function(){p[r].activate();$("#mark_tool_div").css({width:"145px",height:"40px"});$("#mark_tool_div\x3e.marktool").show();$("#mark_tool_div\x3e.marklist").hide();z.removeAllFeatures();z.addFeatures(D)});$(".markClas").on("click",function(){$(".markClas").siblings().removeClass("active");p[r].deactivate();r=$(this).index();$(this).addClass("active");p[r].activate()});$("#mark_quryclear").click(function(){z.removeAllFeatures();G=[];$("#mark_download").css({color:"gray"});$("#mark_result").hide()});$("#mark_qurybtn").click(function(){if(g_userid&&"0"!=g_userid){var a=$("#mark_qurytitle").val();$("#mark_download").css({color:"black"});$.ajax({url:plotsURL+"GetUserPlots?t\x3d"+(new Date).getTime(),data:JSON.stringify({USERID:g_userid,TITLE:a}),type:"post",success:d,error:function(){},contentType:"application/json; charset\x3dutf-8"})}else alert("\u5f53\u524d\u672a\u767b\u5f55\uff0c\u8bf7\u767b\u9646\u540e\u518d\u67e5\u8be2\u5386\u53f2\u6807\u7ed8\u4fe1\u606f\uff01")});$("#mark_download").click(function(){if("none"!=$("#mark_result").css("display")){var a=[];$("#mark_quryList li :checkbox:checked").each(function(){a.push($(this).parent().attr("id"))});1>a.length&&alert("\u5f53\u524d\u672a\u9009\u4e2d\u4efb\u4f55\u6807\u7ed8\uff01");$.ajax({url:Service.DOWNLOAD,type:"post",dataType:"text",data:{userid:g_userid,request:"download",id:a.join("|")+"|"},success:function(a){window.saveFrame&&a&&(window.saveFrame.location=a,window.imgFrame.document.execCommand("SaveAs"));return!1},error:function(a,c,b){}})}});$("#mark_result #mark_quryList").on("dblclick","li",function(){for(var a=$(this).attr("id"),c=0;c<G.length;c++)if(G[c].attributes.id==a){C.map.zoomToExtent(G[c].geometry.getBounds());g({feature:G[c]});break}});$("#mark_selectall").change(function(){this.checked?$("#mark_quryList li :checkbox").each(function(){this.checked=!0}):$("#mark_quryList li :checkbox").each(function(){this.checked=!1})});F=!0}},clear:function(){z.removeAllFeatures();D=[];G=[];PoiInfoPop.close()}}}(),POI_ICON_SIZE=[],POI_IMGOFFSET=[],CLASSICON=[["blank",-125,-205,2,2],["yiyuan",-5,-5,14,14],["jiguan",-5,-25,9,13],["danwei",-5,-45,9,13],["xuexiao",-5,-65,14,14],["daxue",-5,-85,15,14],["youeryuan",-5,-105,15,15],["gongyuan",-5,-125,17,15],["dongwuyuan",-5,-145,17,15],["lingyuan",-5,-165,17,15],["fengjing",-5,-185,15,13],["zhiwuyuan",-25,-5,16,14],["guangchang",-25,-25,17,15],["youleyuan",-25,-45,17,15],["binguan",-25,-65,16,14],["tiyuchang",-25,-85,16,16],["xiaoqu",-25,-105,15,14],["changguan",-25,-125,16,14],["chaoshi",-25,-145,17,15],["juyuan",-25,-165,17,15],["gongyeyuan",-25,-185,19,17],["changkuang",-45,-5,16,14],["yisilan",-45,-25,14,13],["jidu",-45,-45,16,14],["shimao",-45,-65,16,14],["dian",-45,-85,9,9],["zhengfu",-45,-105,13,13],["jichang",-45,-125,19,17],["gangkou",-45,-145,17,15],["qichezhan",-45,-165,17,15],["shoufeizhan",-45,-185,16,14],["fuwuqu",-65,-5,16,14],["cesuo",-65,-25,17,15],["tongxin",-65,-45,16,14],["liantong",-65,-65,15,13],["yidong",-65,-85,16,14],["dianxin",-65,-105,15,13],["tingchechang",-65,-125,16,14],["gaosurukou",-65,-145,17,11],["gaosuchukou",-65,-165,17,11],["atm",-65,-185,17,11],["jiayouzhan",-85,-5,15,13],["kfc",-85,-25,13,13],["maidanglao",-85,-45,13,9],["youju",-85,-65,16,14],["dianshitai",-85,-85,16,14],["gouwu",-85,-105,16,14],["yinhang",-85,-125,16,14],["chaguan",-85,-145,15,13],["canyin",-85,-165,14,12],["qiche",-85,-185,14,12],["huochezhan",-105,-5,15,15],["dasha",-105,-25,15,11]];(function(){var k,d,m;for(m in CLASSICON){for(k=0;k<POI_ICON_SIZE.length&&(d=POI_ICON_SIZE[k],d.w!=CLASSICON[m][3]||d.h!=CLASSICON[m][4]);k++);k==POI_ICON_SIZE.length&&POI_ICON_SIZE.push({w:CLASSICON[m][3],h:CLASSICON[m][4]});POI_IMGOFFSET[CLASSICON[m][0]]={x:CLASSICON[m][1],y:CLASSICON[m][2],s:k}}})();Ol2.Ex=Ol2.Ex||{};Ol2.Ex.PoiMarker=function(k,d,m){function h(){11>v.zoom&&b(POI_IMGOFFSET.blank,2);if(q){var c=v.getLayerPxFromLonLat(q.lonlat);a({x:c.x-C.w/2,y:c.y-C.h/2},2)}}function l(){b(POI_IMGOFFSET.blank,2);q=null}function f(){if(!(11>v.zoom)&&F.visibility){var n=w;if(n){var e=new Ol2.LonLat(n.pt);q=PoiInfoPop.show("local",e,{poi:!0,name:n.name,address:n.address||"\u6682\u65e0\u4fe1\u606f",telephone:n.telephone||"\u6682\u65e0\u4fe1\u606f",catg:n.catg||"",cname:n.cname,id:n.pid},l);var p=POI_IMGOFFSET[n.type];C=e=POI_ICON_SIZE[p.s];c(e,2);b(p,2);n=v.getLayerPxFromLonLat(new Ol2.LonLat(n.pt));a({x:n.x-e.w/2,y:n.y-e.h/2},2)}else b(POI_IMGOFFSET.blank,2)}}function g(n){if(!(11>v.zoom)&&F.visibility){var d=v.getLonLatFromViewPortPx(n.xy);if(!w||!(new Ol2.Bounds(w.bound)).containsLonLat(d))if(n=F.getTileInfo(d),n=v.zoom+"_"+n.row+"_"+n.col,p[n]){if(n=r[n],null!=n){var q=!1;if(0<n.id_num)for(var f in n.uids)if((new Ol2.Bounds(n.uids[f].bound)).containsLonLat(d)){var d=POI_IMGOFFSET[n.uids[f].type],q=POI_ICON_SIZE[d.s],g=v.getLayerPxFromLonLat(new Ol2.LonLat(n.uids[f].pt));a({x:g.x-q.w/2,y:g.y-q.h/2});c(q);b(d);w=n.uids[f];f=v.getLayerPxFromLonLat(new Ol2.LonLat(w.bound.slice(0,2)));n=v.getLayerPxFromLonLat(new Ol2.LonLat(w.bound.slice(2)));d=Math.round(n.x-f.x);q=Math.round(f.y-n.y);Ol2.Util.extend(t.style,{display:"block",top:n.y+"px",left:f.x+"px",width:d+"px",height:q+"px"});Ol2.Util.extend(B.style,{display:"block",top:n.y+"px",left:f.x+20+"px"});B.textContent=w.name;q=!0;break}q||(b(POI_IMGOFFSET.blank),w=null,Ol2.Util.extend(B.style,{display:"none"}))}}else p[n]=!0,w=null,f=n.split("_"),$.ajax({url:z+"\x26tileMatrix\x3d"+f[0]+"\x26tileRow\x3d"+f[1]+"\x26tileCol\x3d"+f[2],success:e})}}function a(a,c){var b;b=2==c?y.children[0]:u.children[0];b.style.top=a.y+"px";b.style.left=a.x+"px"}function c(a,c){var b;b=2==c?y.children[0].children[0]:u.children[0].children[0];b.style.width=a.w+"px";b.style.height=a.h+"px"}function b(a,c){var b;b=2==c?y.getElementsByTagName("img")[0]:u.getElementsByTagName("img")[0];b.style.left=a.x+"px";b.style.top=a.y+"px"}function e(a){if((a=eval(a))&&0!=a.length){var c=a[0][1]+1,b={};b.tileid=a[0][0];b.id_num=c;b.uids=[];for(var e=1;e<c;e++){var d=sdMap.map.getPixelFromLonLat(new Ol2.LonLat(a[e].slice(3,5))),p=POI_ICON_SIZE[POI_IMGOFFSET[a[e][1]].s],q=new Ol2.Pixel(d.x-p.w/2,d.y-p.h/2),d=new Ol2.Pixel(d.x+p.w/2,d.y+p.h/2),q=sdMap.map.getLonLatFromPixel(q),d=sdMap.map.getLonLatFromPixel(d),q={pid:a[e][0],type:a[e][1],name:a[e][2],pt:a[e].slice(3,5),address:a[e][9].Trim(),telephone:a[e][10].Trim(),cname:a[e][11],catg:a[e][12],bound:[q.lon,d.lat,d.lon,q.lat]};b.uids.push(q)}r[b.tileid]=b}}var v=k,w=null,u=null,y=null,t=null,q=null,p=[],r=[],z=m,F=null,B=null,C;if(d instanceof Ol2.Layer.WMTS)F=d;else throw Error("\u8f93\u5165\u56fe\u5c42\u4e0d\u662fWMTS\u56fe\u5c42");(function(){if(void 0===Ol2.Ex.PoiMarker._unique)Ol2.Ex.PoiMarker._unique=this;else throw Error("\u53ea\u5141\u8bb8\u4e00\u4e2aWMTS\u56fe\u5c42\u62e5\u6709POI\u8bc6\u522b");new Ol2.Events(this);v.events.register("mousemove",this,g);document.addEventListener?v.viewPortDiv.addEventListener("click",f,!1):v.viewPortDiv.attachEvent("onclick",f);v.events.register("zoomend",this,h);u=Ol2.Util.createDiv("OpenLayers_Marker_1");u.innerHTML="\x3cdiv style\x3d'width:0; height:0; z-index: 750; top: 100px; left: 400px; position: relative;'\x3e\x3cdiv style\x3d'position: absolute; margin: 0px; padding: 0px; width: 18px; height: 18px; overflow: hidden;'\x3e\x3cimg style\x3d'left:-164px; top:-162px; position:absolute;'src\x3d'images/tb.png'/\x3e\x3c/div\x3e\x3c/div\x3e";y=Ol2.Util.createDiv("OpenLayers_Marker_2");y.innerHTML=u.innerHTML;t=Ol2.Util.createDiv("OpenLayers_Mask_1");Ol2.Util.extend(t.style,{position:"absolute",background:"url(images/blank.gif)",zIndex:"750",cursor:"pointer"});B=Ol2.Util.createDiv("OpenLayers_Marker_Siv");Ol2.Util.extend(B.style,{position:"absolute",background:"white",whiteSpace:"nowrap",border:"1px solid #AEB1F0",zIndex:"750"});var a=Ol2.Util.createDiv("OpenLayers_Marker_Poi"),c=Ol2.Util.getElement(v.id+"_OpenLayers_Container");a.appendChild(u);a.appendChild(y);a.appendChild(t);a.appendChild(B);c.appendChild(a)})()};var DragMoveCtl=function(){function k(){c&&d(b)}function d(a){b=a;document.getElementById("DragMoveText_1").innerText=Math.abs(Math.round(a))+"\u7c73";a=g.getLayerPxFromLonLat(new Ol2.LonLat(c.x+a/(12742024*Math.PI)*450,c.y));var e=document.getElementById("OpenLayers_Control_DragMove_1");e.style.top=a.y+"px";e.style.left=a.x-18+"px"}function m(a){var e=$(a.currentTarget).offset(),y=g.getLonLatFromViewPortPx({x:a.clientX-e.left,y:a.clientY+e.top});a=c.x;var e=y.lon,t=c.y*Math.PI/180,y=y.lat*Math.PI/180,q=a*Math.PI/180-e*Math.PI/180,t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-y)/2),2)+Math.cos(t)*Math.cos(y)*Math.pow(Math.sin(q/2),2))),t=Math.round(6378137E4*t)/1E4;0>e-a&&(t*=-1);a=t;500<=a?(5E3<a?d(5E3):d(a),f(c,Math.abs(b))):-500>=a&&(-5E3>a?d(-5E3):d(a),f(c,Math.abs(b)))}function h(){$(".olMapViewport").on({mousemove:m,mouseup:l});document.getElementById("DragMoveBtn_1").style.backgroundPositionX="-87px";a.deactivate()}function l(){$(".olMapViewport").off("mousemove",m);$(".olMapViewport").off("mouseup",l);g.zoomToExtent(e.getDataExtent());document.getElementById("DragMoveBtn_1").style.backgroundPositionX="0";v&&v("buffer",0<b?b:-b);a.activate()}function f(a,c){e.removeAllFeatures();var b=new Ol2.Feature.Vector(new Ol2.Geometry.Polygon.createRegularPolygon(a,c/(12742024*Math.PI)*450,100,0)),d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);d.fillColor="blue";d.fillOpacity=.2;d.labelAlign="lb";d.labelXOffset=20;d.strokeColor="red";d.strokeOpacity=1;b.style=d;var d=new Ol2.Feature.Vector(a),q=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);q.externalGraphic="images/leftDiv/png/0[2].png";q.graphicWidth=19;q.graphicHeight=29;q.fillOpacity=1;q.cursor="pointer";d.style=q;e.addFeatures([b,d])}var g,a,c,b=2E3,e,v;return{init:function(c,b){g=c;var d=Ol2.Util.createDiv("OpenLayers_Control_DragMove_1");d.innerHTML='\x3ctable border\x3d"0" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctr\x3e   \x3ctd\x3e\x3cdiv id\x3d"DragMoveBtn_1" style\x3d"width:36px; height:20px; z-index: 750;position: relative;overflow: hidden;background:url(images/hr.png)"\x3e\x3c/div\x3e\x3c/td\x3e    \x3ctd\x3e\x3cdiv id\x3d"DragMoveText_1"  style\x3d"width: 52px; height:20px; z-index: 750;position: relative;overflow: hidden;background:url(images/hr.png);background-position: -36px 0;line-height: 20px;text-align: center;font-size: 13px;"\x3e1243\u7c73\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e';e=new Ol2.Layer.Vector("dragLayer",{rendererOptions:{zIndexing:!1}});g.addLayer(e);v=b;d.style.top="300px";d.style.left="300px";d.style.position="absolute";d.style.display="none";Ol2.Util.getElement(g.id+"_OpenLayers_Container").appendChild(d);document.getElementById("DragMoveBtn_1").onmousedown=h;for(var f in g.controls)if("olControlNavigation"==g.controls[f].displayClass){a=g.controls[f];break}},setCircle:function(a,b){g.events.register("zoomend",this,k);c=a;document.getElementById("OpenLayers_Control_DragMove_1").style.display="block";d(b);f(a,b);g.zoomToExtent(e.getDataExtent())},creatbuffer:function(a,b){for(var c=0;c<b.length;c++){var d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);d.fillColor="blue";d.fillOpacity=.2;d.labelAlign="lb";d.labelXOffset=20;d.strokeColor="red";d.strokeOpacity=1;b[c].style=d}e.addFeatures(b);c=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);c.fillColor="#0000ff";c.fillOpacity=.5;c.strokeColor="#0000ff";c.strokeOpacity=.7;c.strokeWidth=4;c.cursor="pointer";a.style=c;e.addFeatures([a]);g.zoomToExtent(e.getDataExtent())},clear:function(){g.events.unregister("zoomend",this,k);document.getElementById("OpenLayers_Control_DragMove_1").style.display="none";e.removeAllFeatures();c=null}}}(),ResourceList=function(){function k(a){h();var c={UserID:getCookie("USERID")||-1,dctime:(new Date).getTime()};$.ajax({type:"get",data:c,url:Service.ResourceList+"?value\x3d"+a,dataType:"json",dataFilter:function(a){if(null==a||""==a)alert("\u65e0\u6743\u9650\u64cd\u4f5c\u6216\u6570\u636e\u83b7\u53d6\u51fa\u73b0\u5f02\u5e38\uff01");else{a=JSON.parse(a).Result;for(var c=0;c<a.length;c++)0==a[c].ISLAYER&&(a[c].nocheck=!0,a[c].isParent=!0);$.fn.zTree.init($("#pub_tc_tree"),w,a)}}})}function d(a,c){var b=$("#"+c.tId+"_switch"),e=$("#"+c.tId+"_check"),d=$("#"+c.tId+"_ico");b.remove();e.remove();d.before(b);d.before(e)}function m(a,d,p){null==b&&(b=[]);if(p.checked){b.push(p.ID);a=b.length;0<a&&(v=$.fn.zTree.getZTreeObj("pub_tc_tree").getNodeByParam("ID",b[a-1],null),c.push(v));if(0!=$("#diyBtn_space_"+p.ID).length)$("#diyBtn_space_"+p.ID).show();else{var r;$.ajax({url:p.SERVICEURL+"/legend?f\x3dpjson",cache:!0,dataType:"json",success:function(a){r=a;a=document.createElement("DIV");if(r&&r.layers)for(var c=p.NAME,b=0,e=r.layers.length;b<e;b++)if(r.layers[b].layerName==c){c=r.layers[b];b=[];for(e=0;e<c.legend.length;e++){var d=c.legend[e].label.replace("\x3c","\x26lt;").replace("\x3e","\x26gt;");b.push("\x3cdiv\x3e\x3cimg src\x3d'data:"+c.legend[e].contentType+";base64,"+c.legend[e].imageData+"'\x3e\x3cspan\x3e"+d+"\x3c/span\x3e\x3c/div\x3e")}$(a).append(b.join(""));a.className="ztree-legend";a.id="diyBtn_space_"+p.ID;$("#"+p.tId).append(a);p.checked||$("#diyBtn_space_"+p.ID).hide();break}}})}if(e.contains(p.ID))a=e.get(p.ID),wmswmts.hashLayers.contains(p.ID)?wmswmts.Setshow(p.ID):sdMap.map.addLayer(e.get(p.ID));else{a=!0;if("WMS"==p.SERVICETYPE){d={LAYERS:g(p.LAYERID,0),TRANSPARENT:!0,STYLES:"",FORMAT:"images/png"};var f=p.SERVICEURL.replace(/arcgis\/rest\/services/,"arcgis/services")+"/WMSServer";wms_layer=new OpenLayers.Layer.WMS("themLayer_"+p.ID,f,d,{isBaseLayer:!1,opacity:.7,singleTile:!0})}else"WMS\u548cWMTS\u6df7\u5408"==p.SERVICETYPE&&(a=p.WMTSTYPE.split(","),a={id:p.ID,url:p.SERVICEURL,layer:g(p.LAYERID,0),l:a},wms_layer=wmswmts.newLayer(a,!0).l_wms,a=!1);e.put(p.ID,wms_layer);!a||sdMap.map.addLayer(wms_layer)}}else $("#diyBtn_space_"+p.ID).hide(),a=e.get(p.ID),wmswmts.hashLayers.contains(p.ID)?wmswmts.removeLayer(p.ID):sdMap.map.removeLayer(a),b.removeArr(p.ID),c.removeQueryArr(p.ID),0==b.length&&(b=null,c=[],IdentifyQueryTool.clear(),PoiInfoPop.close(),l())}function h(){var a=$.fn.zTree.getZTreeObj("pub_tc_tree");if(a){for(var d=a.getCheckedNodes(!0),p=0;p<d.length;p++){if(e.contains(d[p].ID)){var r=e.get(d[p].ID);wmswmts.hashLayers.contains(d[p].ID)?wmswmts.removeLayer(d[p].ID):sdMap.map.removeLayer(r)}$("#diyBtn_space_"+d[p].ID).hide()}a.checkAllNodes(!1);b=null;c=[];IdentifyQueryTool.clear();PoiInfoPop.close();l()}}function l(){u=!1;document.detachEvent?sdMap.map.viewPortDiv.detachEvent("onclick",f):sdMap.map.viewPortDiv.removeEventListener("click",f)}function f(a){if(0!=u){var b=c.length;if(1>b)alert("\u8bf7\u5728\u8d44\u6e90\u76ee\u5f55\u4e2d\u6253\u5f00\u8981\u67e5\u8be2\u7684\u56fe\u5c42!");else if(b=c[b-1],!(0>b.SERVICETYPE.indexOf("WMS"))){var e=a.xy;e||(e=$(sdMap.map.div).offset(),e={x:a.clientX-e.left,y:a.clientY-e.top});var d=sdMap.map.getLonLatFromPixel(e);a=sdMap.map.size;a=a.w+","+a.h+",96";e=15;switch(b.GEOMETRYTYPE){case "esriGeometryPoint":e=15;break;case "esriGeometryPolyline":e=5;break;case "esriGeometryPolygon":e=0}a={imageDisplay:a,sr:sdMap.map.getProjection().split(":")[1],mapExtent:sdMap.map.getExtent().toString(),geometry:'{"x":'+d.lon+',"y":'+d.lat+"}",layers:"all:"+g(b.LAYERID,1),geometryType:"esriGeometryPoint",returnGeometry:!1,tolerance:e,f:"json"};e=b.SERVICEURL+"/identify";jQuery.support.cors=!0;$.ajax({data:a,method:"POST",url:e,returnFields:b.RETURNFIELDS,success:function(a){a=JSON.parse(a);null!=a.results&&0<a.results.length&&PoiInfoPop.show("resourcelist",d,a.results[0].attributes,null)},error:function(a,c,b){}})}}}function g(a,c){var b=[];if(a)for(var e=a.split(","),d=/[^\[]*\[(.*)\][^\]]*/,f,g=0,y=e.length;g<y;g++)f=0==c?e[g].split("[")[0]:e[g].replace(d,"$1"),b.push(f);return b.join(",")}var a=!1,c=[],b=null,e=new HashTable,v,w,u=!1,y=null;(new Date).getTime();Array.prototype.removeArr=function(a){for(var c=0;c<this.length;c++)if(this[c]==a){if(0<=c&&c<this.length){for(var e=c;e<this.length;e++)this[e]=this[e+1];--this.length}b=this}};Array.prototype.removeQueryArr=function(a){for(var b=0;b<c.length;b++)if(c[b].ID==a){var e=c;if(0<=b&&b<e.length){for(var d=b;d<e.length;d++)e[d]=e[d+1];--e.length}c=e}};return{init:function(c){a||(w={check:{enable:!0},view:{showLine:!1,showicon:!0,fontCss:{color:"#595959"},addDiyDom:d},data:{key:{name:"ALAISENAME"},simpleData:{enable:!0,idKey:"ID",pIdKey:"PID",rootPId:0}},callback:{onCheck:m}},k(0),style=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),style.pointRadius=5,style.fillColor="#4EEE94",style.strokeColor="#4EEE94",style.fillOpacity=.6,style.cursor="pointer",y=new OpenLayers.Layer.Vector("resourceResult",{style:style,rendererOptions:{zIndexing:!0}}),$(".tab_resource_title #cancelAll").click(h),a=!0,wmswmts.init(c),IdentifyQueryTool.init())},clear:function(){h();SpatialQueryTool.clear()},getQuerNodeArr:function(){return c},getSelNodeArr:function(){return b},clearResultMarker:function(){y.removeAllFeatures()},openIdentify:function(){if(1>c.length)return alert("\u8bf7\u5728\u4e13\u9898\u76ee\u5f55\u4e2d\u6253\u5f00\u8981\u67e5\u8be2\u7684\u56fe\u5c42!"),$("#tab_resource_identi").find("input").attr("checked",!1),!1;document.attachEvent?sdMap.map.viewPortDiv.attachEvent("onclick",f,!1):sdMap.map.viewPortDiv.addEventListener("click",f,!1);return u=!0},closeIdentify:l,showAttrTables:function(){}}}(),IdentifyQueryTool=function(){function k(){ResourceList.openIdentify()&&(l=!0,sdMap.map.layerContainerDiv.style.cursor="help")}function d(){l=!1;ResourceList.closeIdentify();m()}function m(){$("#tab_resource_identi").find("input").attr("checked",!1);sdMap.map.layerContainerDiv.style.cursor="default";l=!1}var h=!1,l=!1;return{init:function(){h||($("#tab_resource_identi ").click(function(){(l=$(":checkbox",this)[0].checked)?k():d()}),h=!0)},open:k,close:d,clear:m}}(),RightMenu=function(){var k,d=!1,m;return{init:function(h){d||(k=h,$(".olMapViewport").mouseup(function(d){if(3==d.which){var f,g=$(this).offset();f=d.clientX-g.left;d=d.clientY-g.top;m=k.map.getLonLatFromPixel(new Ol2.Pixel(f,d));$("#rightDiv").css({display:"block",left:f+2,top:d})}}).click(function(){$("#rightDiv").hide()}).after("\x3cdiv id \x3d 'rightDiv'\x3e\t\x3cul\x3e\t\t\x3cli id \x3d 'right_from' style \x3d 'margin-top:3px;'\x3e\u4ee5\u6b64\u4e3a\u8d77\u70b9\x3c/li\x3e\t    \x3cli id \x3d 'right_to'  \x3e\u4ee5\u6b64\u4e3a\u7ec8\u70b9\x3c/li\x3e\t    \x3cli id \x3d 'right_around' style\x3d'height:23px;'\x3e\x3cdiv class\x3d'splitline'\x3e\u5728\u6b64\u70b9\u9644\u8fd1\u627e...\x3c/div\x3e\x3c/li\x3e     \t\t\x3cli id \x3d 'right_zoomin' \x3e\u653e\u5927\x3c/li\x3e\t\t\x3cli id \x3d 'right_zoomout' \x3e\u7f29\u5c0f\x3c/li\x3e       \x3cli id \x3d 'right_addcorrect' \x3e\x3cdiv class\x3d'splitline' style\x3d'border-bottom:none'\x3e\u6570\u636e\u9519\u8bef\u53cd\u9988...\x3c/div\x3e\x3c/li\x3e\t\x3c/ul\x3e\x3c/div\x3e"),$("#rightDiv li").click(function(){$("#rightDiv").css("display","none");switch(this.id){case "right_from":switchSearch("s3");PathSearch.setStart(new Ol2.Feature.Vector(new Ol2.Geometry.Point(m.lon,m.lat)),2);break;case "right_to":switchSearch("s3");PathSearch.setEnd(new Ol2.Feature.Vector(new Ol2.Geometry.Point(m.lon,m.lat)),2);break;case "right_around":PoiInfoPop.show("around",m);break;case "right_zoomout":k.map.zoomOut();break;case "right_zoomin":k.map.zoomIn();break;case "right_addcorrect":MapCorrect.openCorrect({TYPE:0,LNG:m.lon,LAT:m.lat})}}),d=!0)}}}(),WholeSearch=function(){function k(a,b){var e=y.length;if(0==e)$("#item").empty();else{var d,p=(a-1)*b;d=p+b>=e?e:p+b;if(q!=a)for(var r=p+b>=e?e:p+b,e=(q-1)*b;e<r;e++)y[e].style=c;q=a;t.redraw();for(var r=["\x3cul style\x3d'list-style:none'\x3e"],f=null,g=1,e=p;e<d;e++)f=y[e].attributes,r.push("\x3cli idx\x3d"+g+" class\x3d'itemClass'\x3e"),r.push("\x3cdiv class\x3d'itemIcon' style\x3d'background-position: "+-21*(g-1)+"px 0px;'\x3e\x3c/div\x3e"),r.push("\x3cp class\x3d'pName' style\x3d'line-height: 20px;'\x3e"),r.push(y[e].attributes.name+"\x26nbsp;\x3e\x3e"+(null!=y[e].attributes.geometry&&""!=f.class_text?"\x3cspan class\x3d'pType'\x3e"+f.class_text+"\x3c/span\x3e":"")),r.push("\x3c/p\x3e"),f.distance&&r.push("\x3cp class\x3d'pDistance'\x3e"+f.distance+"\x3c/p\x3e"),"\u6682\u65e0\u8bb0\u5f55"!=f.address&&r.push("\x3cp class\x3d'pAddress_Phone'\x3e\u5730\u5740:"+f.address+"\x3c/p\x3e"),"\u6682\u65e0\u8bb0\u5f55"!=f.telephone&&r.push("\x3cp class\x3d'pAddress_Phone'\x3e\u7535\u8bdd:"+f.telephone+"\x3c/p\x3e"),r.push("\x3cp class\x3d'pBottom'\x3e\x3ca class\x3d'poi_correct' onclick\x3d'MapCorrect.openCorrect({TYPE:1,LSID:\""+f.lsid+"\"})'href\x3d'javascript:void(0)'\x3e\x3cimg class\x3d'correct_jiu' alt\x3d'\u7ea0\u9519' src\x3d'images/leftDiv/icon_qipao_correct.png'\x3e\u7ea0\u9519\x3c/a\x3e\x3c/p\x3e"),r.push("\x3c/li\x3e"),p=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),p.externalGraphic="images/leftDiv/ball/r ("+g+").png",p.graphicWidth=21,p.graphicHeight=33,p.fillOpacity=1,p.cursor="pointer",p.graphicYOffset=-32,y[e].style=p,t.drawFeature(y[e]),g++;r.push("\x3c/ul\x3e");$("#item").empty().append(r.join(""))}}function d(){u.map.events.on({moveend:function(){if(w&&p&&!p.radius){var c=u.map.getExtent();p.area="RECT("+c.left+" "+c.bottom+","+c.right+" "+c.top+")";a("local",p)}}});var c=function(){$("#poiSearch_suglist").hide()};document.attachEvent?u.map.viewPortDiv.attachEvent("onclick",c,!1):u.map.viewPortDiv.addEventListener("click",c,!1);t.events.on({featureselected:function(a){a.feature.attributes&&PoiInfoPop.show("local",a.feature.geometry,a.feature.attributes)}});$("#left_query_btn").click(function(c){PoiInfoPop.close();if(c=$("#left_query_text").val())z=!0,$("#resultCount").text("\u6b63\u5728\u641c\u7d22...."),switchSearch("s2"),$("#textlist").hide(),w=!0,p={words:c,pagecap:50},a("local",{words:c,pagecap:50})});$("#left_query_text").keyup(function(c){13==c.which?($("#left_query_btn").click(),$("#poiSearch_suglist").hide(),F=!1,clearTimeout(B)):(F||(B=setTimeout(function(){F=!1;var c=$("#left_query_text").val().Trim();""!=c&&($("#textlist").show(),a("list",{words:c},l))},300),F=!0),""==$(this).val().Trim()&&($("#poiSearch_suglist").hide(),$(document).unbind("click",m)))});$("#textlist").on("click",".textlistitem",function(c){$("#left_query_text").val($(this).text());$("#textlist").hide();$("#pageId").empty();$("#item").empty();switchSearch("s2");a("obtain",{fid:$(this).attr("id")})});$("#textlist").on("click","#textlistclose",function(){$("#textlist").hide()});$(".fenleiClass").click(function(c){b=$(this).attr("code");c=$(this).text();$("#resultCount").text("\u6b63\u5728\u641c\u7d22....");$("#left_query_text").val(c.Trim());switchSearch("s2");$("#item").empty();c=u.map.getExtent();p={area:"RECT("+c.left+" "+c.bottom+","+c.right+" "+c.top+")","class":b,pagecap:200};w=!0;a("local",p)});$("#returnBtn").click(function(a){null!=t&&(t.removeAllFeatures(),r.removeAllFeatures());PoiInfoPop.close();$("#item").empty();p=null;$("#left_query_text").val("");switchSearch("s1")});$("#item").on("mouseenter",".itemClass",function(){var a=$(this),c=a.attr("idx"),a=a.find("div:eq(0)");a.css("background-position",a.css("background-position").split(" ")[0]+" -66px");a=10*(q-1)+parseInt(c)-1;y[a].style.externalGraphic="images/leftDiv/ball/b ("+c+").png";t.drawFeature(y[a])});$("#item").on("mouseleave",".itemClass",function(a){var c=$(this);a=c.attr("idx");c=c.find("div:eq(0)");c.css("background-position",c.css("background-position").split(" ")[0]+" 0px");c=10*(q-1)+parseInt(a)-1;y[c].style.externalGraphic="images/leftDiv/ball/r ("+a+").png";t.drawFeature(y[c])});$("#item").on("click",".itemClass",function(){var a=w;w=!1;var c=parseInt($(this).attr("idx")),c=10*(q-1)+c-1,b=y[c].geometry;PoiInfoPop.show("local",y[c].geometry,y[c].attributes);r.features.length>c?u.map.zoomToExtent(r.features[c].geometry.getBounds()):u.map.setCenter(new Ol2.LonLat(b.x,b.y),14);w=a})}function m(a){a=a||window.event;0==$(a.target).closest("#poiSearch_suglist").length&&($("#poiSearch_suglist").hide(),$(document).unbind("click",m))}function h(){PoiInfoPop.close();var c=$(this).attr("crd").split(";");w=!1;$("#left_query_text").val(c[3]);a("obtain",{lsid:c[2]},function(a){switchSearch("s2");f(a.result.features);0<a.result.entitytotal&&g([a.result.features[0]],!0);w=!1});u.map.setCenter(new Ol2.LonLat(parseFloat(c[0]),parseFloat(c[1])));$("#poiSearch_suglist").hide()}function l(a){var c=$("#left_query_text").offset();$("#poiSearch_suglist").empty().append(a).show().css({left:c.left+"px",top:c.top+28+"px"}).children("div").click(h);$(document).bind("click",m)}function f(a){t.removeAllFeatures();r.removeAllFeatures();y=[];var c=a.length;$("#resultCount").html("\x26nbsp;\u5171\u6709"+c+"\u6761\u7ed3\u679c");for(var b=0;b<c;b++){var d=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(a[b].lng),parseFloat(a[b].lat)),a[b]);d.attributes.address=d.attributes.address||(d.attributes.district_text?d.attributes.district_text.replace(/(\u5c71\u4e1c\u7701|\u5e02\u8f96\u533a)|>/g,""):"\u6682\u65e0\u8bb0\u5f55");d.attributes.telephone=d.attributes.telephone||"\u6682\u65e0\u8bb0\u5f55";y.push(d)}t.addFeatures(y);q=1;e.doPage(q,y.length)}function g(a,c){for(var b=[],e=0;e<a.length;e++){var d=a[e],d=(new Ol2.Format.WKT).read(d.geometry);b.push(d)}0<b.length&&(Util.HighlightGeo(r,b),c&&(z=!1,u.map.zoomToExtent(b[0].geometry.getBounds())))}function a(a,c,b){switch(a){case "local":a=encodeURI(Service.LS+parseParam(c));$.ajax({dataType:"jsonp",url:a,success:function(a){f(a.result.features);g(a.result.features.slice(0,a.result.entitytotal),z);"function"==typeof b&&b(a)}});break;case "buffer":"object"==typeof c?p=c:p.radius=c;a=encodeURI(Service.LS+parseParam(p));$.ajax({dataType:"jsonp",url:a,success:function(a){f(a.result.features);"function"==typeof b&&b(a)}});break;case "rgc2":a=encodeURI(Service.RGC2+parseParam(c));$.ajax({dataType:"jsonp",url:a,success:function(a){"function"==typeof b&&b(a)}});break;case "list":a=encodeURI(Service.LS+parseParam(c));$.ajax({dataType:"jsonp",url:a,success:function(a){if("function"==typeof b){a=a.result.features;for(var e=[],d=0;d<a.length;d++){var p=a[d].name,p=p.replace(c.words,"\x3cb\x3e"+c.words+"\x3c/b\x3e"),p="\x3cspan class\x3d'poi_tip_name'\x3e"+p+"\x26nbsp;\x3c/span\x3e",r=a[d].district_text?a[d].district_text.replace(/(\u5c71\u4e1c\u7701|\u5e02\u8f96\u533a)|>/g,""):"";if(""!=r)var r=r.replace(c.words,"\x3cb\x3e"+c.words+"\x3c/b\x3e"),r="\x3cspan class\x3d'poi_tip_district'\x3e"+r+"\x3c/span\x3e",f="";null!=a[d].geometry&&""!=a[d].class_text&&(f="\x3cspan class\x3d'poi_tip_type'\x3e"+a[d].class_text+"\x3c/span\x3e");e.push("\x3cdiv crd\x3d'"+a[d].lng+";"+a[d].lat+";"+a[d].lsid+";"+a[d].name+"'\x3e"+p+r+f+"\x3c/div\x3e")}e.push("\x3chr style\x3d'height:1px;border:none;border-top: 1px #ebebeb solid;'\x3e\x3c/hr\x3e\x3ca id\x3d'poiSearch_suglistclose' title\x3d'\u5173\u95ed' href\x3d'javascript:void(0)' \x3e\u5173\u95ed\x3c/a\x3e");b(e.join(""))}}});break;case "obtain":a=encodeURI(Service.LSID+parseParam(c)),$.ajax({dataType:"jsonp",url:a,success:function(a){"function"==typeof b&&b(a)}})}}var c,b,e,v=!1,w=!0,u,y=[],t,q=1,p,r,z=!1,F=!1,B;return{clearResult:function(){null!=t&&t.removeAllFeatures();u.graLayer.removeAllFeatures();r.removeAllFeatures();PoiInfoPop.close();$("#item").empty();p=null;$("#left_query_text").val("")},request:a,init:function(a){v||(u=a,c=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),c.pointRadius=4,c.fillColor="#0000ff",c.fillOpacity=.3,c.strokeColor="#0000ff",c.strokeOpacity=.4,c.strokeWidth=4,c.cursor="pointer",c.externalGraphic="images/leftDiv/ball/r.png",c.graphicOpacity=1,c.graphicHeight=c.graphicWidth=8,r=new Ol2.Layer.Vector("entityLayer",{style:c,rendererOptions:{zIndexing:!0}}),u.addLayer(r),t=new Ol2.Layer.Vector("seach",{style:c,rendererOptions:{zIndexing:!0}}),u.addLayer(t,!0),$("#tab_search_div2").append("\x3cdiv class\x3d'poisearch_result_head'\x3e    \u641c\u7d22\u7ed3\u679c\x3cinput id \x3d 'returnBtn' class\x3d'poisearch_result_return' type \x3d 'button' value \x3d '\u8fd4\u56de'/\x3e\x3c/div\x3e\x3cdiv id \x3d 'resultCount'\x3e\u6b63\u5728\u641c\u7d22....\x3c/div\x3e\x3cdiv id \x3d 'item' class \x3d 'poisearch_list'\x3e\x3c/div\x3e\x3cdiv class\x3d'pageDiv' id\x3d'wholepageDiv' style\x3d'width:100%;bottom:15px;position:absolute;'\x3e\x3cul class\x3d'page'\x3e\x3c/ul\x3e\x3c/div\x3e"),e=new PageCtl,e.init("wholepageDiv",k,10),0==$("#poiSearch_suglist").length&&($(document.body).append("\x3cdiv id\x3d'poiSearch_suglist' style\x3d'position:absolute;display:none;'\x3e\x3c/div\x3e"),$("#poiSearch_suglist").delegate("a","click",function(){$("#poiSearch_suglist").hide()})),d(),v=!0)}}}(),PathSearch=function(){var k=null,d=null,m=0,h=0,l=!1,f=null,g=null,a=null,c=null,b=null,e=null,v=null,w=null,u=-1,y=null,t=null,q=[],p=[],r=[],z=[],F=null,B=null,C=null,n=null,E=null,H=null,I={fillOpacity:1,fillColor:"blue",strokeOpacity:1,strokeColor:"blue",pointRadius:3},A={ConvertToP:function(a){for(var c=[],b=a.length/10,e,d,p,r=0;r<b;r++)e=10*r,d=e+5,p=d+5,e=a.substring(e,d),d=a.substring(d,p),e=parseInt(e,36)/1E5,d=parseInt(d,36)/1E5,c.push(e),c.push(d);return c},ClipSeg:function(a,c,b){var e=A.floorTo(a[0],5);a=A.floorTo(a[1],5);var d=A.floorTo(c[0],5);c=A.floorTo(c[1],5);for(var p=-1,r=-1,f=b.length/2,n=0;n<f;n++){var q=2*n,g=q+1;-1==p?b[q]==e&&b[g]==a&&(p=n):b[q]==d&&b[g]==c&&(r=n)}return-1!=p&&-1!=r?b.slice(2*p,2*r+2):null},floorTo:function(a,c){var b=a+"",e=b.indexOf("."),d=b.length;return-1==e||6>=d-e?a:parseFloat(b.substring(0,e+6))},exceptionHandler:function(){c.removeAllFeatures();c.refresh();A.switchLayerZIndex(b,c);H.deactivate();H.activate();$("#distanceLabel").hide();$("#pathListdiv").html("\x3cdiv style\x3d'font-size:14px;padding:15px;color:#0070E6;margin-left:10px;'\x3e\u65e0\u5bfc\u822a\u7ed3\u679c\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u8def\u7ebf...\x3c/div\x3e")},requestData:function(a){var c=$("#paramDiv #p_type :checked").val();"nohign"==c?(a.highway=0,a.type=1):"fast"==c&&(a.type=1);try{$("#distanceLabel").hide(),$("#pathListdiv").html("\u6b63\u5728\u67e5\u8be2..."),$.ajax({url:Service.PATH+parseParam(a),dataType:"jsonp",success:A.parseData,error:function(a,c){A.exceptionHandler()}})}catch(b){A.exceptionHandler()}},parseData:function(a,e,d){if("success"==e&&(z=A.ConvertToP(a.result.route.routetxt),c.removeAllFeatures(),b.removeAllFeatures(),"ok"==a.status&&a.result.events&&0!=a.result.events.length)){e=a.result;$("#distanceLabel").text("\u9a7e\u8f66\u8def\u7ebf        \u7ea6"+a.result.distance+".");$("#distanceLabel").css("display","block");if(e.route){d=[];var f=turf.point([k.geometry.x,k.geometry.y]),n=[];a=0;for(var q=z.length;a<q;a+=2)d.push(new Ol2.Geometry.Point(z[a],z[a+1])),n.push([z[a],z[a+1]]);a=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);a.strokeColor="#3231fb";a.strokeOpacity=1;a.strokeWidth=3;a.cursor="pointer";y=new Ol2.Feature.Vector(new Ol2.Geometry.LineString(d));y.style=a;c.addFeatures(y);v.removeAllFeatures();DrawFlowPath(y.geometry,v);b.addFeatures(r);a=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);a.strokeColor="#0000ff";a.strokeOpacity=.8;a.strokeWidth=3;a.strokeDashstyle="dot";a.cursor="pointer";d={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}};for(var q=b.features,n=[],t=0,h=q.length;t<h;t++){var u=q[t].geometry,f=turf.point([u.x,u.y]),f=turf.pointOnLine(d,f),f=new Ol2.Feature.Vector(new Ol2.Geometry.LineString([u,new Ol2.Geometry.Point(f.geometry.coordinates[0],f.geometry.coordinates[1])]));f.style=a;n.push(f)}c.addFeatures(n);g.map.zoomToExtent(y.geometry.getBounds());A.pathStartEdit()}d=[];e=e.events;n=!1;a=0;for(q=e.length;a<q;a++){t=e[a];0==a&&(t.eventprompt=t.eventprompt.replace("\u6cbf\u65e0\u540d\u9053\u8def",""));h=0;0<t.nextdistance.search("\u516c\u91cc")?h=1E3*t.nextdistance.replace("\u516c\u91cc",""):0<t.nextdistance.search("\u7c73")&&(h=t.nextdistance.replace("\u7c73",""));if(n)if(""==t.roadname){if("\u76f4\u884c"==t.turntype){f=d.length-1;u=d[f].nextdistance;0<u.search("\u7c73")?h=parseInt(h)+parseInt(u.replace("\u7c73","")):0<u.search("\u516c\u91cc")&&(h=parseInt(h)+1E3*parseInt(u.replace("\u516c\u91cc","")));u="";u=1E3<h?h/1E3+"\u516c\u91cc":h+"\u7c73";d[f].eventprompt=d[f].eventprompt.replace(d[f].nextdistance,u);d[f].nextdistance=u;continue}}else{var n=!1,f=d.length-1,u=d[f].nextdistance,l=0;0<u.search("\u7c73")?l=parseInt(u.replace("\u7c73","")):0<u.search("\u516c\u91cc")&&(l=1E3*parseInt(u.replace("\u516c\u91cc","")));if(("\u76f4\u884c"==t.turntype||0<=t.turntype.search("\u504f")&&t.turntype==d[f].turntype)&&20>l&&"\u76f4\u884c"!=d[f].turntype){0<u.search("\u7c73")?h=parseInt(h)+parseInt(l):0<u.search("\u516c\u91cc")&&(h=parseInt(h)+parseInt(l));u=1E3<h?h/1E3+"\u516c\u91cc":h+"\u7c73";d[f].roadname=t.roadname;d[f].eventprompt=d[f].eventprompt.replace(d[f].nextdistance,u).replace("\u65e0\u540d\u9053\u8def",t.roadname);0<=t.turntype.search("\u504f")&&(d[f].turntype=d[f].turntype.replace("\u504f",""),d[f].eventprompt=d[f].eventprompt.replace("\u504f",""));d[f].nextdistance=u;continue}}else if(""==t.roadname&&(n=!0,"\u76f4\u884c"==t.turntype&&50>h)){f=d.length-1;u=d[f].nextdistance;0<u.search("\u7c73")?h=parseInt(h)+parseInt(u.replace("\u7c73","")):0<u.search("\u516c\u91cc")&&(h=parseInt(h)+1E3*parseInt(u.replace("\u516c\u91cc","")));u=1E3<h?h/1E3+"\u516c\u91cc":h+"\u7c73";d[f].eventprompt=d[f].eventprompt.replace(d[f].nextdistance,u);d[f].nextdistance=u;continue}d.push(t)}e=d.length;p=[];q=$("\x3cul\x3e\x3c/ul\x3e");for(a=0;a<e;a++)p.push({index:a+1,note:d[a].eventprompt,lonlat:d[a].lng+","+d[a].lat}),n=p[a].index+". "+p[a].note,q.append($("\x3cli id\x3d'p_ul_"+p[a].index+"'\x3e\x3c/li\x3e").text(n)).append("\x3cdiv class\x3d'bm'\x3e\x3c/div\x3e");$("#pathListdiv").empty();$("#pathListdiv").append(q)}},startMark:function(a){u=a;E.activate()},pathItemClicked:function(a){if(t)c.removeFeatures(t);else{t=new Ol2.Feature.Vector;var b=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);b.strokeColor="#B318F3";b.strokeOpacity=.6;b.strokeWidth=7;t.style=b}b=a.target.id.replace("p_ul_","");b=parseInt(b);a=p[b-1].lonlat.split(",");var d=parseFloat(a[0]),e=parseFloat(a[1]);b==p.length?g.map.setCenter(new Ol2.LonLat(d,e)):(b=p[b].lonlat.split(","),a=A.ClipSeg(a,b,z),t.geometry=A.makeLine(a),c.addFeatures(t),t&&(g.map.zoomToExtent(t.geometry.getBounds()),g.map.zoomTo(g.map.zoom-1),4E3>g.map.getScale()&&g.map.zoomToScale(4509),g.map.setCenter(t.geometry.getCentroid())))},keyPressedHandler:function(a){var c=$(a.target).attr("mk"),b=$(a.target).val().trim();if(""!=b&&c!=b){var d=$(a.target).parent().attr("id"),d=parseInt("startDiv"==d?-2:"endDiv"==d?-3:d.replace("waypt_",""));$(a.target).attr("mk",b);$.get(Service.LS+"words\x3d"+encodeURI(b),null,function(c,e,f){if("success"==e&&(e=c.result.features)){c=[];for(f=0;f<e.length;f++){var p=e[f].name,p=p.replace(b,"\x3cb\x3e"+b+"\x3c/b\x3e"),p="\x3cspan class\x3d'poi_tip_name'\x3e"+p+"\x26nbsp;\x3c/span\x3e",r=e[f].district_text?e[f].district_text.replace(/(\u5c71\u4e1c\u7701|\u5e02\u8f96\u533a)|>/g,""):"";""!=r&&(r=r.replace(b,"\x3cb\x3e"+b+"\x3c/b\x3e"),r="\x3cspan class\x3d'poi_tip_district'\x3e"+r+"\x3c/span\x3e");c.push($("\x3cdiv\x3e\x3c/div\x3e").html(p+r).attr("onclick","PathSearch.setWsposition(this,"+d+","+e[f].lng+","+e[f].lat+",'"+e[f].name+"')"))}c.push("\x3chr style\x3d'height:1px;border:none;border-top: 1px #ebebeb solid;'\x3e\x3c/hr\x3e\x3ca id\x3d'poiSearch_suglistclose' title\x3d'\u5173\u95ed' href\x3d'javascript:void(0)' \x3e\u5173\u95ed\x3c/a\x3e");e=$(a.target).offset();$("#poiSearch_suglist").empty().append(c).show().css({left:e.left+"px",top:e.top+28+"px"})}},"jsonp")}},getRgc:function(a,c){var b=a.geometry,d=[];d.push(Service.RGC2);d.push("type\x3d11\x26point\x3d");d.push(b.x);d.push(",");d.push(b.y);$.get(d.join(""),null,function(b,d,e){"success"==d&&(b="ok"==b.status?b.result.address||b.result.road_address:"\u81ea\u5b9a\u4e49\u70b9",-2==c?$("#startDiv :text").val(b):-3==c?$("#endDiv :text").val(b):($("#waypt_"+c+" :text").val(b),b=$("#waypt_"+c+" :button"),$(b[0]).attr("popupid",a.id),$(b[1]).attr("popupid",a.id)))},"jsonp")},refreshMarker:function(){b.removeAllFeatures();var a=[];k&&a.push(k);d&&a.push(d);b.addFeatures(a);for(var c=a=0;c<q.length;c++)if(null!=q[c].v){var e=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);e.externalGraphic="images/leftDiv/png/"+(a+1)+"[1].png";e.graphicWidth=23;e.graphicHeight=25;e.fillOpacity=1;e.cursor="pointer";q[c].v.style=e;b.addFeatures(q[c].v);a++}},pathStartEdit:function(){E.deactivate();null==C?(C=new Ol2.Control.ModifyFeature(c),C.createVertices=!0,f.addControl(C)):(C.deactivate(),C.initialize(c));n.activate();f.resetLayersZIndex()},makeLine:function(a){for(var c=[],b=0;b<a.length;b+=2)c.push(new Ol2.Geometry.Point(parseFloat(a[b]),parseFloat(a[b+1])));return new Ol2.Geometry.LineString(c)},indexOfLyr:function(a,c,b){a=f.getPixelFromLonLat(new Ol2.LonLat(a.x,a.y));c=c.features;var d=c.length;switch(b){case 1:for(b=0;b<d;b++){var e=f.getPixelFromLonLat(new Ol2.LonLat(c[b].geometry.x,c[b].geometry.y));if(a.x<e.x+11.5&&a.x>e.x-11.5&&a.y<e.y+12.5&&a.y>e.y-12.5)return b}break;case 2:for(b=0;b<d;b++)if(e=f.getPixelFromLonLat(new Ol2.LonLat(c[b].geometry.x,c[b].geometry.y)),a.x<e.x+6+24&&a.x>e.x+6&&a.y<e.y+-25+20&&a.y>e.y+-25)return b}return-1},deletePopupById:function(a){for(var c=f.popups,b=c.length-1;0<=b;b--)if(c[b].id===a){f.removePopup(c[b]);break}},buildWayPtPopup:function(a,c,b){var e="\x3cdiv\x3e\x3clabel unselectable\x3d'on' class\x3d'lbl-other-area popup-labels' style\x3d'z-index:100;'\x3e\x3cspan class\x3d'popup-txt'\x3e\x3c/span\x3e\x3cdiv class\x3d'popup-btns1'\x3e\x3cimg src\x3d'images/lineRemove.png' popupid\x3d'"+a+"' onclick\x3d'PathSearch.removeWaypoint("+b+",this)' class\x3d'celianClose'/\x3e\x3c/div\x3e\x3c/label\x3e\x3c/div\x3e",d=Ol2.Util.getRenderedDimensions(e,null,{});d.h=20;d.w=24;a=new Ol2.Popup.Anchored(a,c,d,e,{size:new Ol2.Size(15,10),offset:new Ol2.Pixel(6,-25)},!1,null);a.calculateNewPx=function(a){return a.offset(this.anchor.offset)};a.minSize=d;a.opacity="1";a.backgroundColor=null;a.routeIndex=b;a.routeFlag=1;return a},switchLayerZIndex:function(a,c){var b=a.getZIndex(),d=c.getZIndex();b<d&&(a.setZIndex(d),c.setZIndex(b))},setDrawLayerDefaultStyle:function(a,c){a.styleMap.styles["default"].setDefaultStyle(c)},getCurrPtGeometryIndex:function(a,c){for(var b=-1,d=a.length-1;0<=d;d--)if(a[d].id===c.id){b=d;break}return b},closeModify:function(){null!=C&&(null!=C.feature&&C.unselectFeature(C.feature),C.deactivate())},mousemoveFunc:function(a){var c=$(".olMapViewport").offset();a=new Ol2.Pixel(a.clientX-c.left,a.clientY-c.top);a=f.getLonLatFromPixel(a);a=new Ol2.Geometry.Point(a.lon,a.lat);n.considerSnapping(a,a)}};return{init:function(d){l||(f=d.map,g=d,$("#tab_gps_div").append("\x3cdiv id\x3d'paramDiv' style\x3d'width: 100%;padding-top:10px;'\x3e\x3cdiv id\x3d'p_type' class\x3d'route_radio'\x3e\x3cspan\x3e\x3cinput type\x3d'radio' name\x3d'p_schame' value\x3d'fast' /\x3e\u6700\u5feb\u7ebf\u8def\x3c/span\x3e \x3cspan\x3e\x3cinput type\x3d'radio' name\x3d'p_schame' value\x3d'short'checked /\x3e\u6700\u77ed\u7ebf\u8def\x3c/span\x3e\x3cspan\x3e\x3cinput type\x3d'radio' name\x3d'p_schame' value\x3d'nohign'/\x3e\u4e0d\u8d70\u9ad8\u901f\x3c/span\x3e\x3c/div\x3e\x3cdiv style\x3d'position: relative;padding-left:10px;'\x3e\x3cdiv class\x3d'route_switch' title\x3d'\u8c03\u6362\u8d77\u6b62\u70b9'\x3e\x3cinput onclick\x3d'PathSearch.switchDirection()'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv class\x3d'route_search_box'\x3e\x3cp id\x3d'startDiv' class\x3d'route_input route_input_start'\x3e\x3cimg src\x3d'images/leftDiv/transparent.gif' title\x3d'\u8bf7\u8f93\u5165\u9a7e\u8f66\u8d77\u70b9'\x3e\x3cinput type\x3d'text' class\x3d'route_textInput' style\x3d'width:210px;'/\x3e\x3cinput type\x3d'button' title\x3d'\u7ed8\u5236\u8d77\u70b9' class\x3d'route_draw route_draw_start' onclick\x3d'PathSearch.setStart()'/\x3e\x3c/p\x3e\x3cp id\x3d'waypoints' style\x3d'display: none;padding: 0'\x3e\x3c/p\x3e\x3cp id\x3d'endDiv' class\x3d'route_input route_input_end'\x3e\x3cimg src\x3d'images/leftDiv/transparent.gif' title\x3d'\u8bf7\u8f93\u5165\u9a7e\u8f66\u7ec8\u70b9'\x3e\x3cinput type\x3d'text' class\x3d'route_textInput' style\x3d'width:210px;'/\x3e\x3cinput type\x3d'button' title\x3d'\u7ed8\u5236\u7ec8\u70b9' class\x3d'route_draw route_draw_end' onclick\x3d'PathSearch.setEnd()'/\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'margin:10px 12px 0px 12px;padding-bottom:10px;'\x3e\x3ca class\x3d'route_btn' onclick\x3d'PathSearch.doSearch()'\x3e\x3cimg style\x3d'background-position: -78px -86px;' src\x3d'images/leftDiv/transparent.gif'\x3e\u67e5\u8be2\u7ebf\u8def\x3c/a\x3e\x3ca class\x3d'route_btn' onclick\x3d'PathSearch.clearResult()'\x3e\x3cimg style\x3d'background-position: -94px -86px;' src\x3d'images/leftDiv/transparent.gif'\x3e\u6e05\u9664\u7ed3\u679c\x3c/a\x3e\x3ca class\x3d'route_btn' style\x3d'width:95px;margin-right:0px;' onclick\x3d'PathSearch.addWaypoint()'\x3e\x3cimg style\x3d'background-position: -109px -86px;' src\x3d'images/leftDiv/transparent.gif'\x3e\u6dfb\u52a0\u9014\u7ecf\u70b9\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'pathResult' style\x3d'position: relative;border:0;border-top:#e5e5e5 solid 1px;'\x3e\x3cdiv id\x3d'distanceLabel' class\x3d'route_result_distance'\x3e\x3c/div\x3e\x3cdiv id\x3d'pathListdiv' data-calc-height\x3d'100%-40' style\x3d'height: 450px;overflow-y: auto;'\x3e\x3c/div\x3e\x3c/div\x3e"),w=new Ol2.StyleMap({fillOpacity:0,strokeOpacity:0,strokeColor:"blue",pointRadius:3}),d=new Ol2.StyleMap({fillOpacity:0,strokeOpacity:0,pointRadius:15}),c=new Ol2.Layer.Vector("pathsearchLayer",{isRoadSearch:1,styleMap:d,rendererOptions:{zIndexing:!1}}),b=new Ol2.Layer.Vector("stationLayer",{styleMap:w,rendererOptions:{zIndexing:!1}}),v=new Ol2.Layer.Vector("pathDLayer",{styleMap:w,rendererOptions:{zIndexing:!1}}),e=new Ol2.Layer.Vector("snapPtLayer"),a=(a=Ol2.Util.getParameters(window.location.href).renderer)?[a]:Ol2.Layer.Vector.prototype.renderers,f.addLayers([e,c,b]),f.addLayers([v]),$("#p_type :radio").click(function(a){PathSearch.doSearch()}),c.events.on({vertexmodified:function(a){F=new Ol2.Feature.Vector(a.vertex)},featuremodified:function(a){b.styleMap.styles["default"].setDefaultStyle(w);A.closeModify();a=a.feature;null!=F.geometry&&(F.geometry.id==a.geometry.components[0].id||F.geometry.id==a.geometry.components[a.geometry.components.length-1].id?PathSearch.doSearch():PathSearch.addWaypoint(F),$("#pathroot_popup").attr("display","block"))}}),$("#pathListdiv").delegate("li","click",A.pathItemClicked),$("#paramDiv").delegate(":text","keyup",A.keyPressedHandler),l=!0)},setWsposition:function(a,c,b,d,e){$("#poiSearch_suglist").slideUp(200);a=new Ol2.Geometry.Point(b,d);a=new Ol2.Feature.Vector(a);-2==c?(PathSearch.setStart(a,1),$("#startDiv :text").val(e)):-3==c?(PathSearch.setEnd(a,1),$("#endDiv :text").val(e)):(PathSearch.setWaypoint(c,a,1),$("#waypt_"+c+" :text").val(e))},doSearch:function(){if(null!=k&&null!==d){var a=parseInt($("#paramDiv").css("height")),c=parseInt($("#tab_gps_div").css("height"));$("#pathResult").attr("data-calc-height","100%-"+a).css("height",c-a+"px");$(window).resize();a="";r=[];r.push(k);if(0<h)for(c=0;c<h;c++)null!=q[c].v&&(a+=q[c].v.geometry.x+","+q[c].v.geometry.y+";",r.push(q[c].v));r.push(d);c={start:k.geometry.x+","+k.geometry.y,end:d.geometry.x+","+d.geometry.y,type:0,highway:1};""!=a&&(c.waypoint=a.replace(/;$/,""));$("#tab_gps").hasClass("active")||$("#tab_gps").click();A.requestData(c)}},initCtrl:function(){this.clearResult();E=new Ol2.Control.DrawFeature(b,Ol2.Handler.Point,{handlerOptions:{layerOptions:{renderers:a,styleMap:w}}});E.events.on({featureadded:function(a,c){-2==u?PathSearch.addStart(a.feature):-3==u?PathSearch.setEnd(a.feature):0<=u?(null!=B&&A.deletePopupById(B),PathSearch.setWaypoint(u,a.feature)):(b.removeFeatures([a.feature]),b.redraw());u=-1;A.setDrawLayerDefaultStyle(b,w);b.refresh()}});f.addControl(E);H=new Ol2.Control.DragFeature(b,{onComplete:function(a,c){try{A.closeModify(),n.deactivate()}catch(d){}var e=A.getCurrPtGeometryIndex(b.features,a),p=-1;0===e?p=-2:e===b.features.length-1?p=-3:0<=e&&(p=e-1);A.getRgc(a,p);PathSearch.doSearch();f.resetLayersZIndex();for(var e=new Ol2.LonLat(a.geometry.x,a.geometry.y),p=f.popups,r=a.id,q=0,g=p.length;q<g;q++)if(r===p[q].id){g=p[q].routeIndex;f.removePopup(p[q]);e=A.buildWayPtPopup(r,e,g);f.addPopup(e);break}H.deactivate()}});f.addControl(H);H.activate();n=new Ol2.Control.Snapping({layer:b,targets:[{layer:c,tolerance:15}],eventListeners:{snap:function(a){f.resetLayersZIndex();A.switchLayerZIndex(c,b);C.activate();C.selectFeature(c.features[0]);C.handlers.drag.dragging||(a=a.point,-1!=A.indexOfLyr(a,b,1)?(A.switchLayerZIndex(b,c),A.closeModify(),H.activate()):-1!=A.indexOfLyr(a,b,2)&&(A.closeModify(),f.resetLayersZIndex()),5<=h?A.closeModify():(e.removeAllFeatures(),a=new Ol2.Feature.Vector(a.clone()),a.style=I,e.addFeatures([a]),e.redraw()))},unsnap:function(a){e.removeAllFeatures();e.redraw();A.closeModify();A.switchLayerZIndex(b,c);H.activate()}}});f.addControl(n);n.activate();f.events.on({mousemove:A.mousemoveFunc})},addStart:function(a,c){A.setDrawLayerDefaultStyle(b,I);if(null==a)A.startMark(-2);else{b.removeFeatures(k);var d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);d.externalGraphic="images/path/start.png";d.graphicWidth=23;d.graphicHeight=25;d.fillOpacity=1;d.cursor="pointer";a.style=d;null==c?(A.getRgc(a,-2),b.redraw()):1==c?b.addFeatures(a):2==c?(A.getRgc(a,-2),b.addFeatures(a)):3==c&&(null!=a.attributes.name?$("#startDiv :text").val(a.attributes.name):A.getRgc(a,-2),b.addFeatures(a));k=a;PathSearch.doSearch()}b.redraw()},setStart:function(a,c){null!=E&&null!=H&&null!=n||PathSearch.initCtrl();E.activate();PathSearch.addStart(a,c)},addEnd:function(a,c){A.setDrawLayerDefaultStyle(b,I);if(null==a)A.startMark(-3);else{b.removeFeatures(d);var e=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);e.externalGraphic="images/path/end.png";e.graphicWidth=23;e.graphicHeight=25;e.fillOpacity=1;e.cursor="pointer";a.style=e;null==c?(A.getRgc(a,-3),b.redraw()):1==c?b.addFeatures(a):2==c?(A.getRgc(a,-3),b.addFeatures(a)):3==c&&(null!=a.attributes.name?$("#endDiv :text").val(a.attributes.name):A.getRgc(a,-3),b.addFeatures(a));d=a;PathSearch.doSearch()}},setEnd:function(a,c){null!=E&&null!=H&&null!=n||PathSearch.initCtrl();E.activate();PathSearch.addEnd(a,c)},setWaypoint:function(a,c,d,e){A.setDrawLayerDefaultStyle(b,I);if(null==c)null!=e&&(B=$(e).attr("popupId")),A.startMark(a);else for(e=0;e<q.length;e++)if(q[e].i==a){null!=q[e].v&&b.removeFeatures(q[e].v);var p=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);p.externalGraphic="images/leftDiv/png/"+(e+1)+"[1].png";p.graphicWidth=23;p.graphicHeight=25;p.fillOpacity=1;p.cursor="pointer";c.style=p;null==d?(A.getRgc(c,a),b.redraw()):1==d?b.addFeatures(c):2==d&&(A.getRgc(c,a),b.addFeatures(c));q[e].v=c;a=A.buildWayPtPopup(c.id,new Ol2.LonLat(c.geometry.x,c.geometry.y),m-1);f.addPopup(a);PathSearch.doSearch();break}},addWaypoint:function(a){null!=E&&null!=H&&null!=n||PathSearch.initCtrl();E.activate();if(5<=h)alert("\u9014\u5f84\u70b9\u5df2\u6dfb\u52a0\u5230\u4e0a\u9650");else{var c=null;null!=a&&(c=a.id);0==h&&$("#waypoints").css("display","block");c=$("\x3cp class\x3d'route_input'\x3e\x3c/p\x3e").attr("id","waypt_"+m).html("\x3cimg src\x3d'images/leftDiv/transparent.gif' title\x3d'\u8bf7\u8f93\u5165\u9a7e\u8f66\u9014\u7ecf\u70b9'\x3e\x3cinput type\x3d'text' class\x3d'route_textInput' style\x3d'width: 190px;'/\x3e\x3cinput type\x3d'button'  class\x3d'route_draw route_draw_mid' title\x3d'\u7ed8\u5236\u9014\u7ecf\u70b9' popupId\x3d'"+c+"' onclick\x3d'PathSearch.setWaypoint("+m+", null, null, this)'/\x3e\x3cinput type\x3d'button' class\x3d'route_draw route_draw_delete' title\x3d'\u5220\u9664' popupId\x3d'"+c+"' onclick\x3d'PathSearch.removeWaypoint("+m+", this)' /\x3e");$("#waypoints").append(c);q.push({i:m,v:null});m++;h++;null!=a&&PathSearch.setWaypoint(m-1,a,2)}},removeWaypoint:function(a,c){A.closeModify();$("#waypt_"+a).remove();for(var e=0;e<q.length;e++)if(q[e].i==a){e=q.splice(e,1);b.removeFeatures(e[0].v);break}h--;0==h&&$("#waypoints").css("display","none");A.refreshMarker();null!=c&&(e=$(c).attr("popupId"),A.deletePopupById(e));PathSearch.doSearch();f.resetLayersZIndex()},clearResult:function(){if(null!=f&&null!=b&&null!=c){A.setDrawLayerDefaultStyle(b,w);$("#waypoints").empty().hide();$("#startDiv :text").val("");$("#endDiv :text").val("");m=h=0;q=[];p=[];u=-1;$("#pathListdiv").empty();null!=c&&c.removeAllFeatures();null!=b&&b.removeAllFeatures();null!=e&&e.removeAllFeatures();null!=v&&v.removeAllFeatures();$("#distanceLabel").text("");$("#distanceLabel").css("display","none");d=k=null;if(null!=f.popups)for(var a=f.popups.length-1;0<=a;a--)1===f.popups[a].routeFlag&&f.removePopup(f.popups[a]);null!=E&&E.deactivate();null!=C&&(C.deactivate(),C=null);null!=n&&(n.deactivate(),n=null);null!=H&&(H.deactivate(),H=null);f.resetLayersZIndex();f.events.un({mousemove:A.mousemoveFunc})}},switchDirection:function(){if(null!=k&&null!=d){var a=k.geometry;k.geometry=d.geometry;d.geometry=a;var a=$("#startDiv :text"),c=$("#endDiv :text"),b=a.val();a.val(c.val());c.val(b);if(1<h)for(q.reverse(),a=$("#waypoints").children().toArray(),$("#waypoints").empty(),c=a.length-1;0<=c;c--)$("#waypoints").append(a[c]);A.refreshMarker();PathSearch.doSearch()}}}}(),MeasureTool=function(){var k,d={mPointLayer:new Ol2.Layer.Vector("mpoint"),mPolylineLayer:new Ol2.Layer.Vector("mpolyline"),mPolygonLayer:new Ol2.Layer.Vector("mpolygon")},m=null,h=null,l=[],f=void 0,g=void 0,a=void 0,c=void 0,b=!1,e=!1,v=null,w=null,u=null,y=0,t=void 0,q={closeModify:function(){null!=v&&(null!=v.feature&&v.unselectFeature(v.feature),v.deactivate())},deletePopupById:function(a){for(var c=k.popups,b=c.length-1;0<=b;b--)if(c[b].id===a){k.removePopup(c[b]);break}},updatePopupStr:function(a,c){var b=$("#span_"+c.id);1>a?1>100*a?(b.html((1E6*a).toFixed(0)),b.next().eq(0).html("\u5e73\u65b9\u7c73")):(b.html((100*a).toFixed(2)),b.next().eq(0).html("\u516c\u9877")):(b.html(a.toFixed(2)),b.next().eq(0).html("\u5e73\u65b9\u516c\u91cc"))},convertValueByUnit:function(a,c){c=parseFloat(c);"\u7c73"===a&&(c/=1E3);return c},vertexModifiedFunc:function(a,c){var b=a.vertex;f=b;var e=new Ol2.LonLat(b.x,b.y),q=d.mPointLayer.getFeatureBy("ptInMlineId",b.id);u.handler.point.move(e);q?(g=2,q.move(e),c?modifyLineUpdatePopups(a.feature,b,e,2):modifyPolygonUpdatePopups(a.feature,b,e,2)):(g=1,c?modifyLineUpdatePopups(a.feature,b,e,1):modifyPolygonUpdatePopups(a.feature,b,e,1))},featureModifiedFunc:function(e,r){if(1===g){t&&(k.removePopup(t),t=void 0);var u=e.feature.id,y=f.id,l=new Ol2.Feature.Vector(f,{ctype:"mlpoint"});l.measureFeatureId=u;l.ptInMlineId=y;l.pointType=2;d.mPointLayer.addFeatures([l]);r?(l.belongToType=1,l=buildPopup(r,"popup_"+l.id,new Ol2.LonLat(f.x,f.y),a,m,2)):(l.belongToType=2,l=b?buildPopup(r,"popup_"+l.id,new Ol2.LonLat(f.x,f.y),c,h,3):buildPopup(r,"popup_"+l.id,new Ol2.LonLat(f.x,f.y),null,null,2));l.measureFeatureId=u;l.ptInMlineId=y;k.addPopup(l)}q.resetAllStatus(r)},afterModifiedFunc:function(a){q.resetAllStatus(a);v.deactivate();u.deactivate();w.deactivate();k.resetLayersZIndex()},resetAllStatus:function(e){g=f=void 0;e?(a=void 0,d.mPolylineLayer.redraw()):(c=void 0,b=!1,d.mPolygonLayer.redraw());d.mPointLayer.redraw()},measureFunc:function(a,c){y=0;t&&(k.removePopup(t),t=void 0);var b=a.measure,e,f,q,n=a.units;c?(e=a.geometry,f=e.components.length,q="km"==n?b:b/1E3,m=n="\u516c\u91cc"):(e=a.geometry.components[0],f=e.components.length-1,q="km"==n?b:b/1E6,h=n="\u5e73\u65b9\u516c\u91cc");var g=e.components[f-1],b=new Ol2.Feature.Vector(e);c?(d.mPolylineLayer.addFeatures([b]),d.mPolylineLayer.redraw()):(d.mPolygonLayer.addFeatures([b]),d.mPolygonLayer.redraw());f===l.length+1&&(f=new Ol2.Feature.Vector(g,{ctype:"mlpoint"}),d.mPointLayer.addFeatures([f]),d.mPointLayer.redraw(),l.push(f.id));var u=l.length;f="popup_"+l[u-1];for(var v=k.popups,w=0;w<u;w++){var J=l[w],D=d.mPointLayer.getFeatureById(J);D.measureFeatureId=b.id;D.ptInMlineId=e.components[w].id;var G;c?(D.belongToType=1,G=u-1):(D.belongToType=2,G=u);D.pointType=0===w?1:w===G?3:2;for(D=v.length-1;0<=D;D--)v[D].id==="popup_"+J&&(v[D].id===f?k.removePopup(v[D]):(v[D].measureFeatureId=b.id,v[D].ptInMlineId=e.components[w].id))}e=new Ol2.LonLat(g.x,g.y);n=buildPopup(c,f,e,q,n,3);n.measureFeatureId=b.id;k.addPopup(n);l=[];$(".celianClose").css("cursor","pointer");$(".celianEdit").css("cursor","pointer");$("div.olMap").css({cursor:"default"});c?k.getControl("measureLineControl").deactivate():k.getControl("measurePolygonControl").deactivate();k.resetLayersZIndex()},measurePartialFunc:function(a,c){var b=a.measure,e,f=a.units;c?(e=a.geometry,b="km"==f?b:b/1E3,f="\u516c\u91cc"):(e=a.geometry.components[0],b="km"==f?b:b/1E6,f="\u5e73\u65b9\u516c\u91cc");var g=e.components.length,n;n=c?2:3;if(g!=y+n){var u;if(c)u=e.components[g-1];else{if(4>g)return;u=e.components[g-2]}e=new Ol2.LonLat(u.x,u.y);t&&(k.removePopup(t),t=void 0);t=buildPopup(c,"popup_layer",e,b,f,4);k.addPopup(t)}else{if(g<n)return;u=e.components[g-n];e=new Ol2.LonLat(u.x,u.y);n=2;2===g&&(n=1);g=new Ol2.Feature.Vector(u,{ctype:"mlpoint"});d.mPointLayer.addFeatures([g]);d.mPointLayer.redraw();l.push(g.id);f=buildPopup(c,"popup_"+g.id,e,b,f,n);k.addPopup(f);y++}q.setPointLayer2Top()},measureBtnClickFunc:function(a){$("#toolbag_div").css("display","none");null!=v&&(null!=v.feature&&v.unselectFeature(v.feature),v.deactivate());var c=k.getControl("measureLineControl"),b=k.getControl("measurePolygonControl");a?(b.deactivate(),c.activate()):(c.deactivate(),b.activate());$("div.olMap").css({cursor:"url('images/Line.cur'),auto"})},setPointLayer2Top:function(){k.setLayerZIndex(d.mPointLayer,k.getNumLayers()+1)},setMLayer2Top:function(a){k.setLayerZIndex(a,k.getNumLayers()+1)},getPtFeatureByPopupId:function(a){return(a=a.substring(6).replace(/(^\s*)|(\s*$)/g,""))?d.mPointLayer.getFeatureById(a):null},getMeasureFeatureByPtFeature:function(a,c){return c.getFeatureById(a.measureFeatureId)},getCurrPtGeometryIndex:function(a,c,b){var e=-1;a=a.geometry.components;var d=a.length;2===b&&--d;for(b=d-1;0<=b;b--)if(a[b].id===c){e=b;break}return e},getPtGeometry:function(a,c){return a.geometry.components[c]},getPopupByPtGeometry:function(a){var c=null;a="popup_"+d.mPointLayer.getFeatureBy("ptInMlineId",a.id).id;for(var b=k.popups,e=b.length-1;0<=e;e--)if(b[e].id===a){c=b[e];break}return c},getTwoPtDistance:function(a,c,b){a=new Ol2.Geometry.LineString([a,c]);b=b.getLength(a,"km");return parseFloat(b)},getGeometryArea:function(a,c){var b=Math.abs(c.getArea(a.geometry,"km"));return parseFloat(b)},getAfterAllPopupsDistance:function(a,c,b,e){var d=q.getPopupByPtGeometry(b),f=$("#span_"+d.id);b=parseFloat(f.html());"\u7c73"===f.next().eq(0).html()&&(b/=1E3);b=e-b;1>=e?(f.html(1E3*parseFloat(e.toFixed(1))),f.next().eq(0).html("\u7c73")):(f.html(e.toFixed(3)),f.next().eq(0).html("\u516c\u91cc"));q.updatePopupSize(d);c+=2;for(e=a.geometry.components.length;c<e;c++){var d=q.getPopupByPtGeometry(q.getPtGeometry(a,c)),f=$("#span_"+d.id),n=parseFloat(f.html());"\u7c73"===f.next().eq(0).html()&&(n/=1E3);n+=b;1>n?(f.html(1E3*parseFloat(n.toFixed(1))),f.next().eq(0).html("\u7c73")):(f.html(n.toFixed(3)),f.next().eq(0).html("\u516c\u91cc"));q.updatePopupSize(d)}},getPopupSize:function(a){a=Ol2.Util.getRenderedDimensions(a,null,{});a.h+=24;a.w+=1;return a},updatePopupSize:function(a){a.updateSize();var c=a.size;c.w+=1;a.setSize(c)},getMeasurePopup:function(a,c,b,e){var d=q.getPopupSize(b);d.h=$(b).height()+24;a=new Ol2.Popup.Anchored(a,c,d,b,{size:new Ol2.Size(15,10),offset:new Ol2.Pixel(5,-25)},!1,null);a.calculateNewPx=function(a){return a.offset(this.anchor.offset)};a.minSize=d;a.opacity="1";a.backgroundColor=null;a.pointType=e;return a}};return{init:function(p,r){if(!e){"object"==typeof p?$(p).append("\x3cli class\x3d'toolbagClass' id\x3d'btnMeasureLine'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img'\x3e\x3c/span\x3e\u6d4b\u8ddd\x3c/span\x3e\x3c/li\x3e\x3cli class\x3d'toolbagClass' id\x3d'btnMeasurePolygon'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position:-22px 0;'\x3e\x3c/span\x3e\u6d4b\u9762\x3c/span\x3e\x3c/li\x3e"):$("#"+p).append("\x3cli class\x3d'toolbagClass' id\x3d'btnMeasureLine'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img'\x3e\x3c/span\x3e\u6d4b\u8ddd\x3c/span\x3e\x3c/li\x3e\x3cli class\x3d'toolbagClass' id\x3d'btnMeasurePolygon'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position:-22px 0;'\x3e\x3c/span\x3e\u6d4b\u9762\x3c/span\x3e\x3c/li\x3e");k=r.map;var g=new Ol2.Style;g.addRules([new Ol2.Rule({symbolizer:{Point:{pointRadius:3,fillColor:"red",fillOpacity:1,strokeWidth:2,strokeOpacity:1,strokeColor:"#FF0000"},Line:{strokeWidth:3,strokeOpacity:.5,strokeColor:"red",strokeDashstyle:"solid"},Polygon:{strokeWidth:3,strokeOpacity:.5,strokeColor:"red",fillColor:"white",fillOpacity:.3}}})]);var g=new Ol2.StyleMap({"default":g,select:g,temporary:g,"delete":g,unselect:g}),y=Ol2.Util.getParameters(window.location.href).renderer,y=y?[y]:Ol2.Layer.Vector.prototype.renderers;d.mPointLayer.styleMap=g;d.mPolylineLayer.styleMap=g;d.mPolygonLayer.styleMap=g;k.addLayers([d.mPolygonLayer,d.mPolylineLayer,d.mPointLayer]);d.mPolylineLayer.events.on({vertexmodified:function(a){q.vertexModifiedFunc(a,1)},featuremodified:function(a){q.featureModifiedFunc(a,1)},afterfeaturemodified:function(a){q.afterModifiedFunc(1)}});d.mPolygonLayer.events.on({vertexmodified:function(a){q.vertexModifiedFunc(a,0)},featuremodified:function(a){q.featureModifiedFunc(a,0)},afterfeaturemodified:function(a){q.afterModifiedFunc(0)}});var l=new Ol2.Control.Measure(Ol2.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{renderers:y,styleMap:g}}});l.id="measureLineControl";l.events.on({measure:function(a){q.measureFunc(a,1)},measurepartial:function(a){q.measurePartialFunc(a,1)}});var C=new Ol2.Control.Measure(Ol2.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{renderers:y,styleMap:g}}});C.id="measurePolygonControl";C.events.on({measure:function(a){q.measureFunc(a,0)},measurepartial:function(a){q.measurePartialFunc(a,0)}});k.addControl(l);k.addControl(C);$("#btnMeasureLine").click(function(a){q.measureBtnClickFunc(1)});$("#btnMeasurePolygon").click(function(a){q.measureBtnClickFunc(0)});startEdit=function(a){if(a=$(a).attr("popupid")){a=q.getPtFeatureByPopupId(a);var c,b;1===a.belongToType?(c=q.getMeasureFeatureByPtFeature(a,d.mPolylineLayer),b=d.mPolylineLayer):2===a.belongToType&&(c=q.getMeasureFeatureByPtFeature(a,d.mPolygonLayer),b=d.mPolygonLayer);null==v?(v=new Ol2.Control.ModifyFeature(b),v.createVertices=!0,k.addControl(v)):(null!=v.feature&&v.unselectFeature(v.feature),v.deactivate(),v.initialize(b));v.activate();v.selectFeature(c);k.resetLayersZIndex();v.moveLayerToTop();u=new Ol2.Control.DrawFeature(d.mPointLayer,Ol2.Handler.Point);u.events.on({featureadded:function(a){d.mPointLayer.removeFeatures([a.feature]);d.mPointLayer.redraw()}});k.addControl(u);u.activate();w=new Ol2.Control.Snapping({layer:d.mPointLayer,targets:[{layer:b,tolerance:15}],eventListeners:{snap:function(a){v.moveLayerToTop()},unsnap:function(a){}}});k.addControl(w);w.activate()}};buildPopup=function(a,c,b,e,d,f){a=a?getLengthPopupElement(c,e,d,f):getAreaPopupElement(c,e,d,f);return q.getMeasurePopup(c,b,a,f)};getLengthPopupElement=function(a,c,b,e){var d="";0!=c&&(1>parseFloat(c)?(b="\u7c73",d=(1E3*parseFloat(c)).toFixed(1)):(b="\u516c\u91cc",d=parseFloat(c).toFixed(3)));return 4===e?'\x3cdiv style\x3d"height: 45px;width: 130px;overflow: hidden;" \x3e\x3clabel unselectable\x3d"on" class\x3d"lbl-other popup-labels" style\x3d"z-index:10; "\x3e\x3cspan id\x3d"span_'+a+'" class\x3d"popup-txt"\x3e'+d+"\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e"+b+"\x3c/span\x3e\x3c/label\x3e \x3cdiv style\x3d'position:absolute;margin:20px 0 0 10px;background-color:#fff;color:gray;'\x3e\u5355\u51fb\u786e\u5b9a\u70b9,\u53cc\u51fb\u7ed3\u675f\x3c/div\x3e\x3c/div\x3e":1===e||2===e?(1===e?(c="\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e\u8d77\u70b9",b="lbl-start"):(c=d+"\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e"+b,b="lbl-other"),'\x3cdiv\x3e\x3clabel unselectable\x3d"on" class\x3d"'+b+'  popup-labels" style\x3d"z-index:10;"\x3e\x3cspan id\x3d"span_'+a+'" class\x3d"popup-txt"\x3e'+c+'\x3c/span\x3e\x3cdiv class\x3d"popup-btns1"\x3e\x3cimg src\x3d"images/lineRemove.png" popupid\x3d"'+a+'" onclick\x3d"deleteFeatureNode(this,1)"  class\x3d"celianClose"\x3e\x3c/div\x3e\x3c/label\x3e\x3c/div\x3e'):'\x3cdiv\x3e\x3clabel unselectable\x3d"on" class\x3d"lbl-end popup-labels"  style\x3d"z-index:100;"\x3e\x3cspan id\x3d"span_'+a+'" class\x3d"popup-txt"\x3e'+d+"\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e"+b+'\x3c/span\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineRemove.png" popupid\x3d"'+a+'" onclick\x3d"deleteFeatureNode(this,1)" class\x3d"celianClose"\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineClean.png" popupid\x3d"'+a+'" onclick\x3d"deleteMeasureLineOrAreaLayer(this,1)" class\x3d"celianClose"\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineEdit.png" popupid\x3d"'+a+'" onclick\x3d"startEdit(this)" class\x3d"celianEdit"\x3e\x3c/div\x3e\x3c/label\x3e\x3c/div\x3e'};getAreaPopupElement=function(a,c,b,e){var d="";0!=c&&(1>parseFloat(c)?1>100*parseFloat(c)?(b="\u5e73\u65b9\u7c73",d=(1E6*parseFloat(c)).toFixed(0)):(b="\u516c\u9877",d=(100*parseFloat(c)).toFixed(2)):(b="\u5e73\u65b9\u516c\u91cc",d=parseFloat(c).toFixed(2)));return 4===e?'\x3cdiv style\x3d"height: 20px;width: 130px;\x3e\x3clabel unselectable\x3d"on" class\x3d"lbl-other-area popup-labels" style\x3d"z-index:10;"\x3e\x3cspan id\x3d"span_'+a+'" class\x3d"popup-txt"\x3e'+d+"\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e"+b+"\x3c/span\x3e\x3c/label\x3e\x3cdiv style\x3d'position:absolute;margin:22px 0 0 10px;background-color:#fff;color:gray;'\x3e\u5355\u51fb\u786e\u5b9a\u70b9,\u53cc\u51fb\u7ed3\u675f\x3c/div\x3e\x3c/div\x3e":3===e?'\x3cdiv\x3e\x3clabel unselectable\x3d"on" class\x3d"lbl-end popup-labels" style\x3d"z-index:100;"\x3e\x3cspan id\x3d"span_'+a+'" class\x3d"popup-txt"\x3e'+d+"\x3c/span\x3e\x3cspan class\x3d'popup-txt'\x3e"+b+'\x3c/span\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineRemove.png" popupid\x3d"'+a+'" onclick\x3d"deleteFeatureNode(this,0)" class\x3d"celianClose"/\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineClean.png" popupid\x3d"'+a+'" onclick\x3d"deleteMeasureLineOrAreaLayer(this,0)" class\x3d"celianClose"/\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-btns2"\x3e\x3cimg src\x3d"images/lineEdit.png" popupid\x3d"'+a+'" onclick\x3d"startEdit(this)" class\x3d"celianEdit"/\x3e\x3c/div\x3e\x3c/label\x3e\x3c/div\x3e':'\x3cdiv\x3e\x3clabel unselectable\x3d"on" class\x3d"lbl-other-area popup-labels" style\x3d"z-index:100;"\x3e\x3cspan class\x3d"popup-txt"\x3e\x3c/span\x3e\x3cdiv class\x3d"popup-btns1"\x3e\x3cimg src\x3d"images/lineRemove.png" popupid\x3d"'+a+'" onclick\x3d"deleteFeatureNode(this,0)" class\x3d"celianClose"/\x3e\x3c/div\x3e\x3c/label\x3e\x3c/div\x3e'};deleteLineNodeUpdatePopups=function(a,c){var b=a.geometry.components.length,e=q.getCurrPtGeometryIndex(a,c.ptInMlineId,1),d;if(e<b-1){if(0===e)b=q.getPtGeometry(a,1),d=q.getPopupByPtGeometry(b),$("#span_"+d.id).html("").parent().removeClass("lbl-other").addClass("lbl-start").children().eq(1).html("\u8d77\u70b9"),d.pointType=1,d=0,e=1;else{b=q.getPtGeometry(a,e-1);d=q.getPopupByPtGeometry(b);var f=$("#span_"+d.id);d=f.html();""===d&&(d=0);d=parseFloat(d);f=f.next().eq(0).html();d=q.convertValueByUnit(f,d)}f=q.getPtGeometry(a,e+1);b=q.getTwoPtDistance(b,f,l);q.getAfterAllPopupsDistance(a,e,f,d+b)}else e===b-1&&(b=q.getPtGeometry(a,e-1),b=q.getPopupByPtGeometry(b),d=$("#span_"+b.id),e=d.html(),d=d.next().eq(0).html(),e=q.convertValueByUnit(d,e),e=getLengthPopupElement(b.id,e,d,3),d=q.getPopupSize(e),b.setContentHTML(e),b.pointType=3,b.setSize(d))};modifyLineUpdatePopups=function(c,b,e,d){var f,g=c.geometry.components.length,r=q.getCurrPtGeometryIndex(c,b.id,1);if(0===r){if(d=q.getPopupByPtGeometry(b))e=buildPopup(1,d.id,e,0,null,d.pointType),k.removePopup(d),d.destroy(),k.addPopup(e),f=0}else{f=q.getPtGeometry(c,r-1);var p=q.getPopupByPtGeometry(f),u=$("#span_"+p.id),p=u.html(),u=u.next().eq(0).html();""===p&&(p=0);p=parseFloat(p);p=q.convertValueByUnit(u,p);f=q.getTwoPtDistance(f,b,l);f=p+f;if(2===d){if(d=q.getPopupByPtGeometry(b))e=buildPopup(1,d.id,e,f,null,d.pointType),k.removePopup(d),d.destroy(),k.addPopup(e)}else 1===d&&(a=f,t&&(k.removePopup(t),t=void 0),t=buildPopup(1,"length_popup_layer",e,f,m,4),k.addPopup(t))}r!==g-1&&(g=q.getPtGeometry(c,r+1),b=q.getTwoPtDistance(b,g,l),q.getAfterAllPopupsDistance(c,r,g,f+b))};modifyPolygonUpdatePopups=function(a,e,d,g){var p=q.getCurrPtGeometryIndex(a,e.id,2),r=a.geometry.components,u=r.length,h=q.getGeometryArea(a,C);c=h;p===u-2&&1===g?(b=!0,g=q.getPtGeometry(a,u-3),g=q.getPopupByPtGeometry(g),p=getAreaPopupElement(g.id,null,null,2),u=q.getPopupSize(p),g.setContentHTML(p),g.setSize(u),f=e,t&&(k.removePopup(t),t=void 0),t=buildPopup(0,"area_popup_layer",d,h,null,3),k.addPopup(t)):(b=!1,a=q.getPopupByPtGeometry(r[u-2]),q.updatePopupStr(h,a),q.updatePopupSize(a),2===g?(p===u-2?(e=a,g=e.pointType):(e=q.getPopupByPtGeometry(e),g=2),e&&(d=buildPopup(0,e.id,d,h,null,g),k.removePopup(e),e.destroy(),k.addPopup(d))):1===g&&(f=e,t&&(k.removePopup(t),t=void 0),t=buildPopup(0,"area_popup_layer",d,null,null,2),k.addPopup(t)))};deleteFeatureNode=function(a,c){q.closeModify();var b=$(a).attr("popupid");if(b){var e=q.getPtFeatureByPopupId(b),f=e.ptInMlineId,g,p,r,u=!1;c?(g=d.mPolylineLayer,p=2):(g=d.mPolygonLayer,p=3);var t=q.getMeasureFeatureByPtFeature(e,g),y=t.geometry.components,l,k;c?l=y.length:(l=y.length-1,k=t.geometry.components[l-1]);if(l===p){for(var m=0;m<p;m++)if(r=d.mPointLayer.getFeatureBy("ptInMlineId",y[m].id))q.deletePopupById("popup_"+r.id),d.mPointLayer.removeFeatures(r);g.removeFeatures(t)}else if(c)for(deleteLineNodeUpdatePopups(t,e),m=l-1;0<=m;m--){if(y[m].id===f){t.geometry.components.splice(m,1);break}}else{for(m=l;0<=m;m--)if(y[m].id===f)if(p=t.geometry.components,m===l){var v=p[1].clone();v.id=p[1].id;p.splice(m,1);p.splice(0,1);p.splice(t.geometry.components.length,0,v)}else m===l-1&&(r=t.geometry.components[m-1],u=!0),t.geometry.components.splice(m,1);t=q.getGeometryArea(t,C);u?(r=q.getPopupByPtGeometry(r),u=getAreaPopupElement(r.id,t,h,3),t=q.getPopupSize(u),r.setContentHTML(u),r.pointType=3,r.setSize(t)):(r=q.getPopupByPtGeometry(k),q.updatePopupStr(t,r),q.updatePopupSize(r))}d.mPointLayer.removeFeatures(e);g.redraw();q.deletePopupById(b)}};deleteMeasureLineOrAreaLayer=function(a,c){q.closeModify();var b=$(a).attr("popupid");if(b){for(var b=q.getPtFeatureByPopupId(b),b=c?q.getMeasureFeatureByPtFeature(b,d.mPolylineLayer):q.getMeasureFeatureByPtFeature(b,d.mPolygonLayer),e=b.geometry.components,f=e.length-1;0<=f;f--){var g=d.mPointLayer.getFeatureBy("ptInMlineId",e[f].id);g&&(q.deletePopupById("popup_"+g.id),d.mPointLayer.removeFeatures(g))}c?d.mPolylineLayer.removeFeatures(b):d.mPolygonLayer.removeFeatures(b)}};e=!0}},clear:function(){q.closeModify();for(var a in d)d[a].removeAllFeatures()}}}(),MapSwitch=function(){function k(){h.map.events.unregister("click",h.map,d)}function d(d){var f=h.map.getExtent(),f=f.left+","+f.bottom+","+f.right+","+f.top,g=d.xy;g||(g=$(h.map.div).offset(),g={x:d.clientX-g.left,y:d.clientY-g.top});var a=h.map.getLonLatFromPixel(g);d='{"x":'+a.lon+',"y":'+a.lat+"}";g=h.map.size;f={imageDisplay:g.w+","+g.h+",96",sr:h.map.getProjection().split(":")[1],mapExtent:f,geometry:d,layers:"all:0",geometryType:"esriGeometryPoint",returnGeometry:!1,tolerance:5,f:"json"};jQuery.support.cors=!0;$.ajax({data:f,method:"POST",url:"proxy/proxy.ashx?http://124.128.48.217:6080/arcgis/rest/services/streetview/MapServer/identify",success:function(c){c=JSON.parse(c);if(null!=c.results&&0<c.results.length){var b=a.lon,e=a.lat;setTimeout(function(){window.open("http://58.56.168.30:10071/Panorama/PanoTest/getPanoUrl?lon\x3d"+parseFloat(b)+"\x26lat\x3d"+parseFloat(e)+"\x26returnUrl\x3dhttp://www.sdmap.gov.cn")},1E3)}else alert("\u672a\u627e\u5230\u5168\u666f\u70b9,\u8bf7\u5728\u5168\u666f\u8f68\u8ff9\u8986\u76d6\u5904\u70b9\u51fb\u8fdb\u5165\u5168\u666f\uff01")},error:function(a,b,e){}})}var m=!1,h;return{init:function(l,f){m||(h=f,"object"==typeof l?$(l).append("\x3cdiv id\x3d'vec_' title\x3d'\u5730\u56fe' class\x3d'active'\x3e    \u5730 \u56fe\x3c/div\x3e\x3cdiv id\x3d'img_' title\x3d'\u5f71\u50cf'\x3e    \u5f71 \u50cf\x3c/div\x3e\x3cdiv id\x3d'img_year_div'\x3e \x3cdiv class\x3d'switch_zj'\x3e\x3cinput id\x3d'zjshow' type\x3d'checkbox' checked\x3d'checked'/\x3e\x3clabel\x3e\u6ce8\u8bb0\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e"):$("#"+l).append("\x3cdiv id\x3d'vec_' title\x3d'\u5730\u56fe' class\x3d'active'\x3e    \u5730 \u56fe\x3c/div\x3e\x3cdiv id\x3d'img_' title\x3d'\u5f71\u50cf'\x3e    \u5f71 \u50cf\x3c/div\x3e\x3cdiv id\x3d'img_year_div'\x3e \x3cdiv class\x3d'switch_zj'\x3e\x3cinput id\x3d'zjshow' type\x3d'checkbox' checked\x3d'checked'/\x3e\x3clabel\x3e\u6ce8\u8bb0\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e"),$("#img_").click(function(d){k();0<h.map.getLayersByName("Layer_streetview").length&&h.map.getLayersByName("Layer_streetview")[0].setVisibility(!1);$(this).addClass("active");$("#vec_").removeClass("active");$("#streetview_").removeClass("active");$("#img_year_div").show();$(".olControlScaleLineTop").css({border:"solid 2px white","border-top":"none",color:"white"});$(".olControlScaleLineBottom").css({border:"solid 2px white","border-bottom":"none",color:"white"});$(".number_year").removeClass("active");h.tileLayerManager.switchMap("img",Bzj)}),$("#vec_").click(function(d){k();0<h.map.getLayersByName("Layer_streetview").length&&h.map.getLayersByName("Layer_streetview")[0].setVisibility(!1);$("#img_year_div").hide();$(this).addClass("active");$("#img_").removeClass("active");$("#streetview_").removeClass("active");$(".olControlScaleLineTop").css({border:"solid 2px black","border-top":"none",color:"black"});$(".olControlScaleLineBottom").css({border:"solid 2px black","border-bottom":"none",color:"black"});h.tileLayerManager.switchMap("vec",!0)}),$("#img_").mouseenter(function(d){$(this).hasClass("active")&&$("#img_year_div").show()}),$("#img_year_div").mouseleave(function(d){$("#img_year_div").hide()}),$("#zjshow").click(function(d){$(this)[0].checked?(h.tileLayerManager.setVisibility("img_n",!0),Bzj=!0):(h.tileLayerManager.setVisibility("img_n",!1),Bzj=!1)}),$("#streetview_").click(function(f){$("#img_year_div").hide();$(this).addClass("active");$("#vec_").removeClass("active");$("#img_").removeClass("active");0<h.map.getLayersByName("Layer_streetview").length?h.map.getLayersByName("Layer_streetview")[0].setVisibility(!0):(f={LAYERS:[0],TRANSPARENT:!0,STYLES:"",FORMAT:"image/png",SRS:h.map.getProjection()},f=new Ol2.Layer.WMS("Layer_streetview","http://124.128.48.217:6080/arcgis/services/streetview/MapServer/WmsServer",f,{isBaseLayer:!1,opacity:.7,singleTile:!0}),h.map.addLayer(f));h.map.events.register("click",h.map,d)}),m=!0)}}}(),RegionSwitch2=function(){function k(d){if(10>d)return 0;if(14>d)return 1;if(19>d)return 2}function d(f){var a=sdmap.map.getExtent(),a=a.left+","+a.bottom+","+a.right+","+a.top,c=sdmap.map.getCenter(),b=sdmap.map.size;f={imageDisplay:b.w+","+b.h+",96",sr:4326,mapExtent:a,geometry:'{"x":'+c.lon+',"y":'+c.lat+"}",layers:"all:"+k(sdmap.map.zoom),geometryType:"esriGeometryPoint",returnGeometry:!!f,tolerance:0,f:"json"};$.ajax({url:"http://124.128.48.217:6080/arcgis/rest/services/sdxzj/MapServer/identify",data:f,dataType:"jsonp",type:"POST",success:function(a){if(a.results&&1>a.results.length)$("#btnxinzhenglabel").text(""),h.removeAllFeatures();else{a=a.results[0];$("#btnxinzhenglabel").text(a.attributes.\u540d\u79f0);var c=a.attributes.\u540d\u79f0+a.attributes.OBJECTID;l!=c&&(l=c,d(!0));if(a.geometry){a=a.geometry;h.removeAllFeatures();for(var c=[],b=0;b<a.rings.length;b++){for(var f=[],g=0;g<a.rings[b].length;g++){var t=new Ol2.Geometry.Point(a.rings[b][g][0],a.rings[b][g][1]);f.push(t)}f=new Ol2.Geometry.LinearRing(f);c.push(f)}a=new Ol2.Geometry.Polygon(c);a=new Ol2.Feature.Vector(a);h.addFeatures(a)}}},error:function(){console.log("failed")}})}function m(){f&&8<sdmap.map.zoom&&16>sdmap.map.zoom&&d(!1)}var h,l,f=!1;return{init:function(d){sdmap=d;sdmap.map.events.on({moveend:m});d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);d.fillOpacity=.05;d.strokeColor="blue";d.fillColor="blue";d.strokeWidth=2;d.strokeDashstyle="dot";h=new Ol2.Layer.Vector("\u884c\u653f\u8fb9\u754c",{style:d});sdmap.addLayer(h)},open:function(){f=!0;d(!0);$("#btnxinzhenglabel").show();RegionSwitch&&RegionSwitch.clear()},close:function(){f=!1;h.removeAllFeatures();$("#btnxinzhenglabel").hide()}}}(),RegionSwitch=function(){function k(a){a=eval(a);for(var c=a.length,b=[],e=0;e<c;e++){var d=a[e];b.push("\x3ctr shi\x3d'"+d[0]+"'\x3e");b.push("\x3ctd  class\x3d'mayerTitle' \x3e\x3ca\x3e"+d[0]+"\x3c/a\x3e\x3c/td\x3e");for(var f=1;f<d.length;f++)0==(f-1)%6&&1!=f&&b.push("\x3c/tr\x3e\x3ctr shi\x3d'"+d[0]+"'\x3e\x3ctd  class\x3d'mayerTitle' \x3e\x3c/td\x3e"),b.push("\x3ctd \x3e\x3ca href\x3d'javascript:void(0);'\x3e"+d[f]+"\x3c/a\x3e\x3c/td\x3e");b.push("\x3c/tr\x3e")}$("#cityTable").html(b.join(""))}function d(){$("#dict_text").removeClass("active");$("#dictDiv").css("display","none")}function m(a){a=a||window.event;0==$(a.target).closest("#dict").length&&(d(),$(document).unbind("click",m))}function h(){u&&l()}function l(){if(!y){$("#dictInfo").css("display","none");var a=b.map.getCenter(),c=b.map.getScale();$.ajax({type:"GET",dataType:"jsonp",url:Service.CityService+"?op\x3dgetdistrict\x26param\x3d{lon:"+a.lon+",lat:"+a.lat+",scale:"+c+"}",success:function(a){dataText=a.data;a=dataText.split(",");1==a.length?$("#dict_text").text(dataText):2==a.length?$("#dict_text").text(a[1]):3==a.length?$("#dict_text").text(a[1]+"\x3e"+a[2]):$("#dict_text").text(dataText.replace(/,/g,"\x3e"))},error:function(a,c){console.log&&console.log("\u884c\u653f\u53cd\u5b9a\u4f4d\u8bf7\u6c42\u9519\u8bef"+a)}})}}function f(c,d){var f=Service.CityService+"?op\x3dgetboundary\x26param\x3d{ways:"+(d?2:1)+",provinceName:'"+encodeURIComponent("\u5c71\u4e1c\u7701")+"',cityName:'"+encodeURIComponent(c)+"',countryName:'"+encodeURIComponent(d)+"'}";$.ajax({type:"GET",dataType:"jsonp",url:f,success:function(f){$("#dictInfoTitle").text(f.LINKNAME);$("#dictInfoText").text(f.DESCRIPTION);$("#linkId").attr("href",f.LINKURL);f=f.POINTS;""!=d?$("#dict_text").text(c+"\x3e"+d):$("#dict_text").text(c);g(f);y=!0;b.map.zoomToExtent(e.getDataExtent());setTimeout(function(){y=!1},500);w=1;v=setInterval(a,600);t=setTimeout(function(){e.removeAllFeatures()},1E4);setTimeout(function(){$("#dictInfo").click()},500);setTimeout(function(){$("#dictInfoClose").click()},3E3)},error:function(a){console.log&&console.log("\u884c\u653f\u5b9a\u4f4d\u8bf7\u6c42\u9519\u8bef"+a)}})}function g(a){var c="{rings:[";a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).replace(/(\({2})/g,"(");a=a.replace(/(\){2})/g,")");a=a.replace(/\(/g,"[").replace(/\)/g,"]");a=a.replace(/([\d\.]+)\s([\d\.]+)/g,"[$1,$2]");c=c+a+"]}";c=eval("("+c+")");e.removeAllFeatures();a=[];for(var b=0;b<c.rings.length;b++){for(var d=[],f=0;f<c.rings[b].length;f++){var g=new Ol2.Geometry.Point(c.rings[b][f][0],c.rings[b][f][1]);d.push(g)}d=new Ol2.Geometry.LinearRing(d);d=new Ol2.Geometry.Polygon([d]);a[b]=new Ol2.Feature.Vector(d)}e.addFeatures(a);e.redraw()}function a(){if(1==w){for(var a=0;a<e.features.length;a++)e.features[a].style.fillColor="green",e.features[a].style.fillOpacity=.6,e.redraw(!0);w+=1}else if(2==w){for(a=0;a<e.features.length;a++)e.features[a].style.fillColor="blue",e.features[a].style.fillOpacity=.6,e.redraw(!0);w+=1}else if(3==w){for(a=0;a<e.features.length;a++)e.features[a].style.fillColor="green",e.features[a].style.fillOpacity=.6,e.redraw(!0);w+=1}else if(4==w){for(a=0;a<e.features.length;a++)e.features[a].style.fillOpacity=0,e.redraw(!0);w+=1}else clearTimeout(v)}var c=!1,b,e,v,w,u=!0,y=!1,t;return{init:function(a,g){if(!c){b=g;"object"==typeof a?$(a).append("\x3cdiv id\x3d'dictInfo'title\x3d'\u70b9\u51fb\u67e5\u770b\u8be6\u60c5'\x3e\x3cdiv id\x3d'dictInfoDiv'\x3e\x3cdiv id\x3d'dictInfoTitle'\x3e\u5c71\u4e1c\u7701\x3c/div\x3e\x3cdiv id\x3d'dictInfoText'\x3e\x3c/div\x3e\x3cdiv id\x3d'dictInfoClose'\x3e\x3c/div\x3e\x3ca id\x3d'linkId'target\x3d'_blank'style\x3d'color:blue;margin-left: 250px;'\x3e\u8be6\u60c5\u94fe\u63a5\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'clear:both'\x3e\x3c/div\x3e\x3cdiv id\x3d'dictDiv'\x3e\x3cdiv id\x3d'dict_list_title'\x3e\x3ca class\x3d'sheng'\x3e\u5c71\u4e1c\u7701\x3c/a\x3e\x3cdiv id\x3d'dict_close'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'dict_item'\x3e\x3ctable border\x3d'0' cellspacing\x3d'0' cellpadding\x3d'0' width\x3d'100%' id\x3d'cityTable'\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e"):$("#"+a).append("\x3cdiv id\x3d'dictInfo'title\x3d'\u70b9\u51fb\u67e5\u770b\u8be6\u60c5'\x3e\x3cdiv id\x3d'dictInfoDiv'\x3e\x3cdiv id\x3d'dictInfoTitle'\x3e\u5c71\u4e1c\u7701\x3c/div\x3e\x3cdiv id\x3d'dictInfoText'\x3e\x3c/div\x3e\x3cdiv id\x3d'dictInfoClose'\x3e\x3c/div\x3e\x3ca id\x3d'linkId'target\x3d'_blank'style\x3d'color:blue;margin-left: 250px;'\x3e\u8be6\u60c5\u94fe\u63a5\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'clear:both'\x3e\x3c/div\x3e\x3cdiv id\x3d'dictDiv'\x3e\x3cdiv id\x3d'dict_list_title'\x3e\x3ca class\x3d'sheng'\x3e\u5c71\u4e1c\u7701\x3c/a\x3e\x3cdiv id\x3d'dict_close'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'dict_item'\x3e\x3ctable border\x3d'0' cellspacing\x3d'0' cellpadding\x3d'0' width\x3d'100%' id\x3d'cityTable'\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e");b.map.events.on({moveend:h,click:function(){d()}});$.ajax({url:"../dat/cities.txt",dataType:"text",success:k,error:function(a,c,b){console.log&&console.log("request cities data failed ! "+c)}});var r=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);r.fillOpacity=0;r.strokeColor="blue";r.fillColor="blue";r.strokeWidth=2;r.strokeDashstyle="dot";e=new Ol2.Layer.Vector("\u884c\u653f\u5b9a\u4f4d",{style:r});b.addLayer(e);$("#dict_text").click(function(){$(this).hasClass("active")?d():($("#dictDiv").css("display","block"),$(this).addClass("active"),$(document).bind("click",m))});$("#dict_close").click(function(a){d()});$(".sheng").click(function(){$("#dictDiv").css("display","none");$("#dictInfoDiv").css("display","none");var a=new Ol2.LonLat(119,36.4);b.map.setCenter(a,7)});$("#cityTable").on("click","td",function(){""!=$(this).text()&&($("#dictDiv").css("display","none"),$("#dictInfo").css("display","block"),$("#dictInfoDiv").css("display","none"),$(this).hasClass("mayerTitle")?(f($(this).text(),""),$("#dict_text").text($(this).text())):f($(this).parent().attr("shi"),$(this).text()),$("#dict_text").removeClass("active"))});$("#dictInfoClose").click(function(a){$("#dictInfoDiv").animate({height:0},"slow",function(){$(this).css({display:"none",height:"auto"})})});$("#dictInfo").click(function(a){"block"==$("#dictInfoDiv").css("display")?$("#dictInfoDiv").css("display","none"):($("#dictInfoDiv").css("height","auto"),a=$("#dictInfoDiv").height(),$("#dictInfoDiv").css("display","block"),$("#dictInfoDiv").css("height","0px"),$("#dictInfoDiv").animate({height:a},"slow",function(a){}))});c=!0}},clear:function(){e.removeAllFeatures();t&&(clearTimeout(t),t=null)},setActive:function(a){u=!!a}}}(),Clean=function(){var k=!1;return{init:function(d){k||($("#btnClear").click(function(d){$(".olPopup").css("display","none");$("#tab_search").click();$("#returnBtn").click();MeasureTool.clear();RegionSwitch.clear();$("#searchExtent").hide();PathSearch&&PathSearch.clearResult();PoiInfoPop.clear();Plotting.clear();WidgetManger.reset()}),k=!0)}}}(),FullScreen=function(){var k=!1;return{init:function(){k||($("#btnExtent").click(function(d){$("#left_hidden").hasClass("show")||$("#left_hidden").click();var k;d=$(window).height();if($(this).hasClass("extent")){$(this).removeClass("extent");if(k=parent.document.getElementById("topDiv"))k.style.display="block";if(k=parent.document.getElementById("content"))k.style.top="100px",k.style.height=d-100+"px",k.setAttribute("data-calc-height","100%-100");$("#left_center").css({height:d+"px"});$(this).html("\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -128px 0;'\x3e\x3c/span\x3e\u5168\u5c4f\x3c/span\x3e");$(this).css("width","54px");$("#left_hidden").click()}else{if(k=parent.document.getElementById("topDiv"))k.style.display="none";if(k=parent.document.getElementById("content"))k.style.top="0",k.style.height=d+100+"px",k.setAttribute("data-calc-height","100%-0"),$("#left_center").css({height:"100%"}),$(this).addClass("extent"),$(this).css("width","76px");$(this).html("\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -128px 0;'\x3e\x3c/span\x3e\u9000\u51fa\u5168\u5c4f\x3c/span\x3e")}setInterval(function(){$(window).resize()},500);sdMap.map.updateSize()}),k=!0)}}}(),PrintMapTool=function(){var k=null,d=!1;return{init:function(m,h){d||("object"==typeof m?$(m).append("\x3cli class\x3d'toolbagClass' id\x3d'btnPrintDiv'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -60px 0;top:3px;width:20px;'\x3e\x3c/span\x3e\u6253\u5370\x3c/span\x3e\x3c/li\x3e"):$("#"+m).append("\x3cli class\x3d'toolbagClass' id\x3d'btnPrintDiv'\x3e\x3cspan class\x3d'btnToolbar-cont1'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -60px 0;top:3px;width:20px;'\x3e\x3c/span\x3e\u6253\u5370\x3c/span\x3e\x3c/li\x3e"),k=h.map,$("#btnPrintDiv").click(function(d){$("#toolbag_div").css("display","none");d=k.getSize().w;var f=k.getSize().h,g=window.open(""),a=document.getElementById("mapDiv").innerHTML,c=parseInt(f)-10,b;b="\x3clink rel\x3d'stylesheet' type\x3d'text/css' href\x3d'third/jstree/themes/default/style.css' /\x3e\x3clink href\x3d'Openlayers/theme/default/style.css' rel\x3d'stylesheet' type\x3d'text/css' /\x3e \x3cstyle type\x3d\"text/css\"\x3e.olImageLoadError{background-color: pink; opacity: 0!important; filter: alpha(opacity\x3d0)!important;}";b=b+".print-container {margin: auto;width:"+d+"px;height:"+f+"px;top: 50px;position: relative;}";b+=".geoD {width: 100%;height: 24px;line-height: 24px;border-bottom: 3px solid #B2B2B2;font-size: 14px;margin-bottom: 6px;font-weight:bold;}";b+=".geoTitle {width: 300px;height: 20px;line-height: 20px;font-size: 14px;border:none;}";b=b+"#mapDiv {position: relative;height:"+c+"px;margin-bottom: 15px;clear: both;}";b+='#geoft {content: ".";height: 77px;display: block;overflow: hidden;clear: both;}';b+=".printMap {margin-bottom: 20px;float: right;}";b+=".printMap span {background-position: 0px 0px;cursor: pointer;margin-right: 0px;margin-top: 5px;display: inline-block;width: 69px;height: 29px;background-image: url(images/ToolBar/print.png);}";b+="\x3c/style\x3e";foot="\x3c/head\x3e\x3cscript type\x3d'text/javascript'src\x3d'third/util.min.js'\x3e\x3c/script\x3e\x3cbody\x3e\x3cdiv class\x3d'print-container'\x3e\x3cdiv class\x3d'geoD'\x3e\u6807\u9898\uff1a\x3cinput class\x3d'geoTitle' value\x3d'\u8bf7\u8f93\u5165\u6807\u9898\u4fe1\u606f\uff0c\u70b9\u51fb\u8f93\u5165''\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv id\x3d'mapDiv' \x3e"+a+"\x3c/div\x3e\x3cdiv id\x3d'geoft'\x3e\x3cdiv class\x3d'printMap'\x3e";foot+="\x3cspan id\x3d'printMap' onclick \x3d 'printDiv()'\x3e\x3c/span\x3e";foot+="\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/body\x3e\x3c/html\x3e";g.document.write("\x3c!DOCTYPE html\x3e\x3chtml\x3e\x3chead\x3e\x3cMETA HTTP-EQUIV\x3d'pragma' CONTENT\x3d'no-cache'\x3e\x3cMETA HTTP-EQUIV\x3d'Cache-Control' CONTENT\x3d'no-cache, must-revalidate'\x3e\x3cMETA HTTP-EQUIV\x3d'expires' CONTENT\x3d'Wed, 26 Feb 1997 08:21:57 GMT'\x3e\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html; charset\x3dutf-8' /\x3e\x3cmeta name\x3d'viewport' content\x3d'width\x3ddevice-width, initial-scale\x3d1.0, maximum-scale\x3d1.0, user-scalable\x3d0' /\x3e\x3cmeta name\x3d'apple-mobile-web-app-capable' content\x3d'yes' /\x3e\x3ctitle\x3e\u5730\u56fe\u6253\u5370\x3c/title\x3e"+b+"\x3cscript type \x3d 'text/javascript'\x3e\nfunction printDiv(){var divObj \x3d document.getElementById('printMap');divObj.style.display \x3d 'none';window.print();divObj.style.display \x3d 'block';}\x3c/script\x3e"+foot);DynamicLoading.css("css.min/style.min.css",g);g.document.close()}),d=!0)}}}(),CopyRightTool=function(){return{init:function(k){k.map.events.on({zoomend:function(d){d=d.object.getZoom();7>d?$("#remark").text("\u5ba1\u56fe\u53f7:GS(2017)508\u53f7(\u7248\u6743:\u56fd\u5bb6\u6d4b\u7ed8\u5730\u7406\u4fe1\u606f\u5c40)"):14>d?$("#remark").text("\u5ba1\u56fe\u53f7:GS(2017)508\u53f7(\u7248\u6743:\u56fd\u5bb6\u6d4b\u7ed8\u5730\u7406\u4fe1\u606f\u5c40) \u9c81SG(2017)040\u53f7(\u7248\u6743:\u5c71\u4e1c\u7701\u56fd\u571f\u8d44\u6e90\u5385)"):$("#remark").text("\u5ba1\u56fe\u53f7:\u9c81SG(2017)040\u53f7(\u7248\u6743:\u5c71\u4e1c\u7701\u56fd\u571f\u8d44\u6e90\u5385)")}})}}}(),MapCorrect=function(){return{userCookie:function(){var k="";if(g_userid)if(navigator.cookieEnabled){var d;d="jiucuo_loginid\x3d"+(escape("t:1,id:'"+g_userid+"',n:'"+g_username+"'")+";path\x3d/;");document.cookie=d}else k=encodeURI("?param\x3d"+g_userid+"#"+g_username);return k},openCorrect:function(k){0==$("#correctPopFrame").length&&$("body").append("\x3cdiv id\x3d'correctPopFrame'\x3e\x3cdiv style\x3d'filter:alpha(opacity:50);opacity:0.5;background:#000;width:100%;height:100%;position:absolute;left:0;top:0;z-index: 1100'\x3e\x3c/div\x3e\x3cdiv id\x3d'correct_view' style\x3d'position:absolute; left: 50%;top: 20px;padding: 0;margin-left:-480px;width:962px;height:482px;background-color:white;z-index: 1101'\x3e\x3ciframe width\x3d'100%' height\x3d'100%' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'no' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3cdiv id\x3d'corrview_close' style\x3d'position: absolute;top:5px;right:5px;width:20px;height:20px; background-image: url(images/close.png);' onclick\x3d'MapCorrect.close()'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");$("#correctPopFrame").css("display","block").find("iframe").attr("src",Service.CorrectDir+"popview.html?"+parseParam(k))},close:function(){$("#correctPopFrame").css("display","none")}}}(),MapToolUI=function(){var k=!1;return{init:function(d){if(!k){var m=$("#toolDiv");m.append("    \x3cul style\x3d'margin:3px 0'\x3e        \x3cli id\x3d'btnExtent' class\x3d'btnToolbar' style\x3d'margin-right: 20px;'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -128px 0;'\x3e\x3c/span\x3e\u5168\u5c4f\x3c/span\x3e\x3c/li\x3e        \x3cli id\x3d'btntool' class\x3d'btnToolbar'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -142px 0;'\x3e\x3c/span\x3e\u5de5\u5177\x3c/span\x3e           \x3cdiv id\x3d'toolbag_div' style\x3d'width: 60px; border: 1px solid #25abf3; background: #f4f9fd;display: none; color: #777777;margin-top:2px;'\x3e               \x3cul\x3e\x3c/ul\x3e        \x3c/li\x3e        \x3cli id\x3d'btnClear' class\x3d'btnToolbar'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -158px 0;'\x3e\x3c/span\x3e\u6e05\u9664\x3c/span\x3e\x3c/li\x3e        \x3cli id\x3d'btnExtentMap' class\x3d'btnToolbar'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -111px 0;'\x3e\x3c/span\x3e\u5168\u56fe\x3c/span\x3e\x3c/li\x3e        \x3cli id\x3d'btnImgCompare' class\x3d'btnToolbar'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -96px 0;'\x3e\x3c/span\x3e\u5bf9\u6bd4\x3c/span\x3e\x3c/li\x3e        \x3cli id\x3d'dict'\x3e\x3cdiv id\x3d'dict_text'\x3e\u5c71\u4e1c\u7701\x3c/div\x3e\x3c/li\x3e        \x3cli id\x3d'vec_img'\x3e\x3c/li\x3e        \x3cli id\x3d'btnJiucuo' class\x3d'btnToolbar'\x3e\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -78px 0;'\x3e\x3c/span\x3e\u7ea0\u9519\x3c/span\x3e\x3c/li\x3e        \x3cli id\x3d'btnxinzheng' class\x3d'btnToolbar' style\x3d'width:78px;'\x3e\x3cspan class\x3d'btnToolbar-cont' style\x3d'padding:0;'\x3e\u5f00\u542f\u884c\u653f\u533a\u5212\x3c/span\x3e\x3cdiv id\x3d'btnxinzhenglabel'\x3e\x3c/div\x3e\x3c/li\x3e    \x3c/ul\x3e");var h=m.find("#btntool ul");MeasureTool.init(h,d);FullScreen.init();Clean.init(d);Plotting.init(h,d);PrintMapTool.init(h,d);RegionSwitch.init(m.find("#dict"),d);RegionSwitch2.init(d);MapSwitch.init(m.find("#vec_img"),d);CopyRightTool.init(d);MapContrast.init(d);m.find("#btntool").mouseenter(function(){$("#toolbag_div").css("display","block")});m.find("#btntool").mouseleave(function(){$("#toolbag_div").css("display","none")});$("#btnExtentMap").click(function(){var h=new Ol2.LonLat(119,36.4);d.map.setCenter(h,7)});$("#btnImgCompare").click(function(){MapContrast.startContrast()});$("#btnJiucuo").click(function(){var d=MapCorrect.userCookie();window.open(Service.CorrectDir+"index.html"+d)});$("#btnxinzheng").click(function(){var d=$(this).children("span");"\u5173\u95ed\u884c\u653f\u533a\u5212"==d.text()?(d.text("\u5f00\u542f\u884c\u653f\u533a\u5212"),RegionSwitch2.close(),RegionSwitch.setActive(!1)):(d.text("\u5173\u95ed\u884c\u653f\u533a\u5212"),RegionSwitch2.open(),RegionSwitch.setActive(!0))});k=!0}}}}(),ImgCluster=function(){function k(a){n&&n.popup&&(popup.feature=void 0,sdMap.map.removePopup(n.popup),n.popup.destroy(),popup=n.popup=void 0,a&&(r.eraseFeatures(n),I=!1))}function d(d){$("GPS",d).each(function(){a=$("id",this).text();u=$("X",this).text();y=$("Y",this).text();c=$("savename",this).text().replace(/\.jpg$/i,".png");b=e=$("savename",this).text();v=$("orgname",this).text();w=$("userid",this).text();$("model",this).text();$("datetime",this).text();F=new Ol2.LonLat(u,y);t.push(new Ol2.Feature.Vector(new Ol2.Geometry.Point(F.lon,F.lat),{x:F.lon,y:F.lat,html:'\x3cdiv style\x3d"font-size: 14px;width:400px;height:50px;position:relative;"\x3e\x3cdiv style\x3d"position:absolute;left:5px;top:5px;color:#3b9cfe;font-weight:bold;"\x3e'+v+'\x3c/div\x3e\x3cdiv class\x3d"picRemark" style\x3d"position:absolute;left:5px;top:25px;color:#666;"\x3e\x3c/div\x3e\x3ca class\x3d"viewSrcImg" href\x3d"http://124.128.48.212:8100/picserver/Pic/srcpic/'+e+'" target\x3d"_blank"  sourceImg\x3d"http://124.128.48.212:8100/picserver/Pic/srcpic/'+e+'"\x3e\u67e5\u770b\u539f\u56fe\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"mid-img-container"\x3e\x3cimg src\x3d"http://124.128.48.212:8100/picserver/Pic/midpic/'+b+'" title\x3d"'+v+'"/\x3e\x3c/div\x3e\x3cdiv style\x3d"font-size: 12px;text-align: center;position:relative;height:50px;width:400px;"\x3e\x3cdiv class\x3d"picUser" style\x3d"position:absolute;top:10px;left:5px;color:#666;"\x3e\x3c/div\x3e\x3cdiv class\x3d"picUploadTime" style\x3d"position:absolute;top:30px;left:5px;color:#666;"\x3e\x3c/div\x3e\x3c/div\x3e',img:"http://124.128.48.212:8100/picserver/Pic/minipic/"+c,name:v,picID:a,circlebg:"images/ImageCluster/circlebg.png",userid:w,id:"img_"+H}));H++})}function m(){q=h();p=l();z=new Ol2.Layer.Vector("unClusters",{styleMap:new Ol2.StyleMap(p)});var a=!1,c=!1,b=new Ol2.Strategy.Cluster;b.distance=100;r=new Ol2.Layer.Vector("Clusters",{strategies:[b],styleMap:new Ol2.StyleMap(q),isCluster:1,clusterOver:function(b){null!=b.layer&&"undefined"!==typeof b.layer.isCluster&&(null!=D&&(sdMap.map.removePopup(D),D=null),null==b.cluster||null==b.cluster.length||1>=b.cluster.length||(c=!0,D=new Ol2.Popup.Anchored("popExpandCluster",new Ol2.LonLat(b.geometry.x,b.geometry.y),new Ol2.Size(24,24),'\x3cdiv class\x3d"expandCluster" title\x3d"\u5355\u51fb\u6563\u5f00"/\x3e',{size:new Ol2.Size(16,16),offset:new Ol2.Pixel(13,-37)},!1,null),D.calculateNewPx=function(a){return a.offset(this.anchor.offset)},D.setBackgroundColor("transparent"),D.cluster=b.cluster,sdMap.map.addPopup(D),$("#popExpandCluster_contentDiv").css("overflow","visible"),$(".expandCluster").hover(function(){a=!0},function(){a=!1;setTimeout(function(){a||c||sdMap.map.removePopup(D)},200)}).click(function(){var a=D.cluster;if(1<a.length&&19>sdMap.map.getZoom()){for(var c=[],b=0;b<a.length;b++)c.push(a[b].geometry);a=(new Ol2.Geometry.Collection(c)).getBounds();sdMap.map.zoomToExtent(a)}})))},clusterOut:function(b){c=!1;setTimeout(function(){a||c||null==D||sdMap.map.removePopup(D)},200)}});G.addLayer(r,!0);G.addLayer(z,!0);sdMap.map.events.register("zoomend",sdMap.map,function(){if(sdMap.map.getZoom()>E)"undefined"!=typeof popup&&(I=!0);else if(C&&"undefined"!=typeof popup){I=!0;for(var a=r.features,c=!1,d=0,e=a.length,f;d<e;d++)if(f=a[d],f.cluster[0].attributes.id==n.cluster[0].attributes.id){c=!0;break}c||k(I)}E=sdMap.map.getZoom();b.distance=19<=E?0:17<=E&&19>E?30:14<=E?50:100;C&&(r.removeFeatures(r.features),r.addFeatures(t))});r.removeFeatures(r.features);r.addFeatures(t);r.events.on({featureselected:function(a){k();n=a.feature;a=new Ol2.LonLat(n.cluster[0].geometry.x,n.cluster[0].geometry.y);popup=new Ol2.Popup.FramedCloud("featurePopup",a,new Ol2.Size(200,200),n.cluster[0].data.html,null,!0,function(a){this.feature.layer=r;B.unselect(this.feature)});n.popup=popup;popup.feature=n;popup.size=new Ol2.Size(300,300);sdMap.map.addPopup(popup);f(n.cluster[0].data.picID)},featureunselected:function(a){n=a.feature;k(I)}});z.events.on({featureselected:function(a){k();n=a.feature;a=new Ol2.LonLat(n.geometry.x,n.geometry.y);popup=new Ol2.Popup.FramedCloud("featurePopup",a,new Ol2.Size(200,200),n.data.html,null,!0,function(a){this.feature.layer=z;B.unselect(this.feature)});n.popup=popup;popup.feature=n;popup.size=new Ol2.Size(300,300);sdMap.map.addPopup(popup);f(n.data.picID)},featureunselected:function(a){n=a.feature;k()}})}function h(){var a=new Ol2.Rule({filter:new Ol2.Filter.Comparison({type:Ol2.Filter.Comparison.EQUAL_TO,property:"count",value:1}),symbolizer:{graphicWidth:40,graphicHeight:40,externalGraphic:"${img}"}}),c=new Ol2.Rule({elseFilter:!0,symbolizer:{fontColor:"white",fontSize:"13px",fill:!0,fillColor:"#ffcc66",graphicWidth:40,graphicHeight:40,pointRadius:10,labelYOffset:25,labelXOffset:25,label:"${count}",externalGraphic:"${img}",backgroundGraphic:"${circlebg}",backgroundXOffset:-4,backgroundYOffset:-34,labelSelect:!0}});$.support.leadingWhitespace&&(Browser.ie9above&&(c.symbolizer.labelYOffset=20),c.symbolizer.backgroundXOffset=-5,c.symbolizer.backgroundYOffset=-35);return new Ol2.Style({fontSize:"9pt",fontWeight:"bold"},{rules:[a,c],context:{count:function(a){return a.attributes.count},img:function(a){return a.cluster[0].data.img},name:function(a){return a.cluster[0].data.name},circlebg:function(a){return a.cluster[0].data.circlebg}}})}function l(){return new Ol2.Style({},{rules:[new Ol2.Rule({symbolizer:{fontColor:"white",fontSize:"13px",graphicWidth:40,graphicHeight:40,pointRadius:"10",externalGraphic:"${img}"}})],context:{count:function(a){return a.attributes.count},img:function(a){return a.cluster?a.cluster[0].data.img:a.data.img},name:function(a){return a.cluster?a.cluster[0].data.name:a.data.name}}})}function f(a){$.ajax({type:"POST",url:"proxy/proxy.ashx?http://124.128.48.211:8100/picclient/PictureServlet?method\x3dqueryPicDetail",data:{picid:a},success:function(a){a?(a=eval("("+a+")"),$(".picRemark").text(a.remark),$(".picUser").text("\u4e0a\u4f20\u7528\u6237\uff1a"+a.username),$(".picUploadTime").text("\u4e0a\u4f20\u65f6\u95f4\uff1a"+a.uploadtime)):alert("\u83b7\u53d6\u56fe\u7247\u6570\u636e\u5931\u8d25")}})}var g,a,c,b,e,v,w,u,y,t=[],q,p,r,z,F,B,C=!0,n,E=7,H=0,I=!1,A=!1,J=!1,D,G=null,K=null;return{init:function(a,c,b){G=b;B=G.getSelectCtrl();A=!0},Show:function(){A&&(J?(k(),C?(r.removeAllFeatures(),z.addFeatures(t),I=C=!1,$("#clusterSwitcher").text("\u6253\u5f00\u805a\u7c7b")):(z.removeAllFeatures(),r.addFeatures(t),C=!0,$("#clusterSwitcher").text("\u53d6\u6d88\u805a\u7c7b"),I=!1)):K=$.ajax({url:"proxy/proxy.ashx?http://124.128.48.211:8100/picclient/PictureServlet?method\x3dqueryAllPubXml",type:"GET",dataType:"xml",success:function(a){a?(g=a,d(g),m(),J=!0):alert("\u83b7\u53d6\u56fe\u7247\u6570\u636e\u5931\u8d25")},error:function(a,c,b){console.log&&console.log(c)}}))},Hide:function(){},Dispose:function(){K&&(K.abort(),K=null);G.removeLayer(r,!0);z.removeAllFeatures();t=[];J=A=!1},isInit:function(){return A}}};function PollutionWidget(){function k(){var a;a="water"==b?"WasteWaterGis":"air"==b?"WasteAirGis":"SewagePlantGis";f.removeAllFeatures();9>l.map.zoom?(v&&v.abort(),0<w[0].length?f.addFeatures(w[0]):v=$.ajax({url:"proxy/pollution.ashx?"+$.param({_type:b,Method:"GetCompanyList_New",_t:Math.floor(Date.now()/1E6)}),dataType:"json",success:function(a){if(a){var c=[];a=a.CityList;for(var b=0;b<a.length;b++){for(var d=parseFloat(a[b].Longitude),e=parseFloat(a[b].Latitude),g=a[b].ItemsInfos,u=0,h=0;h<g.length;h++)0<g[h].value&&u++;d=new Ol2.Feature.Vector(new Ol2.Geometry.Point(d,e));e=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);e.externalGraphic="images/pollution/citylayer"+(0<u?"_cb":"")+".png";e.graphicWidth=60;e.graphicHeight=25;e.fillOpacity=1;e.cursor="pointer";e.fontSize="14px";e.label=u+"/"+a[b].Count;d.style=e;d.attributes={cityCode:a[b].cityCode};c.push(d)}w[0]=c;f.addFeatures(c)}},error:function(a,c){console.log&&console.log("\u6c61\u67d3\u6570\u636e\u8bf7\u6c42"+c)}})):(v&&v.abort(),0<w[1].length?f.addFeatures(w[1]):v=$.ajax({url:"proxy/pollution.ashx?"+$.param({_type:"all",Method:"SelectSubList",stcode:0,type:a,_t:Math.floor(Date.now()/1E6)}),dataType:"json",success:function(a){if(a){var c=[];a=a.items;for(var b=0;b<a.length;b++){var d=parseFloat(a[b].longitude),e=parseFloat(a[b].latitude),d=new Ol2.Feature.Vector(new Ol2.Geometry.Point(d,e)),e=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),g;switch(a[b].lever.value){case "0":g="green";break;case "-1":g="gray";break;case "-2":g="yellow";break;default:g="red"}e.externalGraphic="images/pollution/"+g+".png";e.graphicWidth=32;e.graphicHeight=60;e.fillOpacity=1;e.cursor="pointer";"red"==g&&(e.label=Math.round(parseFloat(a[b].lever.pollItemValue))+"",e.labelYOffset=13,e.fontSize="14px");d.style=e;d.attributes=a[b];c.push(d)}w[1]=c;f.addFeatures(c)}},error:function(a,c){console.log&&console.log("\u6c61\u67d3\u6570\u636e\u8bf7\u6c42"+c)}}))}function d(a){null!=l.widgetPop&&l.removePopup(l.widgetPop);a=a.feature;var d=a.attributes;if(d.cityCode)l.map.setCenter(new Ol2.LonLat(a.geometry.x,a.geometry.y),10);else{var e;$.ajax({url:"proxy/pollution.ashx?"+$.param({_type:b,Method:"GetRealTimeDataInfo_New",SubID:d.subid,_t:Math.floor(Date.now()/1E6)}),async:!1,dataType:"text",success:function(a){e=a},error:function(a,c,b){}});if(e){e=JSON.parse(decryptByAES(token.pwd,e));for(var f=e.RealData,g='\x3cdiv style\x3d"background-color: white;min-width: 330px;margin: 0 15px 10px 5px;"\x3e               \x3ch  \x3e\x3cdiv class\x3d"popup_title"\x3e\x3cspan\x3e'+f[0].StationName+'\x3c/span\x3e--\x3cspan style\x3d"color: #805405;"\x3e\u3010'+c[b].name+'\u3011\x3c/span\x3e\x3c/div\x3e\x3c/h\x3e    \x3cdiv class\x3d"popup_content"\x3e                                                                            \x3ctable  cellpadding\x3d"0" cellspacing\x3d"0" border\x3d"0"\x3e                                                       \x3cthead\x3e\x3ctr\x3e\x3cth\x3e\u63a7\u5236\u6307\u6807\x3c/th\x3e\x3cth\x3e\u76d1\u6d4b\u503c\x3c/th\x3e\x3cth\x3e\u6807\u51c6\x3c/th\x3e\x3cth\x3e\u8d85\u6807\u500d\u6570\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e                  \x3ctbody\x3e                                                                                         ',r=0;r<f.length;r++)g+="\x3ctr\x3e\x3ctd\x3e"+f[r].ItemName+"\x3c/td\x3e\x3ctd\x3e"+(f[r].Val||"--")+"\x3c/td\x3e\x3ctd\x3e"+(f[r].StandValue||"--")+"\x3c/td\x3e\x3ctd\x3e"+(f[r].CBBS?'\x3cspan style\x3d"color:red"\x3e'+f[r].CBBS+"\x3c/span\x3e":"--")+"\x3c/td\x3e\x3c/tr\x3e";g+='         \x3ctr\x3e\x3ctd colspan\x3d"4" style\x3d"font-size: 12px"\x3e\u5355\u4f4d\uff1a'+c[b].dw+'\x3c/td\x3e\x3c/tr\x3e                \x3c/tbody\x3e                                                                                               \x3c/table\x3e                                                                                           \x3cdiv\x3e\x3cspan class\x3d"item_title"\x3e\u751f\u4ea7\u72b6\u6001:\x3c/span\x3e'+e.Sczt.match(/>(\W*)<\/td><\/tr>.*$/)[1]+'\x3c/div\x3e                                             \x3cdiv \x3e\x3cspan class\x3d"item_title"\x3e\u76d1\u6d4b\u65f6\u95f4\uff1a\x3c/span\x3e'+(f[0].DateTime||"--")+'\x3c/div\x3e                                 \x3c/div\x3e\x3cdiv class\x3d"pol_hist"\x3e\x3cdiv subid\x3d"'+d.subid+'"\x3e\x3c/div\x3e\x3c/div\x3e';l.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,g,null,!0,function(){l.removePopup(l.widgetPop);l.unSelect()});a.popup=l.widgetPop;l.addPopup(l.widgetPop);$(".pol_hist\x3ediv").click(function(){var a=$(this).attr("subid");m(a,f[0].StationName)})}}}function m(a,c){0==$("#pol_HistFrame").length&&($("body").append("\x3cdiv id\x3d'pol_HistFrame'\x3e\x3cdiv style\x3d'filter:alpha(opacity:50);opacity:0.3;background:#808080;width:100%;height:100%;position:absolute;left:0;top:0;z-index: 1100'\x3e\x3c/div\x3e\x3cdiv id\x3d'pol_Hist_view' style\x3d'padding: 5px;border:1px solid #849DF9;border-radius: 5px;position:absolute; left: 50%;top: 50%;margin-top:-260px;padding: 0;margin-left:-480px;width:1000px;height:520px;background-color:white;z-index: 1101'\x3e\x3ciframe style\x3d'margin: 2px 5px;border: 1px solid #C5C5C5;border-radius: 3px;' width\x3d'990' height\x3d'512' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'no' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3cdiv style\x3d'position: absolute;position: absolute;top: 6px;font-size:14px;left: 12px;color: #1515EF;'\x3e\u5386\u53f2\u4fe1\u606f\u8be6\u60c5\x3c/div\x3e\x3cdiv id\x3d'pol_Hist_close' style\x3d'position: absolute;top:6px;right:6px;width:20px;height:20px; background-image: url(images/close.png);' \x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"),$("#pol_Hist_close").click(function(){$("#pol_HistFrame").hide()}));$("#pol_HistFrame").css("display","block").find("iframe").attr("src","http://58.56.98.78:8801/wryfb/WebGis/WasteWaterGis/History.aspx?SubId\x3d"+a+"\x26SubName\x3d"+escape(c))}function h(a){if(9>l.map.zoom){if(0==e)return}else if(1==e)return;k()}if(null!=PollutionWidget.unique)return PollutionWidget.unique;PollutionWidget.unique=this;var l=null,f=null,g=!1,a,c={water:{name:"\u5e9f\u6c34",dw:"\u6392\u6c34\u91cf m\x3csup\x3e3\x3c/sup\x3e/h\uff0c\u5176\u4ed6 mg/l"},air:{name:"\u5e9f\u6c14",dw:"\u6392\u6c14\u91cf m\x3csup\x3e3\x3c/sup\x3e/h\uff0c\u5176\u4ed6 mg/m\x3csup\x3e3\x3c/sup\x3e"},fac:{name:"\u6c61\u6c34\u5382",dw:"\u6392\u6c34\u91cf m\x3csup\x3e3\x3c/sup\x3e/h\uff0c\u5176\u4ed6 mg/l"}},b,e,v=null,w={0:[],1:[]};return{init:function(c,b,e){f=new Ol2.Layer.Vector("\u6c61\u67d3",{style:b,renderers:c});l=e;l.addLayer(f,!0);f.events.on({featureselected:d});a=$("\x3cdiv\x3e\x3c/div\x3e").attr("id","lengend_poll").addClass("legenddiv").append("\x3cimg src\x3d'Images/pollution/green.png'/\x3e\u6b63\u5e38\x3cimg src\x3d'Images/pollution/red.png'/\x3e\u8d85\u6807\x3cimg src\x3d'Images/pollution/gray.png'/\x3e\u505c\u4ea7\x3cimg src\x3d'Images/pollution/yellow.png'/\x3e\u6545\u969c");$("#"+l.map.div.id).append(a);g=!0},Show:function(a){a=null==a?"water":a.split("_")[1];g&&(a!=b&&(w={0:[],1:[]}),b=a,k(),l.map.events.register("zoomend",l.map,h))},Hide:function(){f.setVisibility(!1);null!=l.widgetPop&&l.removePopup(l.widgetPop);a.hide()},Dispose:function(){v&&(v.abort(),v=null);l.removeLayer(f,!0);null!=l.widgetPop&&l.removePopup(l.widgetPop);l.map.events.unregister("zoomend",l.map,h);g=!1;e=b=null;a.remove();a=null;$("#pol_HistFrame").remove();f=null},isInit:function(){return g}}}var wmswmts=function(){function k(d,g,a,c){var b=c[0]||l.minlevel||0;c=c[c.length-1]||l.maxlevel||20;var e=wmswmts.map.getZoom();a={LAYERS:null!=a?a:[0],TRANSPARENT:!0,STYLES:"",FORMAT:"image/png",SRS:wmswmts.map.getProjection()};var h=g.replace(/arcgis\/rest\/services/,"arcgis/services")+"/WMSServer";a=new OpenLayers.Layer.WMS("wmsWmts",h,a,{isBaseLayer:!1,opacity:.7,singleTile:!0});l.layer="themwmtsLayer_"+d;l.url=g+"/WMTS";l.minlevel=b;l.maxlevel=c;g=new OpenLayers.Layer.WMTS(l);b={l_wms:a,l_wmts:g,l_cur:e>c||e<b?a:g,min:b,max:c,open:!1};wmswmts.hashLayers.put(d,b);return b}function d(d,g,a,c,b){var e=b[0]||l.minlevel||0;b=b[b.length-1]||l.maxlevel||20;var h=wmswmts.map.getZoom();c={LAYERS:null!=c?c:[0],TRANSPARENT:!0,STYLES:"",FORMAT:"image/png",SRS:wmswmts.map.getProjection()};a=new OpenLayers.Layer.WMS("wmsWmts",a,c,{isBaseLayer:!1,opacity:.7,singleTile:!0});l.layer="themwmtsLayer_"+d;l.url=g+("?_t\x3d"+(new Date).getTime());l.minlevel=e;l.maxlevel=b;g=new OpenLayers.Layer.WMTS(l);e={l_wms:a,l_wmts:g,l_cur:h>b||h<e?a:g,min:e,max:b,open:!1};wmswmts.hashLayers.put(d,e);return e}var m=!1,h=!1,l={layer:"sdvec",style:"default",matrixSet:"tianditu2013",format:"image/png",open:!0};return{init:function(d){m||(wmswmts.map=d,wmswmts.hashLayers=new HashTable,m=!0)},Setshow:function(d){d=wmswmts.hashLayers.get(d);wmswmts.map.addLayer(d.l_cur);d.open=!0},addLayer:function(d){wmswmts.map.addLayer(d.l_cur);d.open=!0},newLayer:function(d,g){g=g||!1;if(!wmswmts.hashLayers.contains(d.id)){h||(wmswmts.map.events.register("zoomend",null,function(){var a=wmswmts.map.getZoom(),b;for(b in wmswmts.hashLayers.hash){var d=wmswmts.hashLayers.get(b),f=d.l_cur,g=wmswmts.map.getLayerIndex(f);a>d.max||a<d.min?f!=d.l_wms&&(d.l_cur=d.l_wms,1==d.open&&(wmswmts.map.removeLayer(f),wmswmts.map.addLayer(d.l_wms),wmswmts.map.setLayerIndex(d.l_wms,g))):f!=d.l_wmts&&(d.l_cur=d.l_wmts,1==d.open&&(wmswmts.map.removeLayer(f),wmswmts.map.addLayer(d.l_wmts),wmswmts.map.setLayerIndex(d.l_wmts,g)))}}),h=!0);var a=k(d.id,d.url,d.layer,d.l);g?wmswmts.addLayer(a):null;return a}},newLayerRoad:function(f,g){g=g||!1;if(!wmswmts.hashLayers.contains(f.id)){h||(wmswmts.map.events.register("zoomend",null,function(){var a=wmswmts.map.getZoom(),b;for(b in wmswmts.hashLayers.hash){var d=wmswmts.hashLayers.get(b),f=d.l_cur,g=wmswmts.map.getLayerIndex(f);a>d.max||a<d.min?f!=d.l_wms&&(d.l_cur=d.l_wms,1==d.open&&(wmswmts.map.removeLayer(f),wmswmts.map.addLayer(d.l_wms),wmswmts.map.setLayerIndex(d.l_wms,g))):(f.url=f.url.split("?")[0]+("?_t\x3d"+(new Date).getTime()),d.l_wmts.url=d.l_wmts.url.split("?")[0]+("?_t\x3d"+(new Date).getTime()),f!=d.l_wmts&&(d.l_cur=d.l_wmts,1==d.open&&(wmswmts.map.removeLayer(f),wmswmts.map.addLayer(d.l_wmts),wmswmts.map.setLayerIndex(d.l_wmts,g))))}}),h=!0);var a=d(f.id,f.wmtsurl,f.wmsurl,f.layer,f.l);g?wmswmts.addLayer(a):null;return a}},removeLayer:function(d){wmswmts.hashLayers.contains(d)&&(d=wmswmts.hashLayers.get(d),d.open&&(wmswmts.map.removeLayer(d.l_cur),d.open=!1))}}}();function WeatherWidget(){function k(){f=$.ajax({type:"GET",url:Service.RTService+"ctype\x3dweather\x26op\x3dgetweather\x26param\x3d{}\x26_t\x3d"+Date.now(),dataType:"jsonp",success:function(d){if(d){for(var a=[],c=0;c<d.length;c++){var b=parseFloat(d[c].X),e=parseFloat(d[c].Y),b=new Ol2.Feature.Vector(new Ol2.Geometry.Point(b,e)),e=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);e.externalGraphic="images/Weather/b_"+d[c].STATE1+".png";e.graphicWidth=57;e.graphicHeight=54;e.fillOpacity=1;e.cursor="pointer";b.style=e;b.attributes=d[c];a.push(b)}h.addFeatures(a)}},error:function(d,a){console.log&&console.log("\u5929\u6c14\u6570\u636e\u8bf7\u6c42"+a)}})}function d(d){null!=m.widgetPop&&m.removePopup(m.widgetPop);d=d.feature;for(var a=d.attributes,c=parseInt(a.HUMIDITY),b=Math.floor(c/20),e="\x3cdiv class\x3d'weather_bk'\x3e",f=0;f<b;f++)e+="\x3cdiv class\x3d'weather_ubk'\x3e\x3c/div\x3e";c=(c-20*b)/2;0<c?e+="\x3cdiv class\x3d'weather_ubk ' style\x3d'width:"+c+"px;margin-right:0;'\x3e\x3c/div\x3e":5==b&&(e=e.substr(0,e.length-7)+" style\x3d'margin-right:0'\x3e\x3c/div\x3e");e+="\x3c/div\x3e";m.widgetPop=new Ol2.Popup.FramedCloud("chicken",d.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;'\x3e\x3cdiv style \x3d 'position:relative; margin-bottom:15px;color:#3b9cfe;'\x3e\x3cb\x3e\u5929\u6c14\u72b6\u51b5\x3c/b\x3e \x3c/div\x3e \x3cdiv style\x3d'margin:10px 5px;'\x3e\x3cdiv style\x3d'float:left; '\x3e \x3cdiv style \x3d 'text-align: center;'\x3e"+a.CITYNAME+"\x3c/div\x3e\x3cimg src\x3d'images/Weather/a_"+a.STATE1+".gif'\x3e\x3c/img\x3e\x3cdiv style \x3d 'text-align: center;'\x3e"+a.STATEDETAILED+"\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'padding-left:110px;line-height:1.5em;' \x3e\u6e29\u5ea6:\x26nbsp;"+a.TEM1+"~"+a.TEM2+"\u2103\x3cbr\x3e\u98ce:\x26nbsp;"+a.WINDSTATE+"\x3cbr\x3e\u6e7f\u5ea6:\x26nbsp;"+e+a.HUMIDITY+"%\x3cbr\x3e\u5b9e\u65f6\u6e29\u5ea6:\x26nbsp;"+a.TEMNOW+"\u2103\x3cbr\x3e\u66f4\u65b0\u65f6\u95f4:\x26nbsp;"+a.TIME+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,function(){m.removePopup(m.widgetPop);m.unSelect()});d.popup=m.widgetPop;m.addPopup(m.widgetPop)}if(null!=WeatherWidget.unique)return WeatherWidget.unique;WeatherWidget.unique=this;var m=null,h=null,l=!1,f=null;return{init:function(f,a,c){h=new Ol2.Layer.Vector("\u5929\u6c14",{style:a,renderers:f});m=c;m.addLayer(h,!0);h.events.on({featureselected:d});l=!0},Show:function(){l&&k()},Hide:function(){h.setVisibility(!1);null!=m.widgetPop&&m.removePopup(m.widgetPop)},Dispose:function(){f&&(f.abort(),f=null);m.removeLayer(h,!0);null!=m.widgetPop&&m.removePopup(m.widgetPop);l=!1;h=null},isInit:function(){return l}}}function RoadWiget(){function k(a){c=a;f&&(f.removeAllFeatures(),"rtroad"==a?(wmswmts.newLayerRoad(e,!0),wmswmts.Setshow(e.id),$("#lengend_rtroad").show()):(wmswmts.removeLayer(e.id),$("#lengend_rtroad").hide(),b={road_kou:[],road_event:[],road_hu:[]},l=$.ajax({url:Service.RTService+"ctype\x3droad\x26op\x3dgetinfo\x26param\x3d{type:'all'}",dataType:"jsonp",success:function(a){if(f&&"object"==typeof a){for(var c=a.crk,e=0;e<c.length;e++){var g=c[e],h=d(g),p=0,r=0;"\u5c01\u95ed"===g.ENTERSTATUS?r=2:"\u538b\u8f66"===g.ENTERSTATUS&&(r=1);"\u5c01\u95ed"===g.EXITSTATUS?p=2:"\u538b\u8f66"===g.EXITSTATUS&&(p=1);h.style.externalGraphic="images/Road/crk"+r+p+".png";b.road_kou.push(h);f.addFeatures(h)}c=a.yh;for(e=0;e<c.length;e++)g=d(c[e]),g.style.externalGraphic="images/Road/roadStruct_pic.png",b.road_hu.push(g),f.addFeatures(g);a=a.sg;for(c=0;c<a.length;c++)e=d(a[c]),e.style.externalGraphic="images/Road/accident_pic.png",b.road_event.push(e),f.addFeatures(e)}},error:function(a,c){console.log&&console.log("\u9053\u8def\u6570\u636e\u8bf7\u6c42"+c)}})))}function d(a){var c=parseFloat(a.X),b=parseFloat(a.Y),c=new Ol2.Feature.Vector(new Ol2.Geometry.Point(c,b)),b=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);b.graphicWidth=26;b.graphicHeight=26;b.fillOpacity=1;b.cursor="pointer";c.style=b;c.attributes=a;return c}function m(a){null!=h.widgetPop&&h.removePopup(h.widgetPop);a=a.feature;var c=a.attributes;if(null!=c.EVENTTYPE){var b=c.GLMC+"   \u65b9\u5411:"+c.ROADFX,d,e;c.EVENTMS?(d=12*c.EVENTMS.length+100,d=(370<d?d:370)+"px"):d="370px";e="\u517b\u62a4\u65bd\u5de5"==c.EVENTTYPE?"div_shigong":"div_shigu";h.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;'\x3e\x3cdiv style \x3d 'font-size:14px; position:relative;color:#3b9cfe;'\x3e\x3cb style\x3d'margin-left: 20px'\x3e"+b+"\x3c/b\x3e\x3cdiv class\x3d'div_content_r'\x3e\x3cdiv class\x3d"+e+"\x3e\x3c/div\x3e\x3cdiv style \x3d 'line-height:40px;font-size:12px;color:red;width:"+d+";'\x3e"+c.EVENTMS+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv style\x3d'line-height:34px;' \x3e\x3chr style\x3d'width:100%; border-top: 0px #B8B6B6 solid'\x3e\x3cdiv class\x3d'div_left'\x3e\u9053\u8def\u8c03\u6574\u63aa\u65bd:\x3cspan class\x3d'span_road'\x3e"+c.STEPTIME+"\x3c/span\x3e\x3c/div\x3e\x3chr style\x3d'width:100%; border-top: 0px #B8B6B6 solid'\x3e\x3cdiv class\x3d'div_left'\x3e\u8d77\u59cb\u8282\u70b9:\x3cspan class\x3d'span_road'\x3e"+c.STARTNODE+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'div_right'\x3e\u7ec8\u6b62\u8282\u70b9:\x3cspan class\x3d'span_road'\x3e"+c.ENDNODE+"\x3c/span\x3e\x3c/div\x3e\x3chr style\x3d'width:100%; border-top: 0px #B8B6B6 solid'\x3e\x3cdiv class\x3d'div_left'\x3e\u5f00\u59cb\u6869\u53f7:\x3cspan class\x3d'span_road'\x3e"+c.STARTZH+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'div_right'\x3e\u7ed3\u675f\u6869\u53f7:\x3cspan class\x3d'span_road'\x3e"+c.ENDZH+"\x3c/span\x3e\x3c/div\x3e\x3chr style\x3d'width:100%; border-top: 0px #B8B6B6 solid'\x3e\x3cdiv class\x3d'div_left'\x3e\u5f00\u59cb\u65f6\u95f4:\x3cspan class\x3d'span_road'\x3e"+c.STARTTIME+"\x3c/span\x3e\x3cbr\x3e\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4:\x3cspan class\x3d'span_road'\x3e"+c.ENDTIME+"\x3c/span\x3e\x3c/div\x3e\x3cbr\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,function(){null!=h.widgetPop&&(h.removePopup(h.widgetPop),h.unSelect())})}else b="\u5c01\u95ed"==c.ENTERSTATUS?"span_active_road":"span_normal_road",d="\u5c01\u95ed"==c.EXITSTATUS?"span_active_road":"span_normal_road",h.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;min-width:130px;'\x3e\x3cdiv style \x3d 'position:relative;margin-bottom:10px;color:#3b9cfe;font-size:14px;margin-left:8px'\x3e\x3cb\x3e"+c.TOLLBOOTH+"\x3c/b\x3e\x3c/div\x3e \x3cdiv style\x3d'line-height:30px;margin-left:10px'\x3e\u5165\u53e3:\x3cspan class\x3d"+b+"\x3e"+c.ENTERSTATUS+"\x3c/span\x3e\x3cbr\x3e\u51fa\u53e3:\x3cspan class\x3d"+d+"\x3e"+c.EXITSTATUS+"\x3c/span\x3e\x3cbr\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,function(){null!=h.widgetPop&&h.removePopup(h.widgetPop)});a.popup=h.widgetPop;h.addPopup(h.widgetPop)}if(null!=RoadWiget.unique)return RoadWiget.unique;RoadWiget.unique=this;var h=null,l=null,f=null,g=!1,a=null,c="",b=null,e={id:"heat_ly",wmtsurl:Service.RTRoadWMTSService,wmsurl:Service.RTRoadWMSService,layer:"0,1,2,3",l:[7,13]};return{init:function(c,b,d){f=new Ol2.Layer.Vector("\u9053\u8def",{style:b,renderers:c});h=d;a=$("\x3cdiv\x3e\x3c/div\x3e").attr("id","lengend_rtroad").addClass("legenddiv").css("width","180px").append("\x3cimg src\x3d'Images/Road/rtroad.png' width\x3d'180px' height\x3d'65px'/\x3e");$("#"+h.map.div.id).append(a);h.addLayer(f,!0);f.events.on({featureselected:m});g=!0},Show:function(a){a=null==a?"rtroad":a.split("_")[1];g&&a!=c&&k(a)},Hide:function(){f.setVisibility(!1);null!=h.widgetPop&&h.removePopup(h.widgetPop)},Dispose:function(){l&&(l.abort(),l=null);h.removeLayer(f,!0);null!=h.widgetPop&&h.removePopup(h.widgetPop);g=!1;b={road_kou:[],road_event:[],road_hu:[]};f=null;c="";a.remove();a=null;wmswmts.removeLayer(e.id)},isInit:function(){return g}}}function EnvironmentWidget(){function k(){null!=a.widgetPop&&a.removePopup(a.widgetPop);c.removeAllFeatures();var e="ctype\x3denviro\x26op\x3dgetenvir\x26param\x3d{}";"station"!=w&&(e="ctype\x3denviro\x26op\x3dgetCityInfo\x26param\x3d{}");b=$.ajax({type:"GET",url:Service.RTService+e,dataType:"jsonp",success:function(a){if("object"==typeof a){var b=[];if("station"==w)for(var e=0;e<a.length;e++){var f=a[e],r=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(f.X),parseFloat(f.Y))),h=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);h.externalGraphic="images/environment/pm25_"+g[f.ST_LEVEL].i+".png";h.graphicWidth=25;h.graphicHeight=25;h.fillOpacity=1;h.cursor="pointer";r.style=h;r.attributes=f;b.push(r)}else for(e=0;e<a.length;e++)f=a[e],r=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(f.x),parseFloat(f.y))),h=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),h.externalGraphic="images/environment/pm25_"+g[d(f.aqi)].i+".png",h.graphicWidth=25,h.graphicHeight=25,h.fillOpacity=1,h.cursor="pointer",r.style=h,r.attributes=f,b.push(r);c.addFeatures(b)}},error:function(a,c){console.log&&console.log("AQI\u6570\u636e\u8bf7\u6c42"+c)}})}function d(a){return 50>a?"\u2160":100>a?"\u2161":150>a?"\u2162":200>a?"\u2163":300>a?"\u2164":"\u2165"}function m(a){a=a.split(/[\/ :]/);return a[1]+"\u6708"+a[2]+"\u65e5"+a[3]+"\u65f6"}function h(a){if("station"==w)a=["\x3cdiv style \x3d 'width:345px;height:230px;font-size:12px;padding:0 5px;'\x3e\x3cdiv style \x3d 'position:absolute;top:0px;line-height:20px;color:#3b9cfe;'\x3e\x3cb style\x3d'font-size:14px;'\x3e",a.CITYNAME," ",m(a.ST_DT),"\x3c/b\x3e\x3c/div\x3e\x3cdiv style\x3d'padding-top:25px;'\x3e\x3cdiv  style\x3d'float:left;line-height:1.5em;width:220px;display:inline-block;'\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;color:#4d4d4d;'\x3e\u7a7a\u6c14\u8d28\u91cf\u6307\u6570AQI\uff1a\x3c/td\x3e\x3ctd\x3e",a.ST_AQI,"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;color:#4d4d4d;'\x3e\u7a7a\u6c14\u8d28\u91cf\u7b49\u7ea7\uff1a\x3c/td\x3e\x3ctd\x3e",a.ST_QUALITY,"(",a.ST_LEVEL,")\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;color:#4d4d4d;'\x3e\u9996\u8981\u6c61\u67d3\u7269\uff1a\x3c/td\x3e\x3ctd\x3e",a.ST_POL,"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;width:65px;color:#4d4d4d;'\x3e\u5065\u5eb7\u6307\u5f15\uff1a\x3c/td\x3e\x3ctd style\x3d'width:120px;'\x3e",g[a.ST_LEVEL].intro,"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv style \x3d 'display:inline-block;clear:right;'\x3e\x3cimg width\x3d'91px'height\x3d'102px' src\x3d'images/environment/",g[a.ST_LEVEL].i,".png'\x3e\x3c/img\x3e\x3cdiv style\x3d'width:120px;'\x3e",g[a.ST_LEVEL].jianyi,"\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'float:left;clear:both'\x3e\x3cstyle\x3e.paramindex{padding-left:25px;} .paramindex tr{font-size:14px;font-weight:bold;}.paramindex td{width:100px;}.paramindex span{color:#046abe;font-size:14px;padding-right:0px;}\x3c/style\x3e\x3ctable class\x3d'paramindex'\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3ePM2.5\uff1a\x3c/span\x3e",Math.ceil(1E3*parseFloat(a.ST_PM25)),"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3ePM10\uff1a\x3c/span\x3e",Math.ceil(1E3*parseFloat(a.ST_PM10)),"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eSO2\uff1a\x3c/span\x3e",Math.ceil(1E3*parseFloat(a.ST_SO2)),"\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3eNO2\uff1a\x3c/span\x3e",Math.ceil(1E3*parseFloat(a.ST_NO2)),"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eCO\uff1a\x3c/span\x3e",a.ST_CO,"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eO3\uff1a\x3c/span\x3e",Math.ceil(1E3*parseFloat(a.ST_O3)),"\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv style\x3d'float:right;clear:both;padding-top:5px;'\x3e\u5355\u4f4d:CO\u6beb\u514b/\u7acb\u65b9\u7c73\uff0c\u5176\u5b83 \u5fae\u514b/\u7acb\u65b9\u7c73\x3c/div\x3e\x3c/div\x3e",'\x3cdiv class\x3d"env_hist"\x3e\x3cdiv name\x3d"'+a.CITYNAME+'"\x3e\x3c/div\x3e',"\x3c/div\x3e"].join("");else{var c=d(a.aqi);a=["\x3cdiv style \x3d 'width:300px;height:200px;font-size:12px;padding:0 5px;'\x3e\x3cdiv style \x3d 'position:absolute;top:0px;line-height:20px;color:#3b9cfe;'\x3e\x3cb style\x3d'font-size:14px;'\x3e",a.name," ",a.gettime.replace("T"," "),"\x3c/b\x3e\x3c/div\x3e\x3cdiv style\x3d'padding-top:25px;'\x3e\x3cdiv  style\x3d'float:left;line-height:1.5em;width:220px;display:inline-block;'\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;color:#4d4d4d;'\x3e\u7a7a\u6c14\u8d28\u91cf\u6307\u6570AQI\uff1a\x3c/td\x3e\x3ctd\x3e",a.aqi,"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d' font-weight: bold;color:#4d4d4d;'\x3e\u7a7a\u6c14\u8d28\u91cf\u7b49\u7ea7\uff1a\x3c/td\x3e\x3ctd\x3e",g[c].q,"(",c,")\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv style\x3d'float:left;clear:both'\x3e\x3cstyle\x3e.paramindex{padding-left:6px;} .paramindex tr{font-size:14px;font-weight:bold;}.paramindex td{width:100px;height:30px;}.paramindex span{color:#046abe;font-size:14px;padding-right:0px;}\x3c/style\x3e\x3ctable class\x3d'paramindex'\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3ePM2.5\uff1a\x3c/span\x3e",a.pm25,"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3ePM10\uff1a\x3c/span\x3e",a.pm10,"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eSO2\uff1a\x3c/span\x3e",a.so2,"\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3eNO2\uff1a\x3c/span\x3e",a.no2,"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eCO\uff1a\x3c/span\x3e",a.co,"\x3c/td\x3e\x3ctd\x3e\x3cspan\x3eO3\uff1a\x3c/span\x3e",a.o3,"\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv style\x3d'clear:both;padding:6px;'\x3e\u5355\u4f4d:CO\u6beb\u514b/\u7acb\u65b9\u7c73\uff0c\u5176\u5b83 \u5fae\u514b/\u7acb\u65b9\u7c73\x3c/div\x3e\x3c/div\x3e",'\x3cdiv class\x3d"env_hist"\x3e\x3cdiv name\x3d"'+a.bm+'"\x3e\x3c/div\x3e',"\x3c/div\x3e"].join("")}return a}function l(c){null!=a.widgetPop&&a.removePopup(a.widgetPop);c=c.feature;var b=h(c.attributes);a.widgetPop=new Ol2.Popup.FramedCloud("chicken",c.geometry.getBounds().getCenterLonLat(),null,b,null,!0,function(){null!=a.widgetPop&&(a.removePopup(a.widgetPop),a.unSelect())});a.addPopup(a.widgetPop);$(".env_hist\x3ediv").click(function(){var a=$(this).attr("name");f(a)})}function f(a){0==$("#env_HistFrame").length&&($("body").append("\x3cdiv id\x3d'env_HistFrame'\x3e\x3cdiv style\x3d'filter:alpha(opacity:50);opacity:0.3;background:#808080;width:100%;height:100%;position:absolute;left:0;top:0;z-index: 1100'\x3e\x3c/div\x3e\x3cdiv id\x3d'env_Hist_view' style\x3d'padding: 5px;border:1px solid #849DF9;border-radius: 5px;position:relative;margin:auto;top:13%;left:6%; width:65%;height:65%;background-color:white;z-index: 1101'\x3e\x3ciframe style\x3d'margin: 2px 2px;height:98%;width:99%;border: 1px solid #C5C5C5;border-radius: 3px;' width\x3d'100%' height\x3d'100%' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'no' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3cdiv style\x3d'position: absolute;position: absolute;top: 6px;font-size:14px;left: 12px;color: #1515EF;'\x3e\x3c/div\x3e\x3cdiv id\x3d'env_Hist_close' style\x3d'position: absolute;top:8px;right:9px;width:20px;height:20px; background-image: url(images/close.png);' \x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"),$("#env_Hist_close").click(function(){$("#env_HistFrame").hide()}));var c;a&&(c="../page/envStatistic.html?name\x3d"+encodeURIComponent(a),"city"==a?c="../page/envMonthStatistic.html":"contrast"==a&&(c="../page/envCityStatistic.html"));$("#env_HistFrame").css("display","block").find("iframe").attr("src",c)}if(null!=EnvironmentWidget.unique)return EnvironmentWidget.unique;EnvironmentWidget.unique=this;var g={"\u2160":{i:1,q:"\u4f18",intro:"\u7a7a\u6c14\u8d28\u91cf\u4ee4\u4eba\u6ee1\u610f\uff0c\u57fa\u672c\u65e0\u7a7a\u6c14\u6c61\u67d3",jianyi:"\u975e\u5e38\u9002\u5b9c\u6237\u5916\u6d3b\u52a8"},"\u2161":{i:2,q:"\u826f",intro:"\u7a7a\u6c14\u8d28\u91cf\u53ef\u63a5\u53d7\uff0c\u4f46\u67d0\u4e9b\u6c61\u67d3\u7269\u53ef\u80fd\u5bf9\u6781\u5c11\u6570\u5f02\u5e38\uff0c\u654f\u611f\u4eba\u7fa4\u5065\u5eb7\u6709\u8f83\u5f31\u5f71\u54cd",jianyi:"\u9002\u5b9c\u6237\u5916\u6d3b\u52a8\u6216\u953b\u70bc"},"\u2162":{i:3,q:"\u8f7b\u5ea6\u6c61\u67d3",intro:"\u6613\u611f\u4eba\u7fa4\u75c7\u72b6\u6709\u8f7b\u5ea6\u52a0\u5267\uff0c\u5065\u5eb7\u4eba\u7fa4\u51fa\u73b0\u523a\u6fc0\u75c7\u72b6",jianyi:"\u51cf\u5c11\u6237\u5916\u953b\u70bc"},"\u2163":{i:4,q:"\u4e2d\u5ea6\u6c61\u67d3",intro:"\u8fdb\u4e00\u6b65\u52a0\u5267\u6613\u611f\u4eba\u7fa4\u75c7\u72b6\uff0c\u53ef\u80fd\u5bf9\u5065\u5eb7\u4eba\u7fa4\u5fc3\u810f\u3001\u547c\u5438\u7cfb\u7edf\u6709\u5f71\u54cd",jianyi:"\u505c\u6b62\u6237\u5916\u953b\u70bc\uff0c\u51cf\u5c11\u6237\u5916\u6d3b\u52a8"},"\u2164":{i:5,q:"\u91cd\u5ea6\u6c61\u67d3",intro:"\u5fc3\u810f\u75c5\u548c\u80ba\u75c5\u60a3\u8005\u75c7\u72b6\u663e\u8457\u52a0\u5267\uff0c\u8fd0\u52a8\u8010\u53d7\u529b\u51cf\u4f4e\uff0c\u5065\u5eb7\u4eba\u7fa4\u666e\u904d\u51fa\u73b0\u75c7\u72b6",jianyi:"\u4e0d\u9002\u5b9c\u6237\u5916\u6d3b\u52a8\uff0c\u6237\u5916\u6d3b\u52a8\u65f6\u5e94\u4f69\u6234\u53e3\u7f69"},"\u2165":{i:6,q:"\u4e25\u91cd\u6c61\u67d3",intro:"\u5065\u5eb7\u4eba\u8fd0\u52a8\u8010\u53d7\u529b\u51cf\u4f4e\uff0c\u6709\u663e\u8457\u5f3a\u70c8\u75c7\u72b6\uff0c\u63d0\u524d\u51fa\u73b0\u67d0\u4e9b\u75be\u75c5",jianyi:"\u53d6\u6d88\u4e0d\u5fc5\u8981\u7684\u6237\u5916\u6d3b\u52a8"},"--":{i:7,q:"",intro:"\u65e0\u6570\u636e",jianyi:"\u8bbe\u5907\u6545\u969c"},"\u2014":{i:7,q:"",intro:"\u65e0\u6570\u636e",jianyi:"\u8bbe\u5907\u6545\u969c"}},a=null,c=null,b=null,e=!1,v=null,w="";return{init:function(b,d,f){c=new Ol2.Layer.Vector("\u73af\u5883",{style:d,renderers:b});a=f;v=$("\x3cdiv\x3e\x3c/div\x3e").attr("id","lengend_envri").addClass("legenddiv").css("width","300px").append("\x3cimg src\x3d'Images/environment/aqi.png' width\x3d'300px' height\x3d'100px'/\x3e");$("#"+a.map.div.id).append(v);a.addLayer(c,!0);c.events.on({featureselected:l});e=!0},Show:function(a){e&&(a=null==a?"station":a.split("_")[1],"contrast"==a||"city"==a?f(a):(a!=w&&(w=a,k()),c.setVisibility(!0),$("#lengend_envri").show()))},Hide:function(){c.setVisibility(!1);$("#lengend_envri").hide();null!=a.widgetPop&&a.removePopup(a.widgetPop)},Dispose:function(){b&&(b.abort(),b=null);a.removeLayer(c,!0);null!=a.widgetPop&&a.removePopup(a.widgetPop);e=!1;c=null;w="";v.remove();v=null;$("#env_HistFrame").remove()},isInit:function(){return e}}}function WaterQuanlityWidget(){function k(){0<y.length&&t?m(y):(y=[],e=$.ajax({type:"GET",url:q+"\x26param\x3d{type:'1'}",dataType:"jsonp",success:function(a){e=$.ajax({type:"GET",url:q+"\x26param\x3d{type:'2'}",dataType:"jsonp",success:function(a){y=0==y.length?a:y.concat(a);m(a);t=!0},error:function(a,c){console.log&&console.log("\u9762\u6570\u636e\u8bf7\u6c42"+c)}});y=0==y.length?a:y.concat(a);m(a)},error:function(a,c){console.log&&console.log("\u7ebf\u6570\u636e\u8bf7\u6c42"+c)}}))}function d(a){u=a.xy}function m(a){for(var c=a.length,d=0;d<c;d++){var e=a[d].GEOM.split("@"),f=e.length;if(!(2>f)){for(var g=[],n=1;n<f;n++)g.push(l(e[n]));a[d].geom=null;f=g;e=a[d];if(b){var g=f.length,k=n=n=void 0;if(!(1>g)){if("1"==e.GTYPE)if(1==g)n=new Ol2.Geometry.LineString(f[0]);else{n=[];for(k=0;k<g;k++)n.push(new Ol2.Geometry.LineString(f[k]));n=new Ol2.Geometry.MultiLineString(n)}else if(1==g)n=new Ol2.Geometry.Polygon([new Ol2.Geometry.LinearRing(f[0])]);else{n=[];for(k=0;k<g;k++)n.push(new Ol2.Geometry.Polygon([new Ol2.Geometry.LinearRing(f[k])]));n=new Ol2.Geometry.MultiPolygon(n)}f=new Ol2.Feature.Vector(n);f.attributes=e;g=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);g.fillColor=h(e.WATER);g.fillOpacity=.5;g.strokeWidth=2;g.strokeColor=h(e.WATER);g.cursor="pointer";f.style=g;b.addFeatures(f)}}}}}function h(a){switch(a){case "I":case "II":a="#0669FF";break;case "III":a="#09932E";break;case "IV":a="#FFFF00";break;case "V":a="#FF7000";break;case "\u52a3V":a="#C80000";break;default:a="#8C8C8C"}return a}function l(a){for(var c=a.length,b=[],d,e,f=0;f<c;f+=10)e=a.substr(f,5),d=a.substr(f+5,5),e=parseInt(e,36)/1E5,d=parseInt(d,36)/1E5,b.push(new Ol2.Geometry.Point(e,d));return b}function f(a){null!=c.widgetPop&&c.removePopup(c.widgetPop);var b=a.attributes.BM;e=$.ajax({type:"GET",url:Service.RTServiceRiver+"ctype\x3driver\x26op\x3dgetriverattr\x26param\x3d{id:'"+b+"'}",dataType:"jsonp",success:function(c){g(c,a,b)},error:function(a){console.log&&console.log("\u6570\u636e\u8bf7\u6c42"+a)}})}function g(b,d,e){var f=c.map.getLonLatFromViewPortPx(u),g,h,k,l,t,q;g=b[0].YEAR;h=b[0].MONTH;k=b[0].BASIN;l=b[0].RIVER;t=b[0].SECTION;q=b[0].CITY;b=b[0].WATER;var m=["\x3cdiv style\x3d'padding:0 5px;min-width:130px;'\x3e\x3cdiv style \x3d 'position:relative; margin-bottom:10px;color:#3b9cfe;'\x3e\x3cb\x3e\u4e3b\u8981\u6cb3\u6d41\u6c34\u8d28\u72b6\u51b5\x3c/b\x3e\x3c/div\x3e \x3cdiv style \x3d 'line-height:1.5em;'\x3e\u521b\u5efa\u65e5\u671f\uff1a"];m.push(g+"-"+h);m.push("\x3cbr\x3e\u6d41\u57df\u540d\u79f0\uff1a");m.push(k);m.push("\x3cbr\x3e\u6cb3\u6d41\u540d\u79f0\uff1a");m.push(l);m.push("\x3cbr\x3e\u65ad\u9762\u540d\u79f0\uff1a");m.push(t);m.push("\x3cbr\x3e\u63a7\u5236\u6c34\u57df\uff1a");m.push(q);m.push("\x3cbr\x3e\u6c34\u8d28\u7c7b\u522b\uff1a");m.push(b);m.push("\x3cbr\x3e\u5e38\u89c1\u9c7c\u7c7b\uff1a\x3cimg src\x3d'images/water/fish1.png' width\x3d'30px' height\x3d'30px'/\x3e");m.push("\x3cbr\x3e\x3cdiv style\x3d'margin: 7px -38px;left: 50%;position: relative; cursor: pointer;'\x3e\x3cimg subid\x3d'"+e+"'class\x3d'water_hist' src\x3d'images/pollution/listtitles.png' width\x3d'77px' height\x3d'28px'/\x3e \x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");c.widgetPop=new Ol2.Popup.FramedCloud("chicken",f,null,m.join(""),null,!0,function(){c.removePopup(c.widgetPop);c.unSelect()});d.popup=c.widgetPop;c.addPopup(c.widgetPop);$(".water_hist").click(function(){var c=$(this).attr("subid");a(c)})}function a(a){0==$("#wat_HistFrame").length&&($("body").append("\x3cdiv id\x3d'wat_HistFrame' style\x3d'height:90%'\x3e\x3cdiv style\x3d'filter:alpha(opacity:50);opacity:0.3;background:#808080;width:100%;height:100%;position:absolute;left:0;top:0;z-index: 1100'\x3e\x3c/div\x3e\x3cdiv id\x3d'wat_Hist_view' style\x3d'padding: 5px;border:1px solid #849DF9;border-radius: 5px;position:relative;margin:auto;top:13%;left:6%; width:65%;height:87%;background-color:white;z-index: 1101'\x3e\x3ciframe style\x3d'margin: 2px 2px;height:98%;width:99%;border: 1px solid #C5C5C5;border-radius: 3px;' width\x3d'100%' height\x3d'100%' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'auto' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3cdiv style\x3d'position: absolute;position: absolute;top: 6px;font-size:14px;left: 12px;color: #1515EF;'\x3e\x3c/div\x3e\x3cdiv id\x3d'wat_Hist_close' style\x3d'position: absolute;top:8px;right:9px;width:20px;height:20px; background-image: url(images/close.png);' \x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"),$("#wat_Hist_close").click(function(){$("#wat_HistFrame").hide()}));var c;a&&(c="../page/waterStatistic.html?id\x3d"+encodeURIComponent(a));$("#wat_HistFrame").css("display","block").find("iframe").attr("src",c)}if(null!=WaterQuanlityWidget.unique)return WaterQuanlityWidget.unique;WaterQuanlityWidget.unique=this;var c=null,b=null,e=null,v=!1,w=null,u=null,y=[],t=!1,q=Service.RTServiceRiver+"ctype\x3driver\x26op\x3dgetriver";return{init:function(a,e,g){b=new Ol2.Layer.Vector("\u6c34\u8d28",{style:e,renderers:a});c=g;w=$("\x3cdiv\x3e\x3c/div\x3e").attr("id","lengend_water").addClass("legenddiv").css("width","239px").append("\x3cimg src\x3d'Images/water/waterlegend.png' width\x3d'220px' height\x3d'80px'/\x3e");$("#"+c.map.div.id).append(w);c.addLayer(b,!0);b.events.on({featureselected:function(a){f(a.feature)}});c.map.events.register("mousemove",c,d);v=!0},Show:function(){v&&k()},Hide:function(){b.setVisibility(!1);null!=c.widgetPop&&c.removePopup(c.widgetPop)},Dispose:function(){e&&(e.abort(),e=null);c.removeLayer(b,!0);null!=c.widgetPop&&c.removePopup(c.widgetPop);v=!1;w.remove();b=w=null;c.map.events.unregister("mousemove",c,d)},isInit:function(){return v}}}function WaterConditionWidget(){function k(a){c=a;0<b[c].length?d():g=$.ajax({type:"GET",url:Service.RTService+"ctype\x3dwater\x26op\x3dgetwater\x26param\x3d{type:'"+c+"'}",dataType:"jsonp",success:function(a){if("object"==typeof a){for(var e=0;e<a.length;e++)b[c].push(a[e]);d()}},error:function(a,c,b){console.log&&console.log(a)}})}function d(){var a,d;if(f)if(f.removeAllFeatures(),null!=l.widgetPop&&l.removePopup(l.widgetPop),"river"==c){for(a=0;a<b[c].length;a++){d=b[c][a];var g=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(d.X),parseFloat(d.Y))),h=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),k="p.gif";"5"==d.ZTYPE?k="z.gif":"4"==d.ZTYPE&&(k="j.gif");h.externalGraphic="images/rain/"+k;h.graphicWidth=11;h.graphicHeight=11;h.fillOpacity=1;h.cursor="pointer";g.style=h;g.attributes=d;f.addFeatures(g)}e.css({width:"73px",height:"90px",display:"block",background:"url('images/rain/k.png')"})}else{for(a=0;a<b[c].length;a++)d=b[c][a],g=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(d.X),parseFloat(d.Y))),h=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),k="z.gif","1"==d.ISLIMIT&&(k="cj.gif"),h.externalGraphic="images/rain/"+k,h.graphicWidth=11,h.graphicHeight=11,h.fillOpacity=1,h.cursor="pointer",g.style=h,g.attributes=d,f.addFeatures(g);e.css({width:"80px",height:"85px",display:"block",background:"url('images/rain/b.png')"})}}function m(a){null!=l.widgetPop&&l.removePopup(l.widgetPop);var b=a.attributes,d=b.NAME,e;"river"==c?(e="\u65f6\u95f4\uff1a"+b.TIME,"1"==b.TYPE?(e+="\x3cbr\x3e\u95f8\u4e0a\u6c34\u4f4d:"+b.Z+" m",e+="\x3cbr\x3e\u95f8\u4e0b\u6c34\u4f4d:"+b.EXT2+" m"):e+="\x3cbr/\x3e\u6c34\u4f4d\uff1a"+b.Z+"m",b.Q&&(e+="\x3cbr\x3e\u6d41\u91cf\uff1a"+b.Q+" m\u00b3/s")):e="\u65f6\u95f4\uff1a"+b.TIME+"\x3cbr/\x3e\u6c34\u4f4d\uff1a"+b.Z+"m\x3cbr/\x3e";l.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;min-width:130px;'\x3e\x3cdiv style \x3d 'position:absolute;top:0px;color:#3b9cfe;'\x3e\x3cb\x3e"+d+"\x3c/b\x3e\x3c/div\x3e\x3cdiv style\x3d'line-height:1.5em;margin-top:25px;'\x3e"+e+'\x3c/div\x3e\x3cdiv class\x3d"river_hist"\x3e\x3cdiv subid\x3d"'+b.SUBID+'"\x3e\x3c/div\x3e\x3c/div\x3e',null,!0,function(){l.removePopup(l.widgetPop);l.unSelect()});a.popup=l.widgetPop;l.addPopup(l.widgetPop);$(".river_hist\x3ediv").click(function(){var a=$(this).attr("subid");h(a)})}function h(a){0==$("#river_HistFrame").length&&($("body").append("\x3cdiv id\x3d'river_HistFrame'\x3e\x3cdiv style\x3d'filter:alpha(opacity:50);opacity:0.3;background:#808080;width:100%;height:100%;position:absolute;left:0;top:0;z-index: 1100'\x3e\x3c/div\x3e\x3cdiv id\x3d'river_Hist_view' style\x3d'padding: 5px;border:1px solid #849DF9;border-radius: 5px;position:absolute; left: 50%;top: 50%;margin-top:-260px;padding: 0;margin-left:-480px;width:1000px;height:520px;background-color:white;z-index: 1101'\x3e\x3ciframe style\x3d'margin: 2px 5px;border: 1px solid #C5C5C5;border-radius: 3px;' width\x3d'990' height\x3d'512' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'no' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3cdiv style\x3d'position: absolute;position: absolute;top: 6px;font-size:14px;left: 12px;color: #1515EF;'\x3e\u5386\u53f2\u4fe1\u606f\u8be6\u60c5\x3c/div\x3e\x3cdiv id\x3d'river_Hist_close' style\x3d'position: absolute;top:6px;right:6px;width:20px;height:20px; background-image: url(images/close.png);' \x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"),$("#river_Hist_close").click(function(){$("#river_HistFrame").hide()}));var b=$("#river_HistFrame").css("display","block").find("iframe");"river"!=c?b.attr("src","../page/reservoirStatistic.html?id\x3d"+encodeURIComponent(a)):b.attr("src","../page/riverStatistic.html?id\x3d"+encodeURIComponent(a))}if(null!=WaterConditionWidget.unique)return WaterConditionWidget.unique;WaterConditionWidget.unique=this;var l=null,f=null,g=null,a=!1,c="",b={reservoir:[],river:[]},e;return{init:function(c,b,d){f=new Ol2.Layer.Vector("\u6c34\u60c5",{style:b,renderers:c});l=d;l.addLayer(f,!0);f.events.on({featureselected:function(a){m(a.feature)}});e=$("\x3cdiv style\x3d'z-index:980;border:1px solid #696969;position:absolute;right:50px;bottom:50px;'\x3e\x3cdiv style\x3d'position: relative;font-size: 14px;color: #3C06E7;font-weight: bold;padding: 7px 1px;left: 50%;margin-left: 11px;'\x3e\x3c/div\x3e\x3c/div\x3e");$(l.map.div).after(e);a=!0},Show:function(b){b=null==b?"river":b.split("_")[1];a&&b!=c&&k(b)},Hide:function(){f.setVisibility(!1);null!=l.widgetPop&&l.removePopup(l.widgetPop);e.hide()},Dispose:function(){g&&(g.abort(),g=null);l.removeLayer(f,!0);null!=l.widgetPop&&l.removePopup(l.widgetPop);b={river:[],reservoir:[]};a=!1;c="";e.remove();f=null;$("river_HistFrame").remove()},isInit:function(){return a}}}function RainWidget(){function k(a){f.removeAllFeatures();0<b[c][a].length?d():g=$.ajax({type:"GET",url:Service.RTService+"ctype\x3drain\x26op\x3d"+c+"\x26param\x3d{k:"+a+"}\x26_t\x3d"+Date.now(),dataType:"jsonp",success:function(a){if("object"==typeof a){var e=[],f,g;if(!(1>a.length)){if("day"!=c){for(var h=f=0;h<a.length;h++)a[h].val=a[h].VAL?Math.round(parseFloat(a[h].VAL)):0,a[h].val>f&&(f=a[h].val);0==f&&(f=150);for(var k=150/f,h=0;h<a.length;h++){f=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(a[h].X),parseFloat(a[h].Y)));f.attributes=a[h];g=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);g.fillOpacity=1;g.cursor="pointer";g.fontSize="15px";g.fontWeight="bold";g.graphicWidth=20;g.externalGraphic="images/statics/bar.png";var l=Math.round(k*a[h].val);6>l&&(l=6);g.graphicHeight=l;g.label=a[h].VAL?Math.round(10*parseFloat(a[h].VAL))/10+"":"--";g.labelYOffset=g.graphicHeight/2+6;f.style=g;e.push(f)}}else for(h=0;h<a.length;h++)f=new Ol2.Feature.Vector(new Ol2.Geometry.Point(parseFloat(a[h].X),parseFloat(a[h].Y))),f.attributes=a[h],g=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),g.fillOpacity=1,g.strokeColor="gray",g.cursor="pointer",k=g,l=a[h].VAL,"number"!=typeof l&&(l=l?parseFloat(l):0),k.fillColor=.1>l?"gray":1>l?"#00ffff":25>l?"#ffff00":50>l?"#0c680d":100>l?"#0000ff":200>l?"#ff00ff":"#ff0000","gray"==g.fillColor?g.pointRadius=6:(g.pointRadius=10,g.label=a[h].VAL?Math.round(10*parseFloat(a[h].VAL))/10+"":"--",g.labelYOffset=-15,g.fontSize="15px",g.fontWeight="bold"),f.style=g,e.push(f);b[c][v]=e}d()}},error:function(a,c,b){console.log&&console.log(a)}})}function d(){f.addFeatures(b[c][v]);"day"!=c?w.css({width:"185px",height:"85px",display:"block",background:"url('images/rain/r_legend1.png')"}):w.css({width:"237px",height:"134px",display:"block",background:"url('images/rain/r_legend2.png')"})}function m(a){var b=a.attributes;l.widgetPop&&l.removePopup(l.widgetPop);l.widgetPop=new Ol2.Popup.FramedCloud("chicken",new Ol2.LonLat(a.geometry.x,a.geometry.y),null,"\x3cdiv style\x3d'padding:0 5px;min-width:130px;'\x3e\x3cdiv style \x3d 'position:absolute;top:0px;color:#3b9cfe;'\x3e\x3cb\x3e"+b.NAME+" ("+("month"==c?"\u6700\u8fd1\u4e00\u4e2a\u6708\u96e8\u91cf":"\u6700\u8fd124\u5c0f\u65f6\u96e8\u91cf")+")\x3c/b\x3e\x3c/div\x3e\x3cdiv style\x3d'line-height:1.5em;margin-top:25px;'\x3e\u603b\u96e8\u91cf:"+(b.VAL?Math.round(10*parseFloat(b.VAL))/10:"--")+" mm\x3c/div\x3e\x3cdiv class\x3d'rain_hist_frm'\x3e\x3ciframe style\x3d'margin: 2px 5px;border: 1px solid #C5C5C5;border-radius: 3px;' width\x3d'560' height\x3d'300' frameborder\x3d'no' border\x3d'0' marginwidth\x3d'0' marginheight\x3d'0' scrolling\x3d'no' allowtransparency\x3d'yes'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,function(){l.removePopup(l.widgetPop);l.unSelect()});l.addPopup(l.widgetPop);var d={op:"day",k:v,n:b.NAME,bm:b.BM};"month"==c&&(d.op="days");setTimeout(function(){$(".rain_hist_frm").find("iframe").attr("src","../page/rainStatistic.html?"+parseParam(d))},300)}function h(a){if(9>l.map.zoom){if(0==v&&1!=a)return;v=0}else{if(1==v&&1!=a)return;v=1}k(v)}if(null!=RainWidget.unique)return RainWidget.unique;RainWidget.unique=this;var l=null,f=null,g=null,a=!1,c="",b={day:[[],[]],month:[[],[]]},e=!1,v=-1,w;return{init:function(c,b,d){f=new Ol2.Layer.Vector("\u96e8\u60c52",{style:b,renderers:c});l=d;l.addLayer(f,!0);f.events.on({featureselected:function(a){m(a.feature)}});w=$("\x3cdiv style\x3d'z-index:980;border:1px solid #696969;position:absolute;right:50px;bottom:50px;'\x3e\x3cdiv style\x3d'position: relative;font-size: 14px;color: #3C06E7;font-weight: bold;padding: 7px 1px;left: 50%;margin-left: 11px;'\x3e\x3c/div\x3e\x3c/div\x3e");$(l.map.div).after(w);a=!0},Show:function(b){b=null==b?"day":b.split("_")[1];a&&b!=c&&(c=b,h(1),e||(l.map.events.register("zoomend",l.map,h),e=!0))},Hide:function(){f.setVisibility(!1);null!=l.widgetPop&&l.removePopup(l.widgetPop);w.hide()},Dispose:function(){g&&(g.abort(),g=null);l.removeLayer(f,!0);null!=l.widgetPop&&l.removePopup(l.widgetPop);b={day:[[],[]],month:[[],[]]};a=!1;c="";f=null;e&&(l.map.events.unregister("zoomend",l.map,h),e=!1);v=void 0;w.remove()},isInit:function(){return a}}}function VideoWidget(){function k(){m=$.ajax({type:"GET",url:"video/videodata.txt",datatype:"text",success:function(a){g=JSON.parse(a);for(a=0;a<g.length;a++){var c=g[a];if(l){var b=new Ol2.Feature.Vector(new Ol2.Geometry.Point(c.x,c.y)),d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);d.externalGraphic="images/video/video.png";d.graphicWidth=24;d.graphicHeight=24;d.fillOpacity=1;d.cursor="pointer";b.style=d;b.attributes=c;l.addFeatures(b)}}},error:function(a,c){console.log&&console.log("\u89c6\u9891\u6570\u636e\u8bf7\u6c42"+c)}})}function d(a){null!=h.widgetPop&&h.removePopup(h.widgetPop);h.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,'\x3cdiv id \x3d "PopDiv" style \x3d ""\x3e\x3cdiv id \x3d "PopDiv_title" style\x3d"width:420px;height:22px;font-weight:bold;font-size: 14px;line-height: 22px;padding-left: 5px;color:#3b9cfe;"\x3e\x3c/div\x3e\x3cdiv id \x3d "PopDiv_frame" style\x3d"width:430px;height:330px;"\x3e\x3ciframe id\x3d"popiframe" width\x3d"100%" height\x3d"100%" frameborder\x3d"0"\x3e\x3c/iframe\x3e\x3cdiv/\x3e\x3c/div\x3e',null,!0,function(){null!=h.widgetPop&&(h.removePopup(h.widgetPop),h.unSelect())});a.popup=h.widgetPop;a.popup.autoSize=!0;h.addPopup(h.widgetPop);var c;"1"==a.attributes.type?(c="video/iermu.html?title\x3d"+encodeURI(a.attributes.name)+"\x26"+a.attributes.request,$("#PopDiv_frame").css("width","470px"),$("#PopDiv_frame").css("height","333px")):"2"==a.attributes.type?(c="video/anqiaoqiao.html?title\x3d"+encodeURI(a.attributes.name)+"\x26request\x3d"+a.attributes.request,$("#PopDiv_frame").css("width","430px"),$("#PopDiv_frame").css("height","330px")):(c="video/square.html?title\x3d"+encodeURI(a.attributes.name)+"\x26request\x3d"+a.attributes.request,$("#PopDiv_frame").css("width","440px"),$("#PopDiv_frame").css("height","340px"));a.popup.updateSize();$("#popiframe").attr("src",c);$("#PopDiv_title").empty();$("#PopDiv_title").html(a.attributes.name)}if(null!=VideoWidget.unique)return VideoWidget.unique;VideoWidget.unique=this;var m=null,h=null,l=null,f=!1,g=[{id:"wrs",name:"\u671b\u4eba\u677e",x:117.106774,y:36.246327},{id:"gongbei",name:"\u62f1\u5317\u77f3",x:117.106063,y:36.256359},{id:"wydz",name:"\u5929\u8857",x:117.098694,y:36.2558},{id:"nantian",name:"\u5357\u5929\u95e8",x:117.098355,y:36.255723}];return{init:function(a,c,b){l=new Ol2.Layer.Vector("\u89c6\u9891",{style:c,renderers:a});h=b;h.addLayer(l,!0);l.events.on({featureselected:function(a){d(a.feature)}});f=!0},Show:function(a){f&&k(a)},Hide:function(){l.setVisibility(!1);null!=h.widgetPop&&h.removePopup(h.widgetPop)},Dispose:function(){m&&(m.abort(),m=null);h.removeLayer(l,!0);null!=h.widgetPop&&h.removePopup(h.widgetPop);f=!1;l=null},isInit:function(){return f}}}function PopulationWidget(){function k(c){c!=t&&(null!=a.widgetPop&&a.removePopup(a.widgetPop),t=c,"rkzs"==t?(q&&q.abort(),y.css({width:"166px",height:"82px",display:"block",background:"url('images/statics/rk_legend1.png')"}),0<e.length?557114<a.map.getScale()?h(2):h(3):q=$.ajax({type:"GET",url:g+"\x26op\x3dGetRKZS\x26param\x3d{year:'2016'}",dataType:"jsonp",success:function(a){m(a)},error:function(a,c){console.log&&console.log("\u4eba\u53e3\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42"+c)}})):(q&&q.abort(),y.css({width:"381px",height:"148px",display:"block",background:"url('images/statics/rk_legend.png')"}),0<w.length?h():q=$.ajax({type:"GET",url:g+"\x26op\x3dGetRKMD\x26param\x3d{year:'2016',level:'3'}",dataType:"jsonp",success:function(a){m(a)},error:function(a,c){console.log&&console.log("\u4eba\u53e3\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42"+c)}})))}function d(c){557114<a.map.getScale()?3==u&&h(2):2==u&&h(3)}function m(c){if(c){var b=c.Result,d=c.Count;0<d&&y.children("div").text("("+b[0].year+"\u5e74)");if("rkzs"==t){for(c=0;c<d;c++)"2"==b[c].level_?e.push(b[c]):v.push(b[c]);557114<a.map.getScale()?h(2):h(3)}else{var f=new Ol2.Format.WKT;for(c=0;c<d;c++)w.push({rkmd:Math.round(1E3*b[c].rkmd)/1E3,geom:f.read(b[c].geometry)});h()}}}function h(a){if(c)if(c.removeAllFeatures(),"rkzs"==t){u=a;var b,d,f,g,h;if(2==u)for(f=0,g=e.length;f<g;f++)d=e[f],a=new Ol2.Feature.Vector(new Ol2.Geometry.Point(d.x,d.y)),b=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),b.externalGraphic="images/statics/point.png",h=parseInt(Math.sqrt(2*d.rkzs)),b.graphicWidth=h,b.graphicHeight=h,b.fillOpacity=1,b.cursor="pointer",a.style=b,a.attributes=d,c.addFeatures(a);else for(f=0,g=v.length;f<g;f++)d=v[f],a=new Ol2.Feature.Vector(new Ol2.Geometry.Point(d.x,d.y)),b=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),b.externalGraphic="images/statics/point.png",h=parseInt(Math.sqrt(20*d.rkzs)),b.graphicWidth=h,b.graphicHeight=h,b.fillOpacity=1,b.cursor="pointer",a.style=b,a.attributes=d,c.addFeatures(a)}else for(f=0,g=w.length;f<g;f++)d=w[f],a=d.geom,b=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),h=3E3<d.rkmd?"#6b0000":800<d.rkmd?"#ad5313":500<d.rkmd?"#f2a72e":300<d.rkmd?"#fad155":"#ffff80",b.strokeColor="#ffffff",b.strokeOpacity=.75,b.fillColor=h,b.strokeWidth=1,b.fillOpacity=.75,b.cursor="pointer",a.style=b,a.attributes={rkmd:d.rkmd},c.addFeatures(a)}function l(){p.style.fillOpacity=.75;c.drawFeature(p);a.removePopup(a.widgetPop);p=null;a.unSelect()}function f(b){function d(a){sects=[];if(0<a.items.length)for(var c=0,b=a.items.length;c<b;c++)sects.push({name:a.items[c].name,y:parseFloat(a.items[c].rkzs)});years=[];hist=[];c=0;for(count=a.Count;c<count;c++)hist.push(parseFloat(a.Result[c].rkzs)),years.push(a.Result[c].year);$(".titlediv\x3ediv").click(function(a){a=$(this);"staticsTab1"==this.id?e():f();a.children().addClass("active");a.siblings().children().removeClass("active")});e()}function e(){$("#staticsDiv").highcharts({chart:{type:"column"},title:{text:""},legend:{enabled:!1},xAxis:{categories:years},yAxis:{min:0,title:{text:"\u4e07\u4eba"}},tooltip:{headerFormat:'\x3cspan style\x3d"font-size:10px"\x3e{point.key}\x3c/span\x3e\x3ctable\x3e',pointFormat:'\x3ctr\x3e\x3ctd style\x3d"color:{series.color};padding:0"\x3e{series.name}: \x3c/td\x3e\x3ctd style\x3d"padding:0"\x3e\x3cb\x3e{point.y:.1f}\u4e07\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e',footerFormat:"\x3c/table\x3e",shared:!0,useHTML:!0},series:[{name:"\u4eba\u53e3\u6570",data:hist,dataLabels:{formatter:function(){return this.point.name},color:"yellow",distance:-15}}]})}function f(){$("#staticsDiv").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},legend:{align:"center"},title:{text:""},tooltip:{pointFormat:"{series.name}: \x3cb\x3e{point.percentage:.1f}%\x3c/b\x3e"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"\x3cb\x3e{point.y}\x3c/b\x3e"},showInLegend:!0}},series:[{type:"pie",name:"\u767e\u5206\u6bd4",data:sects,size:"100%",dataLabels:{formatter:function(){return this.point.name},color:"white",distance:-25}}]})}null!=a.widgetPop&&a.removePopup(a.widgetPop);if("rkmd"==t)p&&(p.style.fillOpacity=.75,c.drawFeature(p)),p=b,a.widgetPop=new Ol2.Popup("\u6587\u672c\u6807\u6ce8",b.geometry.getBounds().getCenterLonLat(),new Ol2.Size(80,18),"\x3cdiv style \x3d 'position:relative; cursor:pointer;'\x3e\x3cb\x3e"+b.attributes.rkmd+"\x3c/div\x3e",!0,l),p.style.fillOpacity=.5,c.drawFeature(p),b.popup=a.widgetPop,a.addPopup(a.widgetPop);else{var h="";2==u&&(h="\x3cdiv id \x3d 'staticsTab2'\x3e\x3cdiv class\x3d'stc_xqpic'\x3e\x3c/div\x3e\x3cdiv class\x3d'stc_title'\x3e\u53bf\u533a\u6bd4\u4f8b\u56fe\x3c/div\x3e\x3c/div\x3e");a.widgetPop=new Ol2.Popup.FramedCloud("chicken",b.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;'\x3e\x3cdiv style \x3d 'position:relative;font-size: 14px; margin-bottom:10px;cursor:pointer;color:#3b9cfe;'\x3e\x3cb\x3e"+b.attributes.name+"\u4eba\u53e3\u6570\u636e\x3c/b\x3e \x3c/div\x3e\x3cdiv class\x3d'maindiv'\x3e\x3cdiv class\x3d'titlediv' \x3e\x3cdiv id \x3d 'staticsTab1'\x3e\x3cdiv class\x3d'stc_hispic active'\x3e\x3c/div\x3e\x3cdiv class\x3d'stc_title active'\x3e\u5386\u5e74\u5bf9\u6bd4\u56fe\x3c/div\x3e\x3c/div\x3e"+h+"\x3c/div\x3e\x3cdiv id \x3d 'staticsDiv'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,function(){a.removePopup(a.widgetPop);a.unSelect()});b.popup=a.widgetPop;a.addPopup(a.widgetPop);$.ajax({url:g+"\x26op\x3dGetHistoryRKZS\x26param\x3d{pac:'"+b.attributes.pac+"',year:'2016'}",dataType:"jsonp",async:!1,success:function(a){d(a)},error:function(a,c){console.log&&console.log("\u4eba\u53e3\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42"+c)}})}}if(null!=PopulationWidget.unique)return PopulationWidget.unique;PopulationWidget.unique=this;var g=Service.RTServiceStatistics+"ctype\x3dpopulation",a=null,c=null,b=!1,e=[],v=[],w=[],u,y=null,t="",q=null,p=null;return{init:function(d,e,g){c=new Ol2.Layer.Vector("\u4eba\u53e3",{style:e,renderers:d});a=g;a.addLayer(c,!0);c.events.on({featureselected:function(a){f(a.feature)}});y=$("\x3cdiv style\x3d'z-index:980;border:1px solid #696969;position:absolute;right:50px;bottom:50px;'\x3e\x3cdiv style\x3d'position: relative;font-size: 14px;color: #3C06E7;font-weight: bold;padding: 7px 1px;left: 50%;margin-left: 11px;'\x3e\x3c/div\x3e\x3c/div\x3e");$(a.map.div).after(y);b=!0},Show:function(c){c=null==c?"rkzs":c.split("_")[1];b&&(k(c),a.map.events.register("zoomend",a.map,d))},Hide:function(){c.setVisibility(!1);null!=a.widgetPop&&a.removePopup(a.widgetPop);y.hide()},Dispose:function(){q&&(q.abort(),q=null);a.removeLayer(c,!0);null!=a.widgetPop&&a.removePopup(a.widgetPop);a.map.events.unregister("zoomend",a.map,d);b=!1;c=null;y.remove();y=null;t="";e=[];v=[];w=[]},isInit:function(){return b}}}function EconomicWidget(){function k(a){a!=w&&(null!=g.widgetPop&&g.removePopup(g.widgetPop),w=a,0<e[w].length?d():(a="gdp"==w?"\x26op\x3dGetGDP\x26param\x3d{year:'2016'}":"czsr"==w?"\x26op\x3dGetCZSR\x26param\x3d{year:'2016'}":"\x26op\x3dGetBQX\x26param\x3d{year:'2016'}",u&&u.abort(),u=$.ajax({type:"GET",url:f+a,dataType:"jsonp",success:function(a){if(a){var c=a.Result,d=a.Count;0<d&&b.children("div").text("("+c[0].year+"\u5e74)");var f=[],h=[];if("bqx"!=w){for(a=0;a<d;a++)"2"==c[a].level_?f.push(c[a]):h.push(c[a]);e[w]=[f,h];557114<g.map.getScale()?m(2):m(3)}else e[w]=c,m()}},error:function(a,c){console.log&&console.log(w+"\u6570\u636e\u8bf7\u6c42"+c)}})))}function d(a){557114<g.map.getScale()?3!=v&&a||m(2):2!=v&&a||m(3)}function m(c){if(a){a.removeAllFeatures();v=c;var d,f,g,h,k,l=[];if("gdp"==w)for(b.css({width:"185px",height:"85px",display:"block",background:"url('images/statics/jj_legend1.png')"}),k=e[w][v-2],g=0,h=k.length;g<h;g++)f=k[g],c=new Ol2.Feature.Vector(new Ol2.Geometry.Point(f.x,f.y)),d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),d.fillOpacity=1,d.cursor="pointer",d.externalGraphic="images/statics/bar.png",d.graphicWidth=20,d.graphicHeight=2==v?parseInt(f.sczz/100):parseInt(f.sczz/10),c.style=d,c.attributes=f,l.push(c);else if("czsr"==w){b.css({width:"167px",height:"83px",display:"block",background:"url('images/statics/jj_legend2.png')"});var m;k=e[w][v-2];g=0;for(h=k.length;g<h;g++)f=k[g],c=new Ol2.Feature.Vector(new Ol2.Geometry.Point(f.x,f.y)),d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),d.fillOpacity=1,d.cursor="pointer",d.externalGraphic="images/statics/boll.png",m=2==v?parseInt(Math.sqrt(8*f.dfsr)):parseInt(Math.sqrt(40*f.dfsr)),d.graphicWidth=d.graphicHeight=m,c.style=d,c.attributes=f,l.push(c)}else for(b.css({width:"145px",height:"85px",display:"block",background:"url('images/statics/jj_legend3.png')"}),k=e[w],g=0,h=k.length;g<h;g++)f=k[g],c=new Ol2.Feature.Vector(new Ol2.Geometry.Point(f.x,f.y)),d=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),d.fillOpacity=1,d.cursor="pointer",d.externalGraphic="images/statics/boll.png",d.graphicWidth=d.graphicHeight=40,d.label=f.name+"\u7b2c"+f.ord+"\u4f4d",d.labelYOffset=-25,d.fontColor="blue",d.fontWeight="bold",c.style=d,c.attributes=f,l.push(c);a.addFeatures(l)}}function h(){g.removePopup(g.widgetPop);g.unSelect()}function l(a){function c(a){sects=[];var e=0;hist=[];years=[];var f,g,h;g=0;for(f=a.Count;g<f;g++)h=parseFloat(a.Result[g][m]),0!=h&&h&&(hist.push(h),years.push(a.Result[g].year),e>hist[g]&&(e=hist[g]));if(0<a.items.length)for(g=0,f=a.items.length;g<f;g++)e=parseFloat(a.items[g][m]),0!=e&&e&&sects.push({name:a.items[g].name,y:e});$(".titlediv\x3ediv").click(function(a){a=$(this);"staticsTab1"==this.id?b():d();a.children().addClass("active");a.siblings().children().removeClass("active")});b()}function b(){$("#staticsDiv").highcharts({chart:{type:"column"},title:{text:""},legend:{enabled:!1},xAxis:{categories:years},yAxis:{min:0,title:{text:"\u4ebf\u5143"}},tooltip:{headerFormat:'\x3cspan style\x3d"font-size:10px"\x3e{point.key}\x3c/span\x3e\x3ctable\x3e',pointFormat:'\x3ctr\x3e\x3ctd style\x3d"color:{series.color};padding:0"\x3e{series.name}: \x3c/td\x3e\x3ctd style\x3d"padding:0"\x3e\x3cb\x3e{point.y:.1f}\u4ebf\u5143\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e',footerFormat:"\x3c/table\x3e",shared:!0,useHTML:!0},series:[{name:k,data:hist,size:"30%",dataLabels:{formatter:function(){return this.point.name},color:"yellow",distance:-15}}]})}function d(){$("#staticsDiv").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},legend:{align:"center"},title:{text:""},tooltip:{pointFormat:"{series.name}: \x3cb\x3e{point.percentage:.1f}%\x3c/b\x3e"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"\x3cb\x3e{point.y}\x3c/b\x3e"},showInLegend:!0}},series:[{type:"pie",name:"\u767e\u5206\u6bd4",data:sects,size:"100%",dataLabels:{formatter:function(){return this.point.name},color:"white",distance:-25}}]})}null!=g.widgetPop&&g.removePopup(g.widgetPop);if("bqx"==w)g.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style \x3d'position:relative;margin:0 5px;cursor:pointer;color:#3B9CFE;font-size:14px;'\x3e\x3cb\x3e"+a.attributes.name+"\x3c/b\x3e\x3c/div \x3e\x3cbr/\x3e\x3cdiv style\x3d'margin:0 6px;'\x3e\u56fd\u6c11\u751f\u4ea7\u603b\u503c(GDP):"+a.attributes.sczz+"\u4ebf\u5143\x3cbr/\x3e\u8d22\u653f\u6536\u5165\uff1a"+a.attributes.dfsr+"\u4ebf\u5143\x3c/div\x3e",null,!0,h),a.popup=g.widgetPop,g.addPopup(g.widgetPop);else{var e="",k,l,m;"gdp"==w?(l="\x26op\x3dGetHistoryGDP",k="\u56fd\u6c11\u751f\u4ea7\u603b\u503c(GDP)",m="sczz"):(l="\x26op\x3dGetHistoryCZSR",k="\u8d22\u653f\u6536\u5165",m="dfsr");2==v&&(e="\x3cdiv id \x3d 'staticsTab2'\x3e\x3cdiv class\x3d'stc_xqpic'\x3e\x3c/div\x3e\x3cdiv class\x3d'stc_title'\x3e\u53bf\u533a\u6bd4\u4f8b\u56fe\x3c/div\x3e\x3c/div\x3e");g.widgetPop=new Ol2.Popup.FramedCloud("chicken",a.geometry.getBounds().getCenterLonLat(),null,"\x3cdiv style\x3d'padding:0 5px;'\x3e\x3cdiv style \x3d 'position:relative;font-size: 14px; margin-bottom:10px;cursor:pointer;color:#3b9cfe;'\x3e\x3cb\x3e"+a.attributes.name+k+"\x3c/b\x3e \x3c/div\x3e\x3cdiv class\x3d'maindiv'\x3e\x3cdiv class\x3d'titlediv' \x3e\x3cdiv id \x3d 'staticsTab1'\x3e\x3cdiv class\x3d'stc_hispic active'\x3e\x3c/div\x3e\x3cdiv class\x3d'stc_title active'\x3e\u5386\u5e74\u5bf9\u6bd4\u56fe\x3c/div\x3e\x3c/div\x3e"+e+"\x3c/div\x3e\x3cdiv id \x3d 'staticsDiv'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",null,!0,h);a.popup=g.widgetPop;g.addPopup(g.widgetPop);$.ajax({url:f+l+"\x26param\x3d{pac:'"+a.attributes.pac+"',year:'2016'}",dataType:"jsonp",async:!1,success:function(a){c(a)},error:function(a,c){console.log&&console.log("\u7ecf\u6d4e\u6570\u636e\u8bf7\u6c42"+c)}})}}if(null!=EconomicWidget.unique)return EconomicWidget.unique;EconomicWidget.unique=this;var f=Service.RTServiceStatistics+"ctype\x3deconomic",g=null,a=null,c=!1,b,e={gdp:[],czsr:[],bqx:[]},v,w="",u=null;return{init:function(d,e,f){a=new Ol2.Layer.Vector("\u7ecf\u6d4e",{style:new Ol2.StyleMap({"default":{strokeColor:"red",strokeOpacity:.8,strokeWidth:2,fillColor:"red",fillOpacity:.8,pointRadius:4,pointerEvents:"visiblePainted",label:"${label}",fontColor:"blue",fontSize:"12px",fontFamily:"SimHei",fontWeight:"bold",labelOutlineColor:"white",labelOutlineWidth:1}}),renderers:d});g=f;g.addLayer(a,!0);a.events.on({featureselected:function(a){l(a.feature)}});b=$("\x3cdiv style\x3d'z-index:980;border:1px solid #696969;position:absolute;right:50px;bottom:50px;'\x3e\x3cdiv style\x3d'position: relative;font-size: 14px;color: #3C06E7;font-weight: bold;padding: 7px 1px;left: 50%;margin-left: 11px;'\x3e\x3c/div\x3e\x3c/div\x3e");$(g.map.div).after(b);c=!0},Show:function(a){a=null==a?"gdp":a.split("_")[1];c&&(k(a),g.map.events.register("zoomend",g.map,d))},Hide:function(){a.setVisibility(!1);null!=g.widgetPop&&g.removePopup(g.widgetPop);b.hide()},Dispose:function(){u&&(u.abort(),u=null);g.removeLayer(a,!0);null!=g.widgetPop&&g.removePopup(g.widgetPop);g.map.events.unregister("zoomend",g.map,d);a=null;c=!1;b.remove();e={gdp:[],czsr:[],bqx:[]};w=""},isInit:function(){return c}}}function ScenicWidget(){function k(){0<w.length?m():v=$.ajax({type:"GET",url:f+"/GetHotScenics?scale\x3d2000",datatype:"xml",success:function(a){d(a)},error:function(a,c){console.log&&console.log("\u65c5\u6e38\u6570\u636e\u8bf7\u6c42"+c)}})}function d(a){if(a){var c,b=a.documentElement.textContent||a.documentElement.text,b=eval(b),d=[],e=[],f=[];a=0;for(c=b.length;a<c;a++)"100000"==b[a].scale?d.push(b[a]):"414059"==b[a].scale?e.push(b[a]):f.push(b[a]);w=[d,e,f];m()}}function m(){if(b){var d,e,f=[],g=[];1E5>=a.map.getScale()?(f=w[0].concat(w[1]).concat(w[2]),c=3):414059>=a.map.getScale()?(f=w[1].concat(w[2]),c=2):9999999>=a.map.getScale()&&(f=w[2],c=1);d=0;for(e=f.length;d<e;d++){var h=new Ol2.Feature.Vector(new Ol2.Geometry.Point(f[d].x,f[d].y)),k=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);k.externalGraphic="http://www.sdmap.gov.cn:8081/pics/thumbnail/"+f[d].id+".jpg";k.graphicWidth=80;k.graphicHeight=53;k.fillOpacity=1;k.cursor="pointer";h.style=k;h.attributes=f[d];g.push(h)}b.removeAllFeatures();b.addFeatures(g)}}function h(c){null!=a.widgetPop&&(a.removePopup(a.widgetPop),b=$("#ssss_conn"));"string"==typeof g&&(g=$(g));var b=g;v=$.ajax({url:f+"/GetScenicInfo?scenicId\x3d"+c.attributes.id,datatype:"xml",async:!1});var d=v.responseText,d=d.substring(76,d.length-9),d=eval("("+d+")"),e,h=[],k;k=!1;var l;b.find("#s_title_cont").text(d.nameCn);var m=d.pictures;for(e=0;e<m.length;e++)"\u56fe\u7247"==m[e].phoFormat?(h.push("\x3cli\x3e\x3cimg width\x3d'32'height\x3d'32'src\x3d'http://www.sdmap.gov.cn:8081/pics"+m[e].phoPath+"'/\x3e\x3c/li\x3e"),k||(b.find("#s_reppic img").attr("src","http://www.sdmap.gov.cn:8081/pics"+m[e].phoPath),k=!0)):"\u89c6\u9891"==m[e].phoFormat&&(l=e);b.find("#s_gallery .imglist").empty().append(h.join(""));k=d.scenicLevel.length-1;e=0;for(h=[];e<k;e++)h.push("\x3cimg src\x3d'images/scenic/bookmark.png'/\x3e");b.find("#s_jian_tj").empty().append(h.join(""));b.find("#s_jian_jb").attr("title",d.scenicLevel).text(d.scenicLevel);b.find("#s_jian_lx").attr("title",d.scenicTypes).text(d.scenicTypes);b.find("#s_jian_mp").text(d.scenicPrices[0].priceType+d.scenicPrices[0].price);k=d.contacts;e=0;for(h=[];e<k.length;e++)h.push(k[e].BusType+k[e].contactType+":"+k[e].contact);k=h.join(",");b.find("#s_jian_lianx").attr("title",k).text(k);""!=d.comWebsite&&b.find("#s_jian_url").attr("href",d.comWebsite);b.find("#s_jian_addr").text(d.address);k=d.bestSeasons;b.find("#s_jian_bst").text("");null!=l&&b.find("#s_video embed").attr("flashvars","vcastr_file\x3dhttp://www.sdmap.gov.cn:8081/pics"+m[l].phoPath+"\x26IsAutoPlay\x3d0");b.find("#s_xq_cont").text(d.attdesM);b.find("#s_jt_zx").text(d.trafficInf);b.find("#s_jt_ly").text(d.busInf);b.find("#s_jt_zj").text(d.selfDrInf);b.find("#s_jt_tc").text(d.suppSerFac);"1"==d.ifGasstation&&b.find("#s_jt_jy").text(d.gasStationName+"\u8ddd\u79bb"+d.nameCn+"\u7ea6"+d.disGasStation+"\u516c\u91cc");b.find("#s_fw_xm").text("\u65e0\u4fe1\u606f");b.find("#s_fw_jj").text(d.exposterPrice);b.find("#s_fw_pt").text(d.suppSerFac);b.find("#s_fw_hd").text("\u65e0\u4fe1\u606f");b.find("#s_fw_rq").text(d.adaptGroups);b.find("#s_fw_kk").text(d.viewdegree);b.find("#s_fw_cj").text(d.incitement);l=new Ol2.Size(486,285);a.widgetPop=new Ol2.Popup.FramedCloud("chicken",c.geometry.getBounds().getCenterLonLat(),l,b.html(),null,!1);c.popup=a.widgetPop;a.addPopup(a.widgetPop);$("#close_popup").click(function(){a.removePopup(a.widgetPop);a.unSelect()});$("#s_gallery").xslider({unitdisplayed:4,movelength:1,unitlen:33});$("#s_title :button").click(function(a){a=$(this);var c=a.index();a.css("color","blue").siblings().css("color","black");$("#s_content\x3ediv:eq("+c+")").css("display","block").siblings().css("display","none")});$("#s_gallery .imglist_w li").click(function(){var a=$(this);a.css("border","solid 2px blueviolet").siblings().css("border","solid 1px #ddd");a=a.children().attr("src");$("#s_reppic img").attr("src",a)})}function l(){var b=!1;1E5>a.map.getScale()?3!=c&&(b=!0):414059>a.map.getScale()?2!=c&&(b=!0):9999999>=a.map.getScale()&&1!=c&&(b=!0);b&&m()}if(null!=ScenicWidget.unique)return ScenicWidget.unique;ScenicWidget.unique=this;var f=Service.Proxy+"http://www.sdmap.gov.cn:8081/sdmapServices/ScenicWebService.asmx",g="\x3cdiv id\x3d'ssss_conn'\x3e\x3cdiv id\x3d's_title' style\x3d'width: 460px;height: 25px;'\x3e\x3cspan id\x3d's_title_cont' style\x3d'color: #ff9800;font-size: 14px;font-weight: bold;padding-left:10px;'\x3e\x3c/span\x3e\x3cdiv style\x3d'position:absolute;right:20px;top:0'\x3e\x3cinput type\x3d'button' style\x3d'color:blue;' value\x3d'\u666f\u533a\u7b80\u4ecb' /\x3e\x3cinput type\x3d'button' value\x3d'\u666f\u533a\u8be6\u60c5' /\x3e\x3cinput type\x3d'button' value\x3d'\u4ea4\u901a\u6307\u5357' /\x3e\x3cinput type\x3d'button' value\x3d'\u670d\u52a1\u6307\u5357' /\x3e\x3c/div\x3e\x3cimg id\x3d'close_popup' src\x3d'images/close.gif' style\x3d'position:absolute;top:2px;right:0'/\x3e\x3c/div\x3e\x3cdiv id\x3d's_content' style\x3d'width: 460px;padding-top: 5px; height:245px;background-color: white'\x3e\x3cdiv id\x3d's_jianjie' style\x3d'display: block'\x3e\x3cdiv style\x3d'float: left;width: 210px'\x3e\x3cdiv id\x3d's_reppic'\x3e\x3cimg src\x3d'' width\x3d'208' height\x3d'208' /\x3e\x3c/div\x3e\x3cdiv class\x3d'scrolllist' id\x3d's_gallery'\x3e\x3ca class\x3d'abtn aleft' href\x3d'#left' title\x3d'\u5de6\u79fb'\x3e\x3c/a\x3e\x3cdiv class\x3d'imglist_w'\x3e\x3cul class\x3d'imglist'\x3e\x3c/ul\x3e\x3c/div\x3e\x3ca class\x3d'abtn aright' href\x3d'#right' title\x3d'\u53f3\u79fb'\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'jianjie' style\x3d'float: left;margin-left: 10px;width: 230px;overflow:hidden;white-space: nowrap'\x3e\u63a8\u8350\u5ea6\uff1a\x3cspan id\x3d's_jian_tj'\x3e\x3c/span\x3e\x3cbr /\x3e\u666f\u70b9\u7ea7\u522b\uff1a\x3cspan id\x3d's_jian_jb'\x3e\x3c/span\x3e\x3cbr /\x3e\u666f\u533a\u7c7b\u578b:\x3cspan id\x3d's_jian_lx'\x3e\x3c/span\x3e\x3cbr /\x3e\u95e8\u7968\u4fe1\u606f\uff1a\x3cspan id\x3d's_jian_mp'\x3e\x3c/span\x3e\x3cbr /\x3e \u8054\u7cfb\u65b9\u5f0f\uff1a\x3cspan id\x3d's_jian_lianx'\x3e\x3c/span\x3e\x3cbr /\x3e\u666f\u533a\u7f51\u5740\uff1a\x3cspan\x3e\x3ca id\x3d's_jian_url' href\x3d'' target\x3d'_blank'\x3e\u70b9\u51fb\u67e5\u770b\u8be6\u60c5\x3c/a\x3e\x3c/span\x3e\x3cbr /\x3e\u8be6\u7ec6\u5730\u5740\uff1a\x3cspan id\x3d's_jian_addr'\x3e\x3c/span\x3e\x3cbr /\x3e\u6700\u4f73\u6d4f\u89c8\u5b63\u8282\uff1a\x3cspan id\x3d's_jian_bst'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d's_xiangqing' style\x3d'display: none'\x3e\x3cdiv id\x3d's_video' style\x3d'width: 256px;height: 244px;float: left;'\x3e\x3cobject classid\x3d'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' codebase\x3d'http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version\x3d6,0,29,0' width\x3d'256' height\x3d'244'\x3e\x3cparam name\x3d'movie' value\x3d'third/vcastr22.swf'\x3e\x3c/param\x3e\x3cparam name\x3d'quality' value\x3d'high'\x3e\x3c/param\x3e\x3cparam name\x3d'allowFullScreen' value\x3d'false'\x3e\x3c/param\x3e\x3cembed src\x3d'third/vcastr22.swf' allowfullscreen\x3d'true' flashvars\x3d'vcastr_file\x3d' quality\x3d'high' pluginspage\x3d'http://www.macromedia.com/go/getflashplayer' type\x3d'application/x-shockwave-flash' width\x3d'256' height\x3d'244' /\x3e\x3c/object\x3e\x3c/div\x3e\x3cdiv id\x3d's_xq_cont' style\x3d'width:188px;float: left ;height: 230px;margin-left: 10px;padding: 0;line-height: 16px;'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d's_jiaotong' style\x3d'display: none;'\x3e\x3cdiv style\x3d'height: 47px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold; '\x3e\u4ea4\u901a\u54a8\u8be2\uff1a\x3c/div\x3e\x3cdiv id\x3d's_jt_zx' style\x3d'float: left;overflow-y: auto;padding: 4px 0; width: 370px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 47px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u65c5\u6e38\u4e13\u7ebf\uff1a\x3c/div\x3e\x3cdiv id\x3d's_jt_ly' style\x3d'float: left;overflow-y: auto;padding: 4px 0; width: 370px;height: 47px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 47px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u81ea\u9a7e\u6307\u5357\uff1a\x3c/div\x3e\x3cdiv id\x3d's_jt_zj' style\x3d'float: left;overflow-y: auto;padding: 4px 0;width: 370px;height: 47px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 27px;'\x3e\x3cdiv style\x3d'float: left;width:92px;font-size: 13px;font-weight: bold;'\x3e\u505c\u8f66\u573a\u4fe1\u606f\uff1a\x3c/div\x3e\x3cdiv id\x3d's_jt_tc' style\x3d'float: left;overflow-y: auto;padding: 4px 0;width: 358px;height: 47px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 27px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u52a0\u6cb9\u7ad9\uff1a\x3c/div\x3e\x3cdiv id\x3d's_jt_jy' style\x3d'float:left;overflow-y: auto;width: 350px'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d's_fuwu' style\x3d'display:none;line-height: 20px'\x3e\x3cdiv style\x3d'height: 36px;'\x3e\x3cdiv style\x3d'float: left;width:102px;font-size: 13px;font-weight: bold;'\x3e\u666f\u533a\u65c5\u6e38\u9879\u76ee\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_xm' style\x3d'float: left;overflow-y: auto; width: 345px;height: 36px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 36px;'\x3e\x3cdiv style\x3d'float: left;width:102px;font-size: 13px;font-weight: bold;'\x3e\u8bb2\u89e3\u5458\u4ef7\u683c\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_jj' style\x3d'float: left;overflow-y: auto;width: 350px;height:36px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 47px;'\x3e\x3cdiv style\x3d'float: left;width:102px;font-size: 13px;font-weight: bold;'\x3e\u914d\u5957\u670d\u52a1\u8bbe\u65bd\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_pt' style\x3d'float: left;overflow-y: auto;width: 345px;height: 47px'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 47px;'\x3e\x3cdiv style\x3d'float: left;width:102px;font-size: 13px;font-weight: bold;'\x3e\u5e38\u8bbe\u65c5\u6e38\u6d3b\u52a8\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_hd' style\x3d'float: left;overflow-y:uto;width: 350px;height: 47px;'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 27px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u9002\u5408\u4eba\u7fa4\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_rq' style\x3d'float: left;overflow-y: auto;width: 350px;height: 27px;'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 27px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u53ef\u770b\u5ea6\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_kk' style\x3d'float: left;overflow-y: auto;width: 350px;height: 27px;'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv style\x3d'height: 27px;'\x3e\x3cdiv style\x3d'float: left;width:82px;font-size: 13px;font-weight: bold;'\x3e\u523a\u6fc0\u5ea6\uff1a\x3c/div\x3e\x3cdiv id\x3d's_fw_cj' style\x3d'float: left;overflow-y: auto;width: 350px;height: 27px;'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",a=null,c,b=null,e=!1,v=null,w=[];return{init:function(c,d,f){b=new Ol2.Layer.Vector("\u666f\u70b9",{style:d,renderers:c});a=f;a.addLayer(b,!0);b.events.on({featureselected:function(a){h(a.feature)}});e=!0},Show:function(){e&&(k(),a.map.events.register("zoomend",a.map,l))},Hide:function(){b.setVisibility(!1);null!=a.widgetPop&&a.removePopup(a.widgetPop)},Dispose:function(){v&&(v.abort(),v=null);a.removeLayer(b,!0);null!=a.widgetPop&&a.removePopup(a.widgetPop);e=!1;a.map.events.unregister("zoomend",a.map,l);b=null;w=[]},isInit:function(){return e}}}var WidgetManger=function(){function k(f,a){d[f]&&(!d[f].isInit()&&d[f].init(h,m,l),a?d[f].Show(a):d[f].Show())}var d,m,h,l,f=!1;return{init:function(g){function a(){var a=$("#Rw_top_img"),b=$("#Top_label");$("#Rw_top_back").addClass("hide");a.addClass("hide");b.html("\u5171\u4eab\u4fe1\u606f")}f||(l=g,$("#rightWidgetDiv").append("\x3cdiv id\x3d'Rw_top_back'\x3e\x3cdiv id\x3d'Rw_top_img'\x3e\x3c/div\x3e\x3cspan id\x3d'Top_label'/\x3e\x3c/div\x3e\x3cul id\x3d'Rwidget_ul'\x3e    \x3cli id\x3d'weather' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u5929\u6c14\x3c/li\x3e    \x3cli id\x3d'road' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u8def\u51b5        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 65px;top:50px;'\x3e            \x3cli id\x3d'r_rtroad' class \x3d 'rightBtnList selitem'\x3e\u5b9e\u65f6\u8def\u51b5\x3c/li\x3e            \x3cli id\x3d'r_rtroadjt' class \x3d 'rightBtnList'\x3e\u9053\u8def\u4ea4\u901a\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id\x3d'enviroment' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u73af\u5883        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 65px;top:84px;'\x3e            \x3cli id\x3d'e_station' class \x3d 'rightBtnList selitem'\x3e\u7a7a\u6c14\u8d28\u91cf\x3c/li\x3e            \x3cli id\x3d'e_city' class \x3d 'rightBtnList'\x3e\u5730\u5e02\u7edf\u8ba1\x3c/li\x3e            \x3cli id\x3d'e_contrast' class \x3d 'rightBtnList'\x3e\u5730\u5e02\u5bf9\u6bd4\x3c/li\x3e        \x3c/ul\x3e\x3c/li\x3e    \x3cli id\x3d'waterq' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u6c34\u8d28\x3c/li\x3e    \x3cli id\x3d'waterc' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u6c34\u60c5        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 65px;top:150px;'\x3e            \x3cli id\x3d'r_river' class \x3d 'rightBtnList selitem'\x3e\u6cb3\u9053\u7ad9\x3c/li\x3e            \x3cli id\x3d'r_reservoir' class \x3d 'rightBtnList'\x3e\u6c34\u5e93\u7ad9\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id\x3d'rain' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u96e8\u60c5        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 65px;top:183px;'\x3e            \x3cli id\x3d'r_day' class \x3d 'rightBtnList selitem'\x3e\u8fd124h\u96e8\u91cf\x3c/li\x3e            \x3cli id\x3d'r_month' class \x3d 'rightBtnList'\x3e\u8fd1\u6708\u96e8\u91cf\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id \x3d 'scenic' class \x3d 'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u666f\u70b9\x3c/li\x3e    \x3cli id\x3d'video' class\x3d'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u89c6\u9891\x3c/li\x3e    \x3cli id\x3d'population' class\x3d'rightBtn' \x3e\x3cdiv\x3e\x3c/div\x3e\u4eba\u53e3        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 86px;top:282px;'\x3e            \x3cli id\x3d'popu_rkzs' class \x3d 'rightBtnList selitem'\x3e\u4eba\u53e3\u6570\u91cf\x3c/li\x3e            \x3cli id\x3d'popu_rkmd' class \x3d 'rightBtnList'\x3e\u4eba\u53e3\u5bc6\u5ea6\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id \x3d 'economy' class \x3d 'rightBtn' \x3e\x3cdiv\x3e\x3c/div\x3e\u7ecf\u6d4e        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 100px;top:320px;'\x3e            \x3cli id \x3d 'eco_gdp' class \x3d 'rightBtnList selitem'\x3eGDP\x3c/li\x3e            \x3cli id \x3d 'eco_czsr' class \x3d 'rightBtnList'\x3e\u8d22\u653f\u6536\u5165\x3c/li\x3e            \x3cli id \x3d 'eco_bqx' class \x3d 'rightBtnList'\x3e\u5168\u56fd\u767e\u5f3a\u53bf\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id \x3d 'picture' class \x3d 'rightBtn' \x3e\x3cdiv\x3e\x3c/div\x3e\u7167\u7247        \x3cul class \x3d 'rightBtnUl' style\x3d' width: 100px;top:348px;'\x3e            \x3cli id \x3d 'pic_pub' class \x3d 'rightBtnList selitem'\x3e\x3cinput style\x3d'height: 17px;vertical-align:middle;width:20px;' type\x3d'checkbox' checked\x3d'checked'/\x3e\u805a\u7c7b\u663e\u793a\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e    \x3cli id \x3d 'pollution' class \x3d 'rightBtn'\x3e\x3cdiv\x3e\x3c/div\x3e\u6c61\u67d3        \x3cul class \x3d 'rightBtnUl' style\x3d'width: 100px;top:381px;'\x3e            \x3cli id \x3d 'poll_water' class \x3d 'rightBtnList selitem'\x3e\u5e9f\u6c34\x3c/li\x3e            \x3cli id \x3d 'poll_air' class \x3d 'rightBtnList'\x3e\u5e9f\u6c14\x3c/li\x3e            \x3cli id \x3d 'poll_fac' class \x3d 'rightBtnList'\x3e\u6c61\u6c34\u5382\x3c/li\x3e        \x3c/ul\x3e    \x3c/li\x3e\x3c/ul\x3e"),$("#rightWidgetDiv .rightBtn").click(function(){var a=$(this),b=a.children("div");a.hasClass("active")?(b.removeClass("active"),a.removeClass("active"),a.children("ul").css({display:"none"}),a.find("li").removeClass("selitem"),a=a.attr("id"),d[a]&&d[a].Dispose()):(b.addClass("active"),a.addClass("active"),a.children("ul").css({display:"block"}),k(a.attr("id")),a.find("li:eq(0)").addClass("selitem"))}),$("#Rw_top_back").click(function(c){c=$("#Rw_top_img");var b=$("#Rwidget_ul"),d=$(this),f=$("#Top_label");c.hasClass("hide")?(d.removeClass("hide"),b.show(500),c.removeClass("hide"),f.html("")):b.hide(500,a)}),$("#rightWidgetDiv .rightBtnList").click(function(a){var b=$(this),d,f;d=b.parents(".rightBtn").attr("id");"LI"==a.target.tagName?(f=b.attr("id"),0<b.children(":checkbox").length?b.children(":checkbox")[0].checked?b.children(":checkbox")[0].checked=!1:b.children(":checkbox")[0].checked=!0:"e_city"==b.attr("id")||"e_contrast"==b.attr("id")?b.removeClass("selitem").siblings("li:eq(0)").addClass("selitem"):b.addClass("selitem").siblings().removeClass("selitem"),k(d,f)):"INPUT"==a.target.tagName&&(f=b.attr("id"),k(d,f));a.stopImmediatePropagation()}),$(".rightBtn").mouseenter(function(a){a=$(this);a.hasClass("active")&&a.children("ul").css("display","block")}),$(".rightBtn").mouseleave(function(a){$(this).children("ul").css("display","none")}),d={weather:new WeatherWidget,road:new RoadWiget,enviroment:new EnvironmentWidget,waterq:new WaterQuanlityWidget,waterc:new WaterConditionWidget,scenic:new ScenicWidget,rain:new RainWidget,video:new VideoWidget,population:new PopulationWidget,economy:new EconomicWidget,picture:new ImgCluster,pollution:new PollutionWidget},m=new Ol2.StyleMap({fillOpacity:1,pointRadius:3}),h=Ol2.Util.getParameters(window.location.href).renderer,f=!0)},reset:function(){for(var f in d)d[f]&&d[f].isInit()&&d[f].Dispose();$("#rightWidgetDiv .rightBtn.active").each(function(a,c){$(c).removeClass("active").children().removeClass("active")})}}}(),MapContrast=function(){function k(a){q||(r=a,$(window).resize(function(){p&&d()}),q=!0)}function d(){var a=($("#mapDiv").width()-2)/(2*$("#mapDiv").width())*100+"%";$("#mapDiv").css("width",a);$("#mapDiv1").css("width",a);$("#Lc").css("left",$("#mapDiv").width()-84);$("#mapDiv1").css("height","100%");$("#mapDiv1").css("display","block");$("#Lc").css("display","block");$("#Ic").css("display","block");r.map.updateSize();null!=z&&z.map.updateSize()}function m(){J=[new Ol2.Control.DrawFeature(B,Ol2.Handler.RegularPolygon,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:G},sides:4,irregular:!0},featureAdded:h}),new Ol2.Control.DrawFeature(B,Ol2.Handler.RegularPolygon,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:G},sides:50,irregular:!0},featureAdded:h}),new Ol2.Control.DrawFeature(B,Ol2.Handler.Polygon,{handlerOptions:{layerOptions:{renderers:void 0,styleMap:G}},featureAdded:h})];r.map.addControls(J);$(".C_d_mark_li").on("click",function(){J[A].deactivate();A=$(this).index();J[A].activate()})}function h(a){D.pointRadius=24;D.fillColor="#0000ff";D.fillOpacity=.1;D.strokeWidth=2;D.strokeColor="#0000ff";a.style=Ol2.Util.extend({},D);B.drawFeature(a);J[A].deactivate();var b=new Ol2.Feature.Vector;b.geometry=a.geometry.clone();D.fillColor="#FC1C02";D.strokeColor="#FC1C02";b.style=Ol2.Util.extend({},D);F.addFeatures(b)}function l(){"d"==$(this)[0].id?(H=null,$("#d").find("li").removeClass("active"),0==C?($("#d li:eq(1)").addClass("active"),t(r,"img",!0),C=1):($("#d li:eq(0)").addClass("active"),t(r,"vec",!1),C=0),b(0,C)):(I=null,$("#d1").find("li").removeClass("active"),0==n?($("#d1 li:eq(1)").addClass("active"),t(z,"img",!0),n=1):($("#d1 li:eq(0)").addClass("active"),t(z,"vec",!1),n=0),b(1,n))}function f(a){p&&null!=z&&("mapDiv"==$(this)[0].div.id?z.map.setCenter(r.map.getCenter(),r.map.getZoom(),!0,!0):r.map.setCenter(z.map.getCenter(),z.map.getZoom(),!0,!0),e());B.redraw();F.redraw()}function g(a){var b=$("#mapDiv").width()+2;"mapDiv"==$(this)[0].div.id?document.getElementById("Ic").style.left=a.clientX+b-$("#mapDiv").offset().left+"px":document.getElementById("Ic").style.left=a.clientX-b-$("#mapDiv").offset().left+"px";document.getElementById("Ic").style.top=a.clientY+"px"}function a(){r.imgLayer&&(r.removeLayer(r.imgLayer),r.imgLayer=null);B&&B.removeAllFeatures();F&&F.removeAllFeatures()}function c(){$("#Rwidget_ul li").each(function(){$(this).hasClass("active")&&$(this).click()})}function b(a,b){var c=0==a?$("#d_radio"):$("#d1_radio");1==b?e():c.hide(400)}function e(){var a=r.map.getCenter();$.ajax({url:Service.IMGMETA+"wktpoint\x3d"+("POINT("+a.lon+" "+a.lat+")")+"\x26level\x3d"+r.map.zoom,success:v,dataType:"jsonp"})}function v(a){E=[];if(a&&0<a.length)for(histData=a,histData.sort(w),i=0;i<histData.length;i++)obj=histData[i],a={},a.str=obj.st.toString(),a.grp=obj.lid,E.push(a);1==C&&u(0);1==n&&u(1)}function w(a,b){if(a.lid.toString()>b.lid.toString())return-1;if(a.lid.toString()<b.lid.toString())return 1;if(a.lid.toString()==b.lid.toString())return 0}function u(a){var b=0==a?$("#d_radio"):$("#d1_radio");if(0<E.length){var c=0==a?$("#d_ul"):$("#d1_ul"),d=0==a?H:I;c.find("li").remove();b.css("height",25*E.length);b.show(400);for(b=0;b<E.length;b++){var e=$("\x3cdiv class\x3d'div_list' \x3e\x3c/div\x3e"),f=$("\x3cli class\x3d'contrast_li'\x3e\x3c/li\x3e");f.attr("value",E[b].grp);f.attr("type",a);f.append(e);f.append(E[b].str);f.bind("click",y);c.append(f);0!=b||d?E[b].grp==d&&(e.addClass("active"),f.addClass("active")):(e.addClass("active"),f.addClass("active"))}}else b.hide(400)}function y(){var a,b=$(this).attr("value");"0"==$(this).attr("type")?(a=r,H=b,$("#d_ul").children("li").children("div").removeClass("active"),$("#d_ul").children("li").removeClass("active")):(a=z,I=b,$("#d1_ul").children("li").children("div").removeClass("active"),$("#d1_ul").children("li").removeClass("active"));$(this).children("div").addClass("active");$(this).addClass("active");t(a,b,!0)}function t(a,b,c){a.imgLayer&&(a.removeLayer(a.imgLayer),a.imgLayer=null);if("vec"==b)a.tileLayerManager.switchMap("vec",!0);else if("img"==b)a.tileLayerManager.switchMap("img",!0);else{a.tileLayerManager.setVisibility("vec",!1);a.tileLayerManager.setVisibility("img",!1);for(var d in histData)if(histData[d].lid==b){histData[d].format="image/png";histData[d].layer="c";histData[d].matrixSet="c";histData[d].style="c";a.imgLayer=new Ol2.Layer.WMTS(histData[d]);a.addLayer(a.imgLayer);a.map.setLayerIndex(a.imgLayer,1);break}}}var q=!1,p=!1,r,z,F,B,C=0,n=0,E=[],H,I,A=0,J,D=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]),G=new Ol2.StyleMap({"default":{pointRadius:24,fillOpacity:.2,graphicWidth:24,graphicHeight:24,graphicYOffset:-22,externalGraphic:"images/mark2/point7.png",graphicZIndex:100,fillColor:"blue",strokeWidth:1,strokeOpacity:1,strokeColor:"red",fontColor:"blue",cursor:"pointer"}});return{init:k,mapDivHandler:d,IsStartContrast:function(){return p},startContrast:function(b){q||k(b);p?(z.map.events.unregister("moveend",z.map,f),r.map.events.unregister("moveend",r.map,f),z.map.events.unregister("mousemove",z.map,g),r.map.events.unregister("mousemove",r.map,g),$(".c_list_ul").unbind("click"),$(".C_d_mark_li_clear").unbind("click"),p=!1,$("#vec_").click(),$("#mapDiv").css("width","100%"),$("#mapDiv1").css("display","none"),$("#Lc").css("display","none"),$("#rightWidgetDiv").css("display","block"),$("#Ic").css("display","none"),$("#left_hidden").hasClass("show")&&$("#left_hidden").click(),$("#vec_img").css("display","block"),$("#dict").css("display","block"),$(".C_d_mark").css("display","none"),$("#btnImgCompare").html("\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -98px 0;'\x3e\x3c/span\x3e\u5bf9\u6bd4\x3c/span\x3e"),$("#btnImgCompare").css("width","60px"),a(),r.map.updateSize(),ImgMetaCtl&&ImgMetaCtl.setActive(!0)):(isImg=!1,c(),$("#vec_").click(),$("#stImgmetaInfo").css("display","none"),$("#left_hidden").hasClass("show")||$("#left_hidden").click(),$("#rightWidgetDiv").css("display","none"),$("#dict").css("display","none"),$("#btnImgCompare").html("\x3cspan class\x3d'btnToolbar-cont'\x3e\x3cspan class\x3d'btnToolbar-img' style\x3d'background-position: -96px 0;'\x3e\x3c/span\x3e\u9000\u51fa\u5bf9\u6bd4\x3c/span\x3e"),$("#btnImgCompare").css("width","86px"),$("#vec_img").css("display","none"),$(".C_d_mark").css("display","block"),p=!0,d(),z||(z=new SDMap("mapDiv1",{zoombar:0,keyboard:!0,layerSwitch:0,poiIdenty:!1,scaleLine:!1})),F||(new Ol2.StyleMap({"default":{fillColor:"#ee9900",pointRadius:6}}),F=new Ol2.Layer.Vector("markers",{style:null}),z.map.addLayer(F,!0)),B||(B=new Ol2.Layer.Vector("mark_contrast",{style:null}),r.map.addLayer(B,!0),m()),z.map.setCenter(r.map.getCenter(),r.map.getZoom()),z.map.events.register("moveend",z.map,f),r.map.events.register("moveend",r.map,f),z.map.events.register("mousemove",z.map,g),r.map.events.register("mousemove",r.map,g),$(".c_list_ul").bind("click",l),$(".C_d_mark_li_clear").bind("click",a),$("#d li:eq(1)").removeClass("active"),$("#d li:eq(0)").addClass("active"),$("#d_radio").css("display","none"),n=C=0,$("#d1").click(),ImgMetaCtl&&ImgMetaCtl.setActive(!1))}}}(),popup1,Bzj=!0,TileLayerManager=function(){function k(){for(var f=l.zoom,g=0;g<d.length;g++)d[g].open&&(d[g].maxlevel>=f&&d[g].minlevel<=f?d[g].layer.setVisibility(!0):d[g].layer.setVisibility(!1))}var d=[],m=[],h=1,l=null;return{setConfig:function(f,g){l=f;for(var a=0;a<g.length;a++){g[a].open||(g[a].visibility=!1);var c=new Ol2.Layer.WMTS(g[a]);d.push({layer:c,layerid:g[a].layer,group:g[a].group,open:g[a].open,minlevel:g[a].minlevel||0,maxlevel:g[a].maxlevel||20});l.addLayer(c)}f.Lary=d;l.events.register("zoomend",this,k)},switchMap:function(f,g){var a;if(null==f)for(a=0;a<d.length;a++)d[a].group==h+"_n"&&(d[a].layer.setVisibility(!!g),d[a].open=!!g);else{for(a=0;a<d.length;a++)g&&d[a].group==f+"_n"||d[a].group==f?(d[a].open=!0,d[a].minlevel<=l.zoom&&d[a].maxlevel>=l.zoom&&d[a].layer.setVisibility(!0)):(d[a].open=!1,d[a].layer.setVisibility(!1));h=f}for(a=0;a<m.length;a++)m[a](h)},setVisibility:function(f,g){for(i=0;i<d.length;i++)d[i].group==f&&(d[i].layer.setVisibility(!!g),d[i].open=!!g)},addListener:function(d){"function"==typeof d&&m.push(d)},removeListener:function(d){"function"==typeof d&&(d=m.find(function(d){return d===this}),m.splice(d,1))},getLayer:function(f){var g;if(f.group){var a=[];for(g=0;g<d.length;g++)d[g].group==f.group&&a.push(d[g].layer);return a}if(f.layer)for(g=0;g<d.length;g++)if(d[g].layerid==f.layer)return d[g].layer},getLayers:function(){return d}}},SDMap=function(k,d){function m(){$(f.div).append("\x3cdiv id\x3d'refrenceDiv'\x3e\x3c/div\x3e");d.layerSwitch2&&f.addControl(new Ol2.Control.LayerSwitcher);d.scaleLine&&f.addControl(new Ol2.Control.ScaleLine({maxWidth:200,topOutUnits:"\u5343\u7c73",topInUnits:"\u7c73",bottomOutUnits:"",bottomInUnits:""}));1==d.zoombar?f.addControl(new Ol2.Control.PanZoomBar):2==d.zoombar&&f.addControl(new Ol2.Control.Zoom);d.keyboard&&f.addControl(new Ol2.Control.KeyboardDefaults);c=new Ol2.Control.SelectFeature([g]);c.handlers.feature.stopDown=!1;c.handlers.feature.stopUp=!1;f.addControl(c);c.activate();var a=new Ol2.Control.Navigation({dragPanOptions:{enableKinetic:!0,documentDrag:!1,kineticInterval:10},zoomWheelEnabled:!0,handleRightClicks:!1});f.addControl(a);d.mousePosition&&l();d.authMark&&$("#refrenceDiv").before("\x3cdiv id \x3d'bottomBar'\x3e\x3c/div\x3e\x3cdiv id \x3d'remark'\x3e\u5ba1\u56fe\u53f7:GS(2017)508\u53f7(\u7248\u6743:\u56fd\u5bb6\u6d4b\u7ed8\u5730\u7406\u4fe1\u606f\u5c40) \u9c81SG(2017)040\u53f7(\u7248\u6743:\u5c71\u4e1c\u7701\u56fd\u571f\u8d44\u6e90\u5385)\x3c/div\x3e");1==d.layerSwitch?($(f.div).append($("\x3cstyle\x3e #layerSwitch:hover{border: 1px solid #2D9FBB;}\x3c/style\x3e\x3cdiv id\x3d'layerSwitch'style\x3d'position: absolute;top:3px;width: 50px;height: 50px;right:3px;z-index: 1001;border:1px solid #DEE1E2;font-size:12px;background:url(images/map/img1.png)'\x3e\x3c/div\x3e")),$("#layerSwitch").click(function(){var a=$(this);a.css("background-image").match(/(img1.png)/)?(b.switchMap(2,!0),a.css("background-image","url(images/map/vec1.png)"),h("white")):(b.switchMap(1),a.css("background-image","url(images/map/img1.png)"),h("black"))})):2==d.layerSwitch&&($(f.div).append($("\x3cdiv id\x3d'layerSwitch'style\x3d'position: absolute;bottom:10px;right: 20px;z-index: 1001;font-size:12px'\x3e\x3cdiv class\x3d'operbtn mapswitchbtn'\x3e\u77e2\u91cf\x3c/div\x3e\x3cdiv class\x3d'operbtn mapswitchbtn' style\x3d'background-color:#b2b2b2'\x3e\u5f71\u50cf\x3c/div\x3e\x3c/div\x3e")),$("#layerSwitch .mapswitchbtn").click(function(){var a=$(this);"\u77e2\u91cf"==a.text()?(b.switchMap(1),h("black")):(b.switchMap(2,!0),h("white"));a.removeAttr("style").siblings().css("background-color","#b2b2b2")}))}function h(a){$("#img_year_div").show();$(".olControlScaleLineTop").css({border:"solid 2px "+a,"border-top":"none",color:a});$(".olControlScaleLineBottom").css({border:"solid 2px "+a,"border-bottom":"none",color:a})}function l(){$("#refrenceDiv").before("\x3cdiv id \x3d 'mousePositon'\x3e\x3c/div\x3e");$(".olMapViewport").mousemove(function(a){var b=$(this).offset();a=new Ol2.Pixel(a.clientX-b.left,a.clientY-b.top);a=f.getLonLatFromPixel(a);$("#mousePositon").text("\u7ecf\u5ea6:"+a.lon.toFixed(3)+", \u7eac\u5ea6:"+a.lat.toFixed(3))})}var f=null,g=null,a,c,b=new TileLayerManager;d||(d={});Ol2.Util.applyDefaults(d,{scaleLine:!0,zoombar:1,keyboard:!0,mousePosition:!0,poiIdenty:!1,authMark:!0,layerSwitch:1,layerSwitch2:!1});Ol2.INCHES_PER_UNIT["\u5343\u7c73"]=Ol2.INCHES_PER_UNIT.km;Ol2.INCHES_PER_UNIT["\u7c73"]=Ol2.INCHES_PER_UNIT.m;Ol2.INCHES_PER_UNIT["\u82f1\u91cc"]=Ol2.INCHES_PER_UNIT.mi;Ol2.INCHES_PER_UNIT["\u82f1\u5c3a"]=Ol2.INCHES_PER_UNIT.ft;(function(c){Ol2.DOTS_PER_INCH=96;f=new Ol2.Map(c,{allOverlays:!0,numZoomLevels:19,displayProjection:"EPSG:4490",controls:[new Ol2.Control.ArgParser,new Ol2.Control.Attribution]});b.setConfig(f,Service.basemap);d.poiIdenty&&(f.poiMrk=new Ol2.Ex.PoiMarker(f,b.getLayer({layer:"sdvec"}),Service.POITILE));c=new Ol2.StyleMap({fillOpacity:1,pointRadius:2});g=new Ol2.Layer.Vector("SelectableLayer",{styleMap:c,rendererOptions:{zIndexing:!1}});f.addLayer(g);a=new Ol2.Layer.Vector("GraphicsLayer",{styleMap:c,rendererOptions:{zIndexing:!1}});f.addLayer(a);m();f.setCenter(new Ol2.LonLat(119,36.4),7)})(k);return{map:f,tileLayerManager:b,markLayer:g,graLayer:a,unSelect:function(){c.unselectAll()},addLayer:function(a,b){f.addLayer(a);b&&c.setLayer(c.layers.concat([a]))},removeLayer:function(a,b){f.removeLayer(a);if(b)for(var d=0;d<c.layers.length;d++)if(c.layers[d].id==a.id){var g=c.layers;g.splice(d,1);c.setLayer(g);break}},getSelectCtrl:function(){return c},addPopup:function(a){a&&f.addPopup(a)},removePopup:function(a){if(a)f.removePopup(a);else{a=f.popups;for(var b in a)f.removePopup(a[b])}}}};window.Util||(window.Util={});window.Util.HighlightGeo||(window.Util.HighlightGeo=function(k,d){function m(){if(1==a||3==a)h.fillColor="#0f0",h.strokeColor="#0f0",k.redraw(),a+=1;else if(2==a||4==a)h.fillColor="#f00",h.strokeColor="#f00",k.redraw(),a+=1;else{clearTimeout(g);for(var c=0;c<l.length;c++)l[c].style=null;k.redraw()}}if(k&&d){var h=Ol2.Util.applyDefaults({fillColor:"#f00",fillOpacity:.6,strokColor:"#f00",strokeWidth:4,pointRadius:4},Ol2.Feature.Vector.style["default"]);Ol2.Util.isArray(d)||(d=[d]);for(var l=[],f=0;f<d.length;f++)d[f].geometry?l.push(new Ol2.Feature.Vector(d[f].geometry,null,h)):l.push(new Ol2.Feature.Vector(d[f],null,h));var g=setInterval(m,500),f=(d[0].geometry||d[0]).CLASS_NAME;f.match(/Point/)?(h.strokeWidth=2,h.pointRadius=8,h.fillOpacity=1):f.match(/LineString/)&&(h.strokeWidth=6,h.fillOpacity=1);k.addFeatures(l);var a=1}});var DPR_LNG=6378140*Math.PI/180,DPR_C=.80385;function interopGeoSeg(k,d){var m=[],h=0;d/=DPR_LNG;m.push(k[0]);for(var l=0;l<k.length-1;l++){var f=k[l].x-k[l+1].x,g=k[l].y-k[l+1].y,a=f*DPR_C,c=Math.sqrt(a*a+g*g);0!=h&&(c+=h,h=0);a=c/d;a=Math.round(a);if(0==a)h+=c;else{for(var b,e=1;e<a;e++)c=k[l].x-f/a*e,b=k[l].y-g/a*e,m.push(new Ol2.Geometry.Point(c,b));m.push(k[l+1])}}return m}function interopGeoSeg2(k,d){var m=[],h=0;d/=DPR_LNG;for(var l=0;l<k.length-1;l++){var f=k[l].x-k[l+1].x,g=k[l].y-k[l+1].y,a=f*DPR_C,c=Math.sqrt(a*a+g*g);0!=h&&(c+=h,h=0);a=c/d;a=Math.round(a);if(0==a)h+=c;else{for(var b,e=[],v=1;v<a;v++)c=k[l].x-f/a*v,b=k[l].y-g/a*v,e.push(new Ol2.Geometry.Point(c,b));e.push(k[l+1]);m.push({idx:l,seg:e})}}return m}function DrawFlowPath(k,d,m){var h=k.getGeodesicLength();m||(m=1E3>h?2E3:1E4>h?3E3:4E3);m=40*h/m;var l=k.getVertices(),f=interopGeoSeg2(l,m),g=Ol2.Util.extend({},Ol2.Feature.Vector.style["default"]);g.strokeColor="#f00";g.strokeOpacity=1;g.strokeWidth=5;var a=f.length,c=0,b=1,e,v=[],w=setInterval(function(){c==a?(clearInterval(w),d.removeFeatures(e)):e?b==f[c].seg.length?(c++,v=c!=a?l.slice(0,f[c].idx):l,d.removeFeatures(e),e=new Ol2.Feature.Vector(new Ol2.Geometry.LineString(v),null,g),d.addFeatures(e),b=0):(e.geometry.addPoint(f[c].seg[b]),b++,d.redraw()):(e=new Ol2.Feature.Vector(new Ol2.Geometry.LineString([f[c].seg[0]]),null,g),d.addFeatures(e))},10)}var sdMap,g_userid=g_userid||"",g_username=g_username||"",isImg=!1;function initPage(){sdMap=new SDMap("mapDiv",{scaleLine:!0,keyboard:!0,layerSwitch:0,mousePosition:!0,poiIdenty:!0});MapToolUI.init(sdMap);RightMenu.init(sdMap);PoiInfoPop.init(sdMap);WidgetManger.init(sdMap);PathSearch.init(sdMap);WholeSearch.init(sdMap);ImgMetaCtl.init(Service.IMGMETA,sdMap);wmswmts.init(sdMap.map);g_userid=getCookie("USERID")||"0";g_username=getCookie("USERNAME")||"\u6e38\u5ba2"}(function(){Browser.ie6||Browser.ie6Compat||Browser.ie7||Browser.ie7Compat?(alert("\u5f53\u524d\u4f7f\u7528ie\u5185\u6838\u7248\u672c\u592a\u4f4e,\u90e8\u5206\u529f\u80fd\u5c06\u65e0\u6cd5\u4f7f\u7528\uff0c\u5efa\u8bae\u4f7f\u7528IE8\u53ca\u4ee5\u4e0a\u7248\u672c\u6d4f\u89c8\u5668\uff01"),parent.window.document.getElementById("iframe_").src="map/ie6.html"):initProject()})();function initProject(){$(function(){$("#mapDiv").css("width","100%");$("#tab_search").click(function(k){$(this).css({backgroundPosition:"0 -46px"});$("#tab_gps").css({backgroundPosition:"-400px -46px"});$("#tab_resource").css({backgroundPosition:"-498px -46px"});switchSearch("s1")});$("#tab_gps").click(function(k){$("#tab_search").css({backgroundPosition:"-300px -46px"});$(this).css({backgroundPosition:"-100px -46px"});$("#tab_resource").css({backgroundPosition:"-498px -46px"});switchSearch("s3")});$("#tab_resource").click(function(k){$("#tab_search").css({backgroundPosition:"-300px -46px"});$("#tab_gps").css({backgroundPosition:"-400px -46px"});$(this).css({backgroundPosition:"-200px -46px"});switchSearch("s4")});$("#left_hidden").click(function(k){$(this).hasClass("show")?($(this).removeClass("show"),$(this).attr({title:"\u6536\u8d77\u5de6\u680f"}),$("#left").css("display","block"),$("#center").css({width:$(window).width()-304,left:304}).attr("data-calc-width","100%-304px")):($(this).addClass("show"),$(this).attr({title:"\u5c55\u5f00\u5de6\u680f"}),$("#left").css("display","none"),$("#center").css({width:$(window).width(),left:0}).attr("data-calc-width","100%-0px"));MapContrast.IsStartContrast()?MapContrast.mapDivHandler():sdMap.map.updateSize()});initPage()})}function switchSearch(k){"s3"==k?($("#tab_gps_div").css("display","block").siblings(":gt(2)").css("display","none"),$("#tab_gps_div").css("display","block").siblings(":gt(3)").css("display","none"),WholeSearch.clearResult()):"s4"==k?($("#tab_resource_div").css("display","block").siblings(":gt(2)").css("display","none"),$("#tab_resource_div").css("display","block").siblings(":gt(3)").css("display","none"),ResourceList.init(sdMap.map),PathSearch.clearResult(),WholeSearch.clearResult()):($("#tab_search_cont").css("display","block").siblings(":gt(2)").css("display","none"),$("#tab_search_cont").css("display","block").siblings(":gt(3)").css("display","none"),"s1"==k?$("#tab_search_div1").css("display","block").siblings(":gt(0)").css("display","none"):$("#tab_search_div2").css("display","block").siblings(":gt(0)").css("display","none"),PathSearch.clearResult())};